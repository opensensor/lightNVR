; LightNVR Configuration File (INI format)

[general]
pid_file = /var/run/lightnvr.pid
log_file = /var/log/lightnvr.log
log_level = 2  ; 0=ERROR, 1=WARN, 2=INFO, 3=DEBUG
syslog_enabled = false  ; Enable logging to syslog for easier system integration
syslog_ident = lightnvr  ; Syslog identifier (application name)
syslog_facility = LOG_USER  ; Syslog facility (LOG_USER, LOG_DAEMON, LOG_LOCAL0-7)

[storage]
path = /var/lib/lightnvr/data/recordings
max_size = 0  ; 0 means unlimited, otherwise bytes
retention_days = 30
auto_delete_oldest = true

; New recording format options
record_mp4_directly = false
mp4_path = /var/lib/lightnvr/data/recordings/mp4
mp4_segment_duration = 900
mp4_retention_days = 30

[database]
path = /var/lib/lightnvr/data/database/lightnvr.db

[web]
port = 8080
root = /var/lib/lightnvr/www
auth_enabled = true
username = admin
; Password is auto-generated on first run - check logs for the generated password
; password =
auth_timeout_hours = 24  ; Session timeout in hours (default: 24)
; web_thread_pool_size: libuv UV_THREADPOOL_SIZE. Default is 2x online CPU cores (clamped [2, 128]).
; Uncomment and set to override the auto-detected default. Requires restart.
; web_thread_pool_size = 8

[streams]
; max_streams: runtime stream slot limit (default 32, ceiling 256). Requires restart.
max_streams = 32

[models]
path = /var/lib/lightnvr/data/models

[api_detection]
url = http://localhost:9001/api/v1/detect
backend = onnx  ; Detection backend: onnx (YOLOv8 - best accuracy), tflite, or opencv
confidence_threshold = 0.35  ; Lower threshold to catch distant vehicles
filter_classes = car,motorcycle,truck,bus,bicycle  ; Vehicle classes only

[memory]
buffer_size = 1024  ; Buffer size in KB
use_swap = true
swap_file = /var/lib/lightnvr/data/swap
swap_size = 134217728  ; 128MB in bytes

[hardware]
hw_accel_enabled = false
hw_accel_device =

[go2rtc]
; go2rtc binary and configuration paths
; binary_path = /usr/local/bin/go2rtc
; config_dir = /tmp/go2rtc
; api_port = 1984

; Maximum concurrent proxy requests for HLS streaming (default: 16)
; Controls how many simultaneous HLS/snapshot requests can be proxied
; Returns 503 when limit is reached. Range: 1-128
; proxy_max_inflight = 16

; WebRTC configuration for NAT/firewall traversal
; Enable WebRTC streaming (default: true)
webrtc_enabled = true

; WebRTC listen port (default: 8555)
; Make sure this port is forwarded through your firewall/NAT
webrtc_listen_port = 8555

; Enable STUN servers for NAT traversal (default: true)
; STUN helps establish WebRTC connections through NAT/firewalls
stun_enabled = true

; Primary STUN server (default: stun.l.google.com:19302)
stun_server = stun.l.google.com:19302

; Optional: Specify external IP address for complex NAT scenarios
; Leave empty for auto-detection (recommended)
; external_ip =

; Optional: Custom ICE servers (comma-separated)
; Format: stun:host:port or turn:host:port
; Example: stun:stun.example.com:3478,turn:turn.example.com:3478
; ice_servers =

[mqtt]
; MQTT settings for detection event streaming
; Enable MQTT publishing of detection events (default: false)
enabled = false

; MQTT broker hostname or IP address
broker_host = localhost

; MQTT broker port (default: 1883, use 8883 for TLS)
broker_port = 1883

; MQTT authentication (optional)
; username =
; password =

; MQTT client ID (default: lightnvr)
client_id = lightnvr

; Topic prefix for detection events (default: lightnvr)
; Detection events are published to: {topic_prefix}/detections/{stream_name}
topic_prefix = lightnvr

; Enable TLS for MQTT connection (default: false)
tls_enabled = false

; MQTT keepalive interval in seconds (default: 60)
keepalive = 60

; MQTT QoS level: 0 (at most once), 1 (at least once), 2 (exactly once)
qos = 1

; Retain detection messages on the broker (default: false)
retain = false

; Home Assistant MQTT auto-discovery
; When enabled, cameras and sensors automatically appear in Home Assistant
; Requires MQTT broker shared with Home Assistant
ha_discovery = false

; Discovery topic prefix (default: homeassistant)
; Must match Home Assistant's MQTT discovery prefix setting
ha_discovery_prefix = homeassistant

; Snapshot publish interval in seconds (default: 30, 0=disabled)
; Publishes JPEG camera snapshots via MQTT for HA camera entities
ha_snapshot_interval = 30

[onvif]
; ONVIF camera discovery settings
; Enable automatic discovery of ONVIF cameras on the network
discovery_enabled = false

; Interval in seconds between discovery scans (30-3600)
discovery_interval = 300

; Network to scan for ONVIF devices in CIDR notation
; Use "auto" for automatic detection (skips Docker/virtual interfaces)
; For containers, set LIGHTNVR_ONVIF_NETWORK environment variable instead
; Examples: 192.168.1.0/24, 10.0.0.0/16, auto
discovery_network = auto
