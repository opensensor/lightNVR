{"version":3,"file":"index-legacy-Cs7Jg1-O.js","sources":["../../node_modules/webrtc-adapter/src/js/utils.js","../../node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","../../node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","../../node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","../../node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","../../node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js","../../node_modules/webrtc-adapter/src/js/safari/safari_shim.js","../../node_modules/sdp/sdp.js","../../node_modules/webrtc-adapter/src/js/common_shim.js","../../js/components/preact/WebRTCVideoCell.jsx","../../js/components/preact/WebRTCView.jsx","../../js/pages/index-page.jsx","../../node_modules/webrtc-adapter/src/js/adapter_factory.js","../../node_modules/webrtc-adapter/src/js/adapter_core.js"],"sourcesContent":["/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nlet logDisabled_ = true;\nlet deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nexport function extractVersion(uastring, expr, pos) {\n  const match = uastring.match(expr);\n  return match && match.length >= pos && parseFloat(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nexport function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  const nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    const wrappedCallback = (e) => {\n      const modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        if (cb.handleEvent) {\n          cb.handleEvent(modifiedEvent);\n        } else {\n          cb(modifiedEvent);\n        }\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    if (!this._eventMap[eventNameToWrap]) {\n      this._eventMap[eventNameToWrap] = new Map();\n    }\n    this._eventMap[eventNameToWrap].set(cb, wrappedCallback);\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  const nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[eventNameToWrap]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    if (!this._eventMap[eventNameToWrap].has(cb)) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    const unwrappedCb = this._eventMap[eventNameToWrap].get(cb);\n    this._eventMap[eventNameToWrap].delete(cb);\n    if (this._eventMap[eventNameToWrap].size === 0) {\n      delete this._eventMap[eventNameToWrap];\n    }\n    if (Object.keys(this._eventMap).length === 0) {\n      delete this._eventMap;\n    }\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n          this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n          this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\nexport function disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return (bool) ? 'adapter.js logging disabled' :\n    'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nexport function disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nexport function log() {\n  if (typeof window === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nexport function deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n      ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nexport function detectBrowser(window) {\n  // Returned result object.\n  const result = {browser: null, version: null};\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator ||\n      !window.navigator.userAgent) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  const {navigator} = window;\n\n  // Prefer navigator.userAgentData.\n  if (navigator.userAgentData && navigator.userAgentData.brands) {\n    const chromium = navigator.userAgentData.brands.find((brand) => {\n      return brand.brand === 'Chromium';\n    });\n    if (chromium) {\n      return {browser: 'chrome', version: parseInt(chromium.version, 10)};\n    }\n  }\n\n  if (navigator.mozGetUserMedia) { // Firefox.\n    result.browser = 'firefox';\n    result.version = parseInt(extractVersion(navigator.userAgent,\n      /Firefox\\/(\\d+)\\./, 1));\n  } else if (navigator.webkitGetUserMedia ||\n      (window.isSecureContext === false && window.webkitRTCPeerConnection)) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    // Chrome 74 removed webkitGetUserMedia on http as well so we need the\n    // more complicated fallback to webkitRTCPeerConnection.\n    result.browser = 'chrome';\n    result.version = parseInt(extractVersion(navigator.userAgent,\n      /Chrom(e|ium)\\/(\\d+)\\./, 2));\n  } else if (window.RTCPeerConnection &&\n      navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n    result.browser = 'safari';\n    result.version = parseInt(extractVersion(navigator.userAgent,\n      /AppleWebKit\\/(\\d+)\\./, 1));\n    result.supportsUnifiedPlan = window.RTCRtpTransceiver &&\n        'currentDirection' in window.RTCRtpTransceiver.prototype;\n    // Only for internal usage.\n    result._safariVersion = extractVersion(navigator.userAgent,\n      /Version\\/(\\d+(\\.?\\d+))/, 1);\n  } else { // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Checks if something is an object.\n *\n * @param {*} val The something you want to check.\n * @return true if val is an object, false otherwise.\n */\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nexport function compactObject(data) {\n  if (!isObject(data)) {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function(accumulator, key) {\n    const isObj = isObject(data[key]);\n    const value = isObj ? compactObject(data[key]) : data[key];\n    const isEmptyObject = isObj && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n    return Object.assign(accumulator, {[key]: value});\n  }, {});\n}\n\n/* iterates the stats graph recursively. */\nexport function walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(name => {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(id => {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nexport function filterStats(result, track, outbound) {\n  const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  const filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  const trackStats = [];\n  result.forEach(value => {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(trackStat => {\n    result.forEach(stats => {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\nconst logging = utils.log;\n\nexport function shimGetUserMedia(window, browserDetails) {\n  const navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  const constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    const cc = {};\n    Object.keys(c).forEach(key => {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      const r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      const oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        let oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(mix => {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  const shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      const remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      let face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      const getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        let matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n            .then(devices => {\n              devices = devices.filter(d => d.kind === 'videoinput');\n              let dev = devices.find(d => matches.some(match =>\n                d.label.toLowerCase().includes(match)));\n              if (!dev && devices.length && matches.includes('back')) {\n                dev = devices[devices.length - 1]; // more likely the back cam\n              }\n              if (dev) {\n                constraints.video.deviceId = face.exact\n                  ? {exact: dev.deviceId}\n                  : {ideal: dev.deviceId};\n              }\n              constraints.video = constraintsToChrome_(constraints.video);\n              logging('chrome: ' + JSON.stringify(constraints));\n              return func(constraints);\n            });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  const shimError_ = function(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  const getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, c => {\n      navigator.webkitGetUserMedia(c, onSuccess, e => {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  if (navigator.mediaDevices.getUserMedia) {\n    const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, c => origGetUserMedia(c).then(stream => {\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(track => {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, e => Promise.reject(shimError_(e))));\n    };\n  }\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\n\nexport {shimGetUserMedia} from './getusermedia';\n\nexport function shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n      window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get() {\n        return this._ontrack;\n      },\n      set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    const origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        if (!this._ontrackpoly) {\n          this._ontrackpoly = (e) => {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', te => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === te.track.id);\n              } else {\n                receiver = {track: te.track};\n              }\n\n              const event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(track => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === track.id);\n              } else {\n                receiver = {track};\n              }\n              const event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n          };\n          this.addEventListener('addstream', this._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(this, arguments);\n      };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver',\n          {value: {receiver: e.receiver}});\n      }\n      return e;\n    });\n  }\n}\n\nexport function shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if (typeof window === 'object' && window.RTCPeerConnection &&\n      !('getSenders' in window.RTCPeerConnection.prototype) &&\n      'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    const shimSenderWithDtmf = function(pc, track) {\n      return {\n        track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack =\n        function addTrack(track, stream) {\n          let sender = origAddTrack.apply(this, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(this, track);\n            this._senders.push(sender);\n          }\n          return sender;\n        };\n\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack =\n        function removeTrack(sender) {\n          origRemoveTrack.apply(this, arguments);\n          const idx = this._senders.indexOf(sender);\n          if (idx !== -1) {\n            this._senders.splice(idx, 1);\n          }\n        };\n    }\n    const origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(track => {\n        this._senders.push(shimSenderWithDtmf(this, track));\n      });\n    };\n\n    const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        this._senders = this._senders || [];\n        origRemoveStream.apply(this, [stream]);\n\n        stream.getTracks().forEach(track => {\n          const sender = this._senders.find(s => s.track === track);\n          if (sender) { // remove sender\n            this._senders.splice(this._senders.indexOf(sender), 1);\n          }\n        });\n      };\n  } else if (typeof window === 'object' && window.RTCPeerConnection &&\n             'getSenders' in window.RTCPeerConnection.prototype &&\n             'createDTMFSender' in window.RTCPeerConnection.prototype &&\n             window.RTCRtpSender &&\n             !('dtmf' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nexport function shimSenderReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        const senders = origGetSenders.apply(this, []);\n        senders.forEach(sender => sender._pc = this);\n        return senders;\n      };\n    }\n\n    const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        const sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      const sender = this;\n      return this._pc.getStats().then(result =>\n        /* Note: this will include stats of all senders that\n         *   send a track with the same id as sender.track as\n         *   it is not possible to identify the RTCRtpSender.\n         */\n        utils.filterStats(result, sender.track, true));\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers =\n        function getReceivers() {\n          const receivers = origGetReceivers.apply(this, []);\n          receivers.forEach(receiver => receiver._pc = this);\n          return receivers;\n        };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      const receiver = this;\n      return this._pc.getStats().then(result =>\n        utils.filterStats(result, receiver.track, false));\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype &&\n      'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 &&\n        arguments[0] instanceof window.MediaStreamTrack) {\n      const track = arguments[0];\n      let sender;\n      let receiver;\n      let err;\n      this.getSenders().forEach(s => {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(r => {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || (sender && receiver)) {\n        return Promise.reject(new DOMException(\n          'There are more than one sender or receiver for the track.',\n          'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException(\n        'There is no sender or receiver for the track.',\n        'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nexport function shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams)\n        .map(streamId => this._shimmedLocalStreams[streamId][0]);\n    };\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      const sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n    });\n    const existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    const newSenders = this.getSenders()\n      .filter(newSender => existingSenders.indexOf(newSender) === -1);\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n  const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(streamId => {\n          const idx = this._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            this._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (this._shimmedLocalStreams[streamId].length === 1) {\n            delete this._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n}\n\nexport function shimAddTrackRemoveTrack(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack &&\n      browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  const origGetLocalStreams = window.RTCPeerConnection.prototype\n    .getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      const nativeStreams = origGetLocalStreams.apply(this);\n      this._reverseStreams = this._reverseStreams || {};\n      return nativeStreams.map(stream => this._reverseStreams[stream.id]);\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      const newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n\n      origRemoveStream.apply(this, [(this._streams[stream.id] || stream)]);\n      delete this._reverseStreams[(this._streams[stream.id] ?\n        this._streams[stream.id].id : stream.id)];\n      delete this._streams[stream.id];\n    };\n\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      const streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(t => t === track)) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n          'InvalidAccessError');\n      }\n\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n      const oldStream = this._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(() => {\n          this.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        const newStream = new window.MediaStream([track]);\n        this._streams[stream.id] = newStream;\n        this._reverseStreams[newStream.id] = stream;\n        this.addStream(newStream);\n      }\n      return this.getSenders().find(s => s.track === track);\n    };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n        externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n        internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function(method) {\n    const nativeMethod = window.RTCPeerConnection.prototype[method];\n    const methodObj = {[method]() {\n      const args = arguments;\n      const isLegacyCall = arguments.length &&\n          typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [\n          (description) => {\n            const desc = replaceInternalStreamId(this, description);\n            args[0].apply(null, [desc]);\n          },\n          (err) => {\n            if (args[1]) {\n              args[1].apply(null, err);\n            }\n          }, arguments[2]\n        ]);\n      }\n      return nativeMethod.apply(this, arguments)\n        .then(description => replaceInternalStreamId(this, description));\n    }};\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  const origSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(this, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(this, arguments[0]);\n      return origSetLocalDescription.apply(this, arguments);\n    };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  const origLocalDescription = Object.getOwnPropertyDescriptor(\n    window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype,\n    'localDescription', {\n      get() {\n        const description = origLocalDescription.get.apply(this);\n        if (description.type === '') {\n          return description;\n        }\n        return replaceInternalStreamId(this, description);\n      }\n    });\n\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      const isLocal = sender._pc === this;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n          'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      this._streams = this._streams || {};\n      let stream;\n      Object.keys(this._streams).forEach(streamid => {\n        const hasTrack = this._streams[streamid].getTracks()\n          .find(track => sender.track === track);\n        if (hasTrack) {\n          stream = this._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          this.removeStream(this._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        this.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n}\n\nexport function shimPeerConnection(window, browserDetails) {\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n      .forEach(function(method) {\n        const nativeMethod = window.RTCPeerConnection.prototype[method];\n        const methodObj = {[method]() {\n          arguments[0] = new ((method === 'addIceCandidate') ?\n            window.RTCIceCandidate :\n            window.RTCSessionDescription)(arguments[0]);\n          return nativeMethod.apply(this, arguments);\n        }};\n        window.RTCPeerConnection.prototype[method] = methodObj[method];\n      });\n  }\n}\n\n// Attempt to fix ONN in plan-b mode.\nexport function fixNegotiationNeeded(window, browserDetails) {\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', e => {\n    const pc = e.target;\n    if (browserDetails.version < 72 || (pc.getConfiguration &&\n        pc.getConfiguration().sdpSemantics === 'plan-b')) {\n      if (pc.signalingState !== 'stable') {\n        return;\n      }\n    }\n    return e;\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window, browserDetails) {\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n      'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      ('receiver' in window.RTCTrackEvent.prototype) &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimPeerConnection(window, browserDetails) {\n  if (typeof window !== 'object' ||\n      !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  if (browserDetails.version < 53) {\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n      .forEach(function(method) {\n        const nativeMethod = window.RTCPeerConnection.prototype[method];\n        const methodObj = {[method]() {\n          arguments[0] = new ((method === 'addIceCandidate') ?\n            window.RTCIceCandidate :\n            window.RTCSessionDescription)(arguments[0]);\n          return nativeMethod.apply(this, arguments);\n        }};\n        window.RTCPeerConnection.prototype[method] = methodObj[method];\n      });\n  }\n\n  const modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n    return nativeGetStats.apply(this, [selector || null])\n      .then(stats => {\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(stat => {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            }\n            // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n            stats.forEach((stat, i) => {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n        return stats;\n      })\n      .then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n  }\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n      const sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function getStats() {\n    return this.track ? this._pc.getStats(this.track) :\n      Promise.resolve(new Map());\n  };\n}\n\nexport function shimReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n      const receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(receiver => receiver._pc = this);\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', e => {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function getStats() {\n    return this._pc.getStats(this.track);\n  };\n}\n\nexport function shimRemoveStream(window) {\n  if (!window.RTCPeerConnection ||\n      'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(sender => {\n        if (sender.track && stream.getTracks().includes(sender.track)) {\n          this.removeTrack(sender);\n        }\n      });\n    };\n}\n\nexport function shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\nexport function shimAddTransceiver(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;\n  if (origAddTransceiver) {\n    window.RTCPeerConnection.prototype.addTransceiver =\n      function addTransceiver() {\n        this.setParametersPromises = [];\n        // WebIDL input coercion and validation\n        let sendEncodings = arguments[1] && arguments[1].sendEncodings;\n        if (sendEncodings === undefined) {\n          sendEncodings = [];\n        }\n        sendEncodings = [...sendEncodings];\n        const shouldPerformCheck = sendEncodings.length > 0;\n        if (shouldPerformCheck) {\n          // If sendEncodings params are provided, validate grammar\n          sendEncodings.forEach((encodingParam) => {\n            if ('rid' in encodingParam) {\n              const ridRegex = /^[a-z0-9]{0,16}$/i;\n              if (!ridRegex.test(encodingParam.rid)) {\n                throw new TypeError('Invalid RID value provided.');\n              }\n            }\n            if ('scaleResolutionDownBy' in encodingParam) {\n              if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {\n                throw new RangeError('scale_resolution_down_by must be >= 1.0');\n              }\n            }\n            if ('maxFramerate' in encodingParam) {\n              if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {\n                throw new RangeError('max_framerate must be >= 0.0');\n              }\n            }\n          });\n        }\n        const transceiver = origAddTransceiver.apply(this, arguments);\n        if (shouldPerformCheck) {\n          // Check if the init options were applied. If not we do this in an\n          // asynchronous way and save the promise reference in a global object.\n          // This is an ugly hack, but at the same time is way more robust than\n          // checking the sender parameters before and after the createOffer\n          // Also note that after the createoffer we are not 100% sure that\n          // the params were asynchronously applied so we might miss the\n          // opportunity to recreate offer.\n          const {sender} = transceiver;\n          const params = sender.getParameters();\n          if (!('encodings' in params) ||\n              // Avoid being fooled by patched getParameters() below.\n              (params.encodings.length === 1 &&\n               Object.keys(params.encodings[0]).length === 0)) {\n            params.encodings = sendEncodings;\n            sender.sendEncodings = sendEncodings;\n            this.setParametersPromises.push(sender.setParameters(params)\n              .then(() => {\n                delete sender.sendEncodings;\n              }).catch(() => {\n                delete sender.sendEncodings;\n              })\n            );\n          }\n        }\n        return transceiver;\n      };\n  }\n}\n\nexport function shimGetParameters(window) {\n  if (!(typeof window === 'object' && window.RTCRtpSender)) {\n    return;\n  }\n  const origGetParameters = window.RTCRtpSender.prototype.getParameters;\n  if (origGetParameters) {\n    window.RTCRtpSender.prototype.getParameters =\n      function getParameters() {\n        const params = origGetParameters.apply(this, arguments);\n        if (!('encodings' in params)) {\n          params.encodings = [].concat(this.sendEncodings || [{}]);\n        }\n        return params;\n      };\n  }\n}\n\nexport function shimCreateOffer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function createOffer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n        .then(() => {\n          return origCreateOffer.apply(this, arguments);\n        })\n        .finally(() => {\n          this.setParametersPromises = [];\n        });\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\nexport function shimCreateAnswer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;\n  window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n        .then(() => {\n          return origCreateAnswer.apply(this, arguments);\n        })\n        .finally(() => {\n          this.setParametersPromises = [];\n        });\n    }\n    return origCreateAnswer.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      if (!(constraints && constraints.video)) {\n        const err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track, ...streams) {\n        if (streams) {\n          streams.forEach((stream) => {\n            if (!this._localStreams) {\n              this._localStreams = [stream];\n            } else if (!this._localStreams.includes(stream)) {\n              this._localStreams.push(stream);\n            }\n          });\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n        .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (server.urls === undefined && server.url) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in OrigPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio', {direction: 'recvonly'});\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video', {direction: 'recvonly'});\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n\nexport function shimAudioContext(window) {\n  if (typeof window !== 'object' || window.AudioContext) {\n    return;\n  }\n  window.AudioContext = window.webkitAudioContext;\n}\n\n","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nconst SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substring(2, 12);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(line => line.trim());\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  const parts = blob.split('\\nm=');\n  return parts.map((part, index) => (index > 0 ?\n    'm=' + part : part).trim() + '\\r\\n');\n};\n\n// Returns the session description.\nSDPUtils.getDescription = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// Returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(line => line.indexOf(prefix) === 0);\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\n// Input can be prefixed with a=.\nSDPUtils.parseCandidate = function(line) {\n  let parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  const candidate = {\n    foundation: parts[0],\n    component: {1: 'rtp', 2: 'rtcp'}[parts[1]] || parts[1],\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7],\n  };\n\n  for (let i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compatibility.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag. Don't overwrite.\n        if (candidate[parts[i]] === undefined) {\n          candidate[parts[i]] = parts[i + 1];\n        }\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\n// This does not include the a= prefix!\nSDPUtils.writeCandidate = function(candidate) {\n  const sdp = [];\n  sdp.push(candidate.foundation);\n\n  const component = candidate.component;\n  if (component === 'rtp') {\n    sdp.push(1);\n  } else if (component === 'rtcp') {\n    sdp.push(2);\n  } else {\n    sdp.push(component);\n  }\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  const type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// Sample input:\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substring(14).split(' ');\n};\n\n// Parses a rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  let parts = line.substring(9).split(' ');\n  const parsed = {\n    payloadType: parseInt(parts.shift(), 10), // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generates a rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  const channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses a extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  const parts = line.substring(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1],\n    attributes: parts.slice(2).join(' '),\n  };\n};\n\n// Generates an extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri +\n      (headerExtension.attributes ? ' ' + headerExtension.attributes : '') +\n      '\\r\\n';\n};\n\n// Parses a fmtp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  const parsed = {};\n  let kv;\n  const parts = line.substring(line.indexOf(' ') + 1).split(';');\n  for (let j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates a fmtp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  let line = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    const params = [];\n    Object.keys(codec.parameters).forEach(param => {\n      if (codec.parameters[param] !== undefined) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses a rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  const parts = line.substring(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' '),\n  };\n};\n\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  let lines = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(fb => {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses a RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  const sp = line.indexOf(' ');\n  const parts = {\n    ssrc: parseInt(line.substring(7, sp), 10),\n  };\n  const colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substring(sp + 1, colon);\n    parts.value = line.substring(colon + 1);\n  } else {\n    parts.attribute = line.substring(sp + 1);\n  }\n  return parts;\n};\n\n// Parse a ssrc-group line (see RFC 5576). Sample input:\n// a=ssrc-group:semantics 12 34\nSDPUtils.parseSsrcGroup = function(line) {\n  const parts = line.substring(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(ssrc => parseInt(ssrc, 10)),\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// Returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  const mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substring(6);\n  }\n};\n\n// Parses a fingerprint line for DTLS-SRTP.\nSDPUtils.parseFingerprint = function(line) {\n  const parts = line.substring(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1].toUpperCase(), // the definition is upper-case in RFC 4572.\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint),\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  let sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(fp => {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n\n// Parses a=crypto lines into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members\nSDPUtils.parseCryptoLine = function(line) {\n  const parts = line.substring(9).split(' ');\n  return {\n    tag: parseInt(parts[0], 10),\n    cryptoSuite: parts[1],\n    keyParams: parts[2],\n    sessionParams: parts.slice(3),\n  };\n};\n\nSDPUtils.writeCryptoLine = function(parameters) {\n  return 'a=crypto:' + parameters.tag + ' ' +\n    parameters.cryptoSuite + ' ' +\n    (typeof parameters.keyParams === 'object'\n      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)\n      : parameters.keyParams) +\n    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +\n    '\\r\\n';\n};\n\n// Parses the crypto key parameters into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*\nSDPUtils.parseCryptoKeyParams = function(keyParams) {\n  if (keyParams.indexOf('inline:') !== 0) {\n    return null;\n  }\n  const parts = keyParams.substring(7).split('|');\n  return {\n    keyMethod: 'inline',\n    keySalt: parts[0],\n    lifeTime: parts[1],\n    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,\n    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,\n  };\n};\n\nSDPUtils.writeCryptoKeyParams = function(keyParams) {\n  return keyParams.keyMethod + ':'\n    + keyParams.keySalt +\n    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +\n    (keyParams.mkiValue && keyParams.mkiLength\n      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength\n      : '');\n};\n\n// Extracts all SDES parameters.\nSDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=crypto:');\n  return lines.map(SDPUtils.parseCryptoLine);\n};\n\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  const ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-ufrag:')[0];\n  const pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-pwd:')[0];\n  if (!(ufrag && pwd)) {\n    return null;\n  }\n  return {\n    usernameFragment: ufrag.substring(12),\n    password: pwd.substring(10),\n  };\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  let sdp = 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n  if (params.iceLite) {\n    sdp += 'a=ice-lite\\r\\n';\n  }\n  return sdp;\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  const description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: [],\n  };\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  description.profile = mline[2];\n  for (let i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    const pt = mline[i];\n    const rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      const codec = SDPUtils.parseRtpMap(rtpmapline);\n      const fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(line => {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  const wildcardRtcpFb = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-fb:* ')\n    .map(SDPUtils.parseRtcpFb);\n  description.codecs.forEach(codec => {\n    wildcardRtcpFb.forEach(fb=> {\n      const duplicate = codec.rtcpFeedback.find(existingFeedback => {\n        return existingFeedback.type === fb.type &&\n          existingFeedback.parameter === fb.parameter;\n      });\n      if (!duplicate) {\n        codec.rtcpFeedback.push(fb);\n      }\n    });\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  let sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' ' + (caps.profile || 'UDP/TLS/RTP/SAVPF') + ' ';\n  sdp += caps.codecs.map(codec => {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(codec => {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  let maxptime = 0;\n  caps.codecs.forEach(codec => {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(extension => {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  const encodingParameters = [];\n  const description = SDPUtils.parseRtpParameters(mediaSection);\n  const hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  const hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  const ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(parts => parts.attribute === 'cname');\n  const primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  let secondarySsrc;\n\n  const flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(line => {\n      const parts = line.substring(17).split(' ');\n      return parts.map(part => parseInt(part, 10));\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(codec => {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      let encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red',\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc,\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  let bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substring(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substring(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(params => {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  const rtcpParameters = {};\n\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  const remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(obj => obj.attribute === 'cname')[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  const rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  const mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\nSDPUtils.writeRtcpParameters = function(rtcpParameters) {\n  let sdp = '';\n  if (rtcpParameters.reducedSize) {\n    sdp += 'a=rtcp-rsize\\r\\n';\n  }\n  if (rtcpParameters.mux) {\n    sdp += 'a=rtcp-mux\\r\\n';\n  }\n  if (rtcpParameters.ssrc !== undefined && rtcpParameters.cname) {\n    sdp += 'a=ssrc:' + rtcpParameters.ssrc +\n      ' cname:' + rtcpParameters.cname + '\\r\\n';\n  }\n  return sdp;\n};\n\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  let parts;\n  const spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substring(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  const planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(msidParts => msidParts.attribute === 'msid');\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  const mline = SDPUtils.parseMLine(mediaSection);\n  const maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  let maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substring(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  const sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substring(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize,\n    };\n  }\n  const sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    const parts = sctpMapLines[0]\n      .substring(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize,\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  let output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n',\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n',\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 22);\n};\n\n// Write boiler plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  let sessionId;\n  const version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  const user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  const lines = SDPUtils.splitLines(mediaSection);\n  for (let i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substring(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  return mline[0].substring(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const parts = lines[0].substring(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' '),\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  const line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  const parts = line.substring(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5],\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  const lines = SDPUtils.splitLines(blob);\n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport SDPUtils from 'sdp';\nimport * as utils from './utils';\n\nexport function shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  const NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function RTCIceCandidate(args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if (typeof args === 'object' && args.candidate &&\n        args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substring(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      const nativeCandidate = new NativeRTCIceCandidate(args);\n      const parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      for (const key in parsedCandidate) {\n        if (!(key in nativeCandidate)) {\n          Object.defineProperty(nativeCandidate, key,\n            {value: parsedCandidate[key]});\n        }\n      }\n\n      // Override serializer to not serialize the extra attributes.\n      nativeCandidate.toJSON = function toJSON() {\n        return {\n          candidate: nativeCandidate.candidate,\n          sdpMid: nativeCandidate.sdpMid,\n          sdpMLineIndex: nativeCandidate.sdpMLineIndex,\n          usernameFragment: nativeCandidate.usernameFragment,\n        };\n      };\n      return nativeCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nexport function shimRTCIceCandidateRelayProtocol(window) {\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'relayProtocol' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      const parsedCandidate = SDPUtils.parseCandidate(e.candidate.candidate);\n      if (parsedCandidate.type === 'relay') {\n        // This is a libwebrtc-specific mapping of local type preference\n        // to relayProtocol.\n        e.candidate.relayProtocol = {\n          0: 'tls',\n          1: 'tcp',\n          2: 'udp',\n        }[parsedCandidate.priority >> 24];\n      }\n    }\n    return e;\n  });\n}\n\nexport function shimMaxMessageSize(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  const sctpInDescription = function(description) {\n    if (!description || !description.sdp) {\n      return false;\n    }\n    const sections = SDPUtils.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(mediaSection => {\n      const mLine = SDPUtils.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application'\n          && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  const getRemoteFirefoxVersion = function(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    const version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  const getCanSendMaxMessageSize = function(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    let canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize =\n          browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  const getMaxMessageSize = function(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    let maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox'\n         && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    const match = SDPUtils.matchPrefix(description.sdp,\n      'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substring(19), 10);\n    } else if (browserDetails.browser === 'firefox' &&\n                remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n    function setRemoteDescription() {\n      this._sctp = null;\n      // Chrome decided to not expose .sctp in plan-b mode.\n      // As usual, adapter.js has to do an 'ugly worakaround'\n      // to cover up the mess.\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\n        const {sdpSemantics} = this.getConfiguration();\n        if (sdpSemantics === 'plan-b') {\n          Object.defineProperty(this, 'sctp', {\n            get() {\n              return typeof this._sctp === 'undefined' ? null : this._sctp;\n            },\n            enumerable: true,\n            configurable: true,\n          });\n        }\n      }\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        const isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        const canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        let maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        const sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get() {\n            return maxMessageSize;\n          }\n        });\n        this._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n}\n\nexport function shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection &&\n      'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    const origDataChannelSend = dc.send;\n    dc.send = function send() {\n      const data = arguments[0];\n      const length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' &&\n          pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' +\n          pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  const origCreateDataChannel =\n    window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel =\n    function createDataChannel() {\n      const dataChannel = origCreateDataChannel.apply(this, arguments);\n      wrapDcSend(dataChannel, this);\n      return dataChannel;\n    };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', e => {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nexport function shimConnectionState(window) {\n  if (!window.RTCPeerConnection ||\n      'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get() {\n      return this._onconnectionstatechange || null;\n    },\n    set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange',\n          this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange',\n          this._onconnectionstatechange = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\n    const origMethod = proto[method];\n    proto[method] = function() {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = e => {\n          const pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            const newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange',\n          this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nexport function removeExtmapAllowMixed(window, browserDetails) {\n  /* remove a=extmap-allow-mixed for webrtc.org < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  if (browserDetails.browser === 'safari' &&\n      browserDetails._safariVersion >= 13.1) {\n    return;\n  }\n  const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n  function setRemoteDescription(desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      const sdp = desc.sdp.split('\\n').filter((line) => {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n      // Safari enforces read-only-ness of RTCSessionDescription fields.\n      if (window.RTCSessionDescription &&\n          desc instanceof window.RTCSessionDescription) {\n        arguments[0] = new window.RTCSessionDescription({\n          type: desc.type,\n          sdp,\n        });\n      } else {\n        desc.sdp = sdp;\n      }\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n\nexport function shimAddIceCandidateNullOrEmpty(window, browserDetails) {\n  // Support for addIceCandidate(null or undefined)\n  // as well as addIceCandidate({candidate: \"\", ...})\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=978582\n  // Note: must be called before other polyfills which change the signature.\n  if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {\n    return;\n  }\n  const nativeAddIceCandidate =\n      window.RTCPeerConnection.prototype.addIceCandidate;\n  if (!nativeAddIceCandidate || nativeAddIceCandidate.length === 0) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions.\n      // Native support for ignoring exists for Chrome M77+.\n      // Safari ignores as well, exact version unknown but works in the same\n      // version that also ignores addIceCandidate(null).\n      if (((browserDetails.browser === 'chrome' && browserDetails.version < 78)\n           || (browserDetails.browser === 'firefox'\n               && browserDetails.version < 68)\n           || (browserDetails.browser === 'safari'))\n          && arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n}\n\n// Note: Make sure to call this ahead of APIs that modify\n// setLocalDescription.length\nexport function shimParameterlessSetLocalDescription(window, browserDetails) {\n  if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {\n    return;\n  }\n  const nativeSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  if (!nativeSetLocalDescription || nativeSetLocalDescription.length === 0) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      let desc = arguments[0] || {};\n      if (typeof desc !== 'object' || (desc.type && desc.sdp)) {\n        return nativeSetLocalDescription.apply(this, arguments);\n      }\n      // The remaining steps should technically happen when SLD comes off the\n      // RTCPeerConnection's operations chain (not ahead of going on it), but\n      // this is too difficult to shim. Instead, this shim only covers the\n      // common case where the operations chain is empty. This is imperfect, but\n      // should cover many cases. Rationale: Even if we can't reduce the glare\n      // window to zero on imperfect implementations, there's value in tapping\n      // into the perfect negotiation pattern that several browsers support.\n      desc = {type: desc.type, sdp: desc.sdp};\n      if (!desc.type) {\n        switch (this.signalingState) {\n          case 'stable':\n          case 'have-local-offer':\n          case 'have-remote-pranswer':\n            desc.type = 'offer';\n            break;\n          default:\n            desc.type = 'answer';\n            break;\n        }\n      }\n      if (desc.sdp || (desc.type !== 'offer' && desc.type !== 'answer')) {\n        return nativeSetLocalDescription.apply(this, [desc]);\n      }\n      const func = desc.type === 'offer' ? this.createOffer : this.createAnswer;\n      return func.apply(this)\n        .then(d => nativeSetLocalDescription.apply(this, [d]));\n    };\n}\n","/**\n * WebRTCVideoCell Component\n * A self-contained component for displaying a WebRTC video stream\n */\n\nimport { h } from 'preact';\nimport { useState, useEffect, useRef } from 'preact/hooks';\nimport { DetectionOverlay, takeSnapshotWithDetections } from './DetectionOverlay.jsx';\nimport { SnapshotButton } from './SnapshotManager.jsx';\nimport { LoadingIndicator } from './LoadingIndicator.jsx';\nimport { showSnapshotPreview } from './UI.jsx';\nimport adapter from 'webrtc-adapter';\n\n/**\n * WebRTCVideoCell component\n * @param {Object} props - Component props\n * @param {Object} props.stream - Stream object\n * @param {Function} props.onToggleFullscreen - Fullscreen toggle handler\n * @param {string} props.streamId - Stream ID for stable reference\n * @returns {JSX.Element} WebRTCVideoCell component\n */\nexport function WebRTCVideoCell({\n  stream,\n  streamId,\n  onToggleFullscreen\n}) {\n  // Component state\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [connectionQuality, setConnectionQuality] = useState('unknown'); // 'unknown', 'good', 'poor', 'bad'\n\n  // Refs\n  const videoRef = useRef(null);\n  const cellRef = useRef(null);\n  const peerConnectionRef = useRef(null);\n  const detectionOverlayRef = useRef(null);\n  const abortControllerRef = useRef(null);\n  const connectionMonitorRef = useRef(null);\n  const reconnectAttemptsRef = useRef(0);\n\n  // Initialize WebRTC connection when component mounts\n  useEffect(() => {\n    if (!stream || !stream.name || !videoRef.current) return;\n\n    console.log(`Initializing WebRTC connection for stream ${stream.name}`);\n    setIsLoading(true);\n    setError(null);\n\n    // Create a new RTCPeerConnection\n    const pc = new RTCPeerConnection({\n      iceTransports: 'all',\n      bundlePolicy: 'balanced',\n      rtcpCnameCpn: 'LightNVR',\n      rtcpCnameRtp: 'LightNVR',\n      iceCandidatePoolSize: 0,\n      iceServers: [\n        { urls: 'stun:stun.l.google.com:19302' },\n      ]\n    });\n\n    peerConnectionRef.current = pc;\n\n    // Set up event handlers\n    pc.ontrack = (event) => {\n      console.log(`Track received for stream ${stream.name}`);\n      \n      if (event.track.kind === 'video') {\n        const videoElement = videoRef.current;\n        if (!videoElement) return;\n\n        // Set srcObject\n        videoElement.srcObject = event.streams[0];\n        \n        // Add event handlers\n        videoElement.onloadeddata = () => {\n          console.log(`Video data loaded for stream ${stream.name}`);\n        };\n\n        videoElement.onplaying = () => {\n          console.log(`Video playing for stream ${stream.name}`);\n          setIsLoading(false);\n          setIsPlaying(true);\n        };\n        videoElement.onerror = (event) => {\n          console.error(`Error loading video for stream ${stream.name}:`, event);\n          setError('Failed to load video');\n          setIsLoading(false);\n        };\n      }\n    };\n\n    pc.oniceconnectionstatechange = () => {\n      console.log(`ICE connection state for stream ${stream.name}: ${pc.iceConnectionState}`);\n      \n      if (pc.iceConnectionState === 'failed') {\n        console.error(`WebRTC ICE connection failed for stream ${stream.name}`);\n        setError('WebRTC ICE connection failed');\n        setIsLoading(false);\n      } else if (pc.iceConnectionState === 'disconnected') {\n        // Connection is temporarily disconnected, log but don't show error yet\n        console.warn(`WebRTC ICE connection disconnected for stream ${stream.name}, attempting to recover...`);\n        \n        // Set a timeout to check if the connection recovers on its own\n        setTimeout(() => {\n          if (peerConnectionRef.current && \n              (peerConnectionRef.current.iceConnectionState === 'disconnected' || \n               peerConnectionRef.current.iceConnectionState === 'failed')) {\n            console.error(`WebRTC ICE connection could not recover for stream ${stream.name}`);\n            setError('WebRTC connection lost. Please retry.');\n            setIsLoading(false);\n          } else if (peerConnectionRef.current) {\n            console.log(`WebRTC ICE connection recovered for stream ${stream.name}, current state: ${peerConnectionRef.current.iceConnectionState}`);\n          }\n        }, 5000); // Wait 5 seconds to see if connection recovers\n      } else if (pc.iceConnectionState === 'connected' || pc.iceConnectionState === 'completed') {\n        // Connection is established or completed, clear any previous error\n        if (error) {\n          console.log(`WebRTC connection restored for stream ${stream.name}`);\n          setError(null);\n        }\n      }\n    };\n\n    // Add transceivers\n    pc.addTransceiver('video', {direction: 'recvonly'});\n\n    // Create and send offer\n    pc.createOffer()\n      .then(offer => pc.setLocalDescription(offer))\n      .then(() => {\n        // Create a new AbortController for this request\n        abortControllerRef.current = new AbortController();\n        \n        // Format the offer\n        const formattedOffer = {\n          type: pc.localDescription.type,\n          sdp: pc.localDescription.sdp\n        };\n\n        // Get auth token if available\n        const auth = localStorage.getItem('auth');\n\n        // Send the offer to the server\n        return fetch(`/api/webrtc?src=${encodeURIComponent(stream.name)}`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            ...(auth ? { 'Authorization': 'Basic ' + auth } : {})\n          },\n          body: JSON.stringify(formattedOffer),\n        });\n      })\n      .then(response => {\n        if (!response.ok) {\n          throw new Error(`Failed to send offer: ${response.status} ${response.statusText}`);\n        }\n        return response.text();\n      })\n      .then(text => {\n        try {\n          return JSON.parse(text);\n        } catch (error) {\n          console.error(`Error parsing JSON for stream ${stream.name}:`, error);\n          throw new Error('Failed to parse WebRTC answer');\n        }\n      })\n      .then(answer => pc.setRemoteDescription(new RTCSessionDescription(answer)))\n      .catch(error => {\n        console.error(`Error setting up WebRTC for stream ${stream.name}:`, error);\n        setError(error.message || 'Failed to establish WebRTC connection');\n      });\n\n    // Set up connection quality monitoring\n    const startConnectionMonitoring = () => {\n      // Clear any existing monitor\n      if (connectionMonitorRef.current) {\n        clearInterval(connectionMonitorRef.current);\n      }\n      \n      // Start a new monitor\n      connectionMonitorRef.current = setInterval(() => {\n        if (!peerConnectionRef.current) return;\n        \n        // Get connection stats\n        peerConnectionRef.current.getStats().then(stats => {\n          let packetsLost = 0;\n          let packetsReceived = 0;\n          let currentRtt = 0;\n          let jitter = 0;\n          \n          stats.forEach(report => {\n            if (report.type === 'inbound-rtp' && report.kind === 'video') {\n              packetsLost = report.packetsLost || 0;\n              packetsReceived = report.packetsReceived || 0;\n              jitter = report.jitter || 0;\n            }\n            \n            if (report.type === 'candidate-pair' && report.state === 'succeeded') {\n              currentRtt = report.currentRoundTripTime || 0;\n            }\n          });\n          \n          // Calculate packet loss percentage\n          const totalPackets = packetsReceived + packetsLost;\n          const lossPercentage = totalPackets > 0 ? (packetsLost / totalPackets) * 100 : 0;\n          \n          // Determine connection quality\n          let quality = 'unknown';\n          \n          if (packetsReceived > 0) {\n            if (lossPercentage < 2 && currentRtt < 0.1 && jitter < 0.03) {\n              quality = 'good';\n            } else if (lossPercentage < 5 && currentRtt < 0.3 && jitter < 0.1) {\n              quality = 'fair';\n            } else if (lossPercentage < 15 && currentRtt < 1) {\n              quality = 'poor';\n            } else {\n              quality = 'bad';\n            }\n          }\n          \n          // Update connection quality state if changed\n          if (quality !== connectionQuality) {\n            console.log(`WebRTC connection quality for stream ${stream.name} changed to ${quality}`);\n            console.log(`Stats: loss=${lossPercentage.toFixed(2)}%, rtt=${(currentRtt * 1000).toFixed(0)}ms, jitter=${(jitter * 1000).toFixed(0)}ms`);\n            setConnectionQuality(quality);\n          }\n        }).catch(err => {\n          console.warn(`Error getting WebRTC stats for stream ${stream.name}:`, err);\n        });\n      }, 10000); // Check every 10 seconds\n    };\n    \n    // Start monitoring once we have a connection\n    if (peerConnectionRef.current && peerConnectionRef.current.iceConnectionState === 'connected') {\n      startConnectionMonitoring();\n    }\n    \n    // Listen for connection state changes to start/stop monitoring\n    const originalOnIceConnectionStateChange = pc.oniceconnectionstatechange;\n    pc.oniceconnectionstatechange = () => {\n      // Call the original handler\n      if (originalOnIceConnectionStateChange) {\n        originalOnIceConnectionStateChange();\n      }\n      \n      // Start monitoring when connected\n      if (pc.iceConnectionState === 'connected' || pc.iceConnectionState === 'completed') {\n        startConnectionMonitoring();\n        // Reset reconnect attempts counter when we get a good connection\n        reconnectAttemptsRef.current = 0;\n      }\n      \n      // Stop monitoring when disconnected or failed\n      if (pc.iceConnectionState === 'disconnected' || pc.iceConnectionState === 'failed' || pc.iceConnectionState === 'closed') {\n        if (connectionMonitorRef.current) {\n          clearInterval(connectionMonitorRef.current);\n          connectionMonitorRef.current = null;\n        }\n      }\n    };\n\n    // Cleanup function\n    return () => {\n      console.log(`Cleaning up WebRTC connection for stream ${stream.name}`);\n      \n      // Stop connection monitoring\n      if (connectionMonitorRef.current) {\n        clearInterval(connectionMonitorRef.current);\n        connectionMonitorRef.current = null;\n      }\n      \n      // Abort any pending fetch requests\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n        abortControllerRef.current = null;\n      }\n      \n      // Clean up video element\n      if (videoRef.current && videoRef.current.srcObject) {\n        const tracks = videoRef.current.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n        videoRef.current.srcObject = null;\n      }\n      \n      // Close peer connection\n      if (peerConnectionRef.current) {\n        peerConnectionRef.current.close();\n        peerConnectionRef.current = null;\n      }\n    };\n  }, [stream]);\n\n  // Handle retry button click\n  const handleRetry = () => {\n    // Force a re-render to restart the WebRTC connection\n    setError(null);\n    setIsLoading(true);\n    \n    // Clean up existing connection\n    if (peerConnectionRef.current) {\n      peerConnectionRef.current.close();\n      peerConnectionRef.current = null;\n    }\n    \n    if (videoRef.current && videoRef.current.srcObject) {\n      const tracks = videoRef.current.srcObject.getTracks();\n      tracks.forEach(track => track.stop());\n      videoRef.current.srcObject = null;\n    }\n\n    // Force a re-render by updating state\n    setIsPlaying(false);\n  };\n\n  return (\n    <div\n      className=\"video-cell\"\n      data-stream-name={stream.name}\n      data-stream-id={streamId}\n      ref={cellRef}\n      style={{\n        position: 'relative',\n        pointerEvents: 'auto',\n        zIndex: 1\n      }}\n    >\n      {/* Video element */}\n      <video\n        id={`video-${streamId.replace(/\\s+/g, '-')}`}\n        className=\"video-element\"\n        ref={videoRef}\n        autoPlay\n        muted\n        disablePictureInPicture\n        playsInline\n        style={{ width: '100%', height: '100%', objectFit: 'contain' }}\n      />\n\n      {/* Detection overlay component */}\n      {stream.detection_based_recording && stream.detection_model && (\n        <DetectionOverlay\n          ref={detectionOverlayRef}\n          streamName={stream.name}\n          videoRef={videoRef}\n          enabled={isPlaying}\n          detectionModel={stream.detection_model}\n        />\n      )}\n\n      {/* Stream name overlay with connection quality indicator */}\n      <div\n        className=\"stream-name-overlay\"\n        style={{\n          position: 'absolute',\n          top: '10px',\n          left: '10px',\n          padding: '5px 10px',\n          backgroundColor: 'rgba(0, 0, 0, 0.5)',\n          color: 'white',\n          borderRadius: '4px',\n          fontSize: '14px',\n          zIndex: 3,\n          display: 'flex',\n          alignItems: 'center',\n          gap: '8px'\n        }}\n      >\n        {stream.name}\n        \n        {/* Connection quality indicator - only show when we have quality data and stream is playing */}\n        {isPlaying && connectionQuality !== 'unknown' && (\n          <div \n            className={`connection-quality-indicator quality-${connectionQuality}`}\n            title={`Connection Quality: ${connectionQuality.charAt(0).toUpperCase() + connectionQuality.slice(1)}`}\n            style={{\n              width: '10px',\n              height: '10px',\n              borderRadius: '50%',\n              backgroundColor: \n                connectionQuality === 'good' ? '#10B981' :  // Green\n                connectionQuality === 'fair' ? '#FBBF24' :  // Yellow\n                connectionQuality === 'poor' ? '#F97316' :  // Orange\n                connectionQuality === 'bad' ? '#EF4444' :   // Red\n                '#6B7280',                                  // Gray (unknown)\n              boxShadow: '0 0 4px rgba(0, 0, 0, 0.3)'\n            }}\n          />\n        )}\n      </div>\n\n      {/* Stream controls */}\n      <div\n        className=\"stream-controls\"\n        style={{\n          position: 'absolute',\n          bottom: '10px',\n          right: '10px',\n          display: 'flex',\n          gap: '10px',\n          zIndex: 5,\n          backgroundColor: 'rgba(0, 0, 0, 0.5)',\n          padding: '5px',\n          borderRadius: '4px'\n        }}\n      >\n        <div\n          style={{\n            backgroundColor: 'transparent',\n            padding: '5px',\n            borderRadius: '4px'\n          }}\n          onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.2)'}\n          onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'transparent'}\n        >\n          <SnapshotButton\n            streamId={streamId}\n            streamName={stream.name}\n            onSnapshot={() => {\n              if (videoRef.current) {\n                let canvasRef = null;\n\n                // Try to get canvas ref from detection overlay if available\n                if (detectionOverlayRef.current && typeof detectionOverlayRef.current.getCanvasRef === 'function') {\n                  canvasRef = detectionOverlayRef.current.getCanvasRef();\n                }\n\n                // Take snapshot with or without detections\n                if (canvasRef) {\n                  const snapshot = takeSnapshotWithDetections(videoRef, canvasRef, stream.name);\n                  if (snapshot) {\n                    showSnapshotPreview(snapshot.canvas.toDataURL('image/jpeg', 0.95), `Snapshot: ${stream.name}`);\n                  }\n                } else {\n                  // Take a simple snapshot without detections\n                  const videoElement = videoRef.current;\n                  const canvas = document.createElement('canvas');\n                  canvas.width = videoElement.videoWidth;\n                  canvas.height = videoElement.videoHeight;\n\n                  if (canvas.width > 0 && canvas.height > 0) {\n                    const ctx = canvas.getContext('2d');\n                    ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);\n\n                    showSnapshotPreview(canvas.toDataURL('image/jpeg', 0.95), `Snapshot: ${stream.name}`);\n                  }\n                }\n              }\n            }}\n          />\n        </div>\n        <button\n          className=\"fullscreen-btn\"\n          title=\"Toggle Fullscreen\"\n          data-id={streamId}\n          data-name={stream.name}\n          onClick={(e) => onToggleFullscreen(stream.name, e, cellRef.current)}\n          style={{\n            backgroundColor: 'transparent',\n            border: 'none',\n            padding: '5px',\n            borderRadius: '4px',\n            color: 'white',\n            cursor: 'pointer'\n          }}\n          onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.2)'}\n          onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'transparent'}\n        >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3\"></path></svg>\n        </button>\n      </div>\n\n      {/* Loading indicator */}\n      {isLoading && (\n        <div style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, zIndex: 5, pointerEvents: 'none' }}>\n          <LoadingIndicator message=\"Connecting...\" />\n        </div>\n      )}\n\n      {/* Error indicator */}\n      {error && (\n        <div\n          className=\"error-indicator\"\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            right: 0,\n            bottom: 0,\n            width: '100%',\n            height: '100%',\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'center',\n            alignItems: 'center',\n            backgroundColor: 'rgba(0, 0, 0, 0.7)',\n            color: 'white',\n            zIndex: 5,\n            textAlign: 'center'\n          }}\n        >\n          <div\n            className=\"error-content\"\n            style={{\n              display: 'flex',\n              flexDirection: 'column',\n              justifyContent: 'center',\n              alignItems: 'center',\n              width: '80%',\n              maxWidth: '300px',\n              padding: '20px',\n              borderRadius: '8px',\n              backgroundColor: 'rgba(0, 0, 0, 0.5)'\n            }}\n          >\n            <div\n              className=\"error-icon\"\n              style={{\n                fontSize: '28px',\n                marginBottom: '15px',\n                fontWeight: 'bold',\n                width: '40px',\n                height: '40px',\n                lineHeight: '40px',\n                borderRadius: '50%',\n                backgroundColor: 'rgba(220, 38, 38, 0.8)',\n                textAlign: 'center'\n              }}\n            >\n              !\n            </div>\n            <p style={{\n              marginBottom: '20px',\n              textAlign: 'center',\n              width: '100%',\n              fontSize: '14px',\n              lineHeight: '1.4'\n            }}>\n              {error}\n            </p>\n            <button\n              className=\"retry-button\"\n              onClick={handleRetry}\n              style={{\n                padding: '8px 20px',\n                backgroundColor: '#2563eb',\n                color: 'white',\n                borderRadius: '4px',\n                border: 'none',\n                cursor: 'pointer',\n                fontWeight: 'bold',\n                fontSize: '14px',\n                boxShadow: '0 2px 4px rgba(0, 0, 0, 0.2)',\n                transition: 'background-color 0.2s ease'\n              }}\n              onMouseOver={(e) => e.currentTarget.style.backgroundColor = '#1d4ed8'}\n              onMouseOut={(e) => e.currentTarget.style.backgroundColor = '#2563eb'}\n            >\n              Retry\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\n * LightNVR Web Interface WebRTCView Component\n * Preact component for the WebRTC view page\n */\n\nimport { useState, useEffect, useRef, useCallback, useMemo } from 'preact/hooks';\nimport { setupModals, addModalStyles } from './UI.jsx';\nimport { showStatusMessage } from './ToastContainer.jsx';\nimport { useFullscreenManager, FullscreenManager } from './FullscreenManager.jsx';\nimport { useQuery, useQueryClient } from '../../query-client.js';\nimport { WebRTCVideoCell } from './WebRTCVideoCell.jsx';\nimport { SnapshotManager, useSnapshotManager } from './SnapshotManager.jsx';\n\n/**\n * WebRTCView component\n * @returns {JSX.Element} WebRTCView component\n */\nexport function WebRTCView() {\n  // Use the snapshot manager hook\n  const { takeSnapshot } = useSnapshotManager();\n\n  // Use the fullscreen manager hook\n  const { isFullscreen, setIsFullscreen, toggleFullscreen } = useFullscreenManager();\n\n  // State for streams and layout\n  const [streams, setStreams] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Initialize layout from URL or sessionStorage if available\n  const [layout, setLayout] = useState(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const layoutParam = urlParams.get('layout');\n    if (layoutParam) {\n      return layoutParam;\n    }\n    // Check sessionStorage as a backup\n    const storedLayout = sessionStorage.getItem('webrtc_layout');\n    return storedLayout || '4';\n  });\n\n  // Initialize selectedStream from URL or sessionStorage if available\n  const [selectedStream, setSelectedStream] = useState(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const streamParam = urlParams.get('stream');\n    if (streamParam) {\n      return streamParam;\n    }\n    // Check sessionStorage as a backup\n    const storedStream = sessionStorage.getItem('webrtc_selected_stream');\n    return storedStream || '';\n  });\n\n  // Initialize currentPage from URL or sessionStorage if available (URL uses 1-based indexing, internal state uses 0-based)\n  const [currentPage, setCurrentPage] = useState(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const pageParam = urlParams.get('page');\n    if (pageParam) {\n      // Convert from 1-based (URL) to 0-based (internal)\n      return Math.max(0, parseInt(pageParam, 10) - 1);\n    }\n    // Check sessionStorage as a backup\n    const storedPage = sessionStorage.getItem('webrtc_current_page');\n    if (storedPage) {\n      // Convert from 1-based (stored) to 0-based (internal)\n      return Math.max(0, parseInt(storedPage, 10) - 1);\n    }\n    return 0;\n  });\n\n  // Get query client for fetching and invalidating queries\n  const queryClient = useQueryClient();\n\n  // Set up event listeners and UI components\n  useEffect(() => {\n    // Set up modals for snapshot preview\n    setupModals();\n    addModalStyles();\n  }, []);\n\n  // Fetch streams using preact-query\n  const {\n    data: streamsData,\n    isLoading: isLoadingStreams,\n    error: streamsError\n  } = useQuery(\n    'streams',\n    '/api/streams',\n    {\n      timeout: 15000, // 15 second timeout\n      retries: 2,     // Retry twice\n      retryDelay: 1000 // 1 second between retries\n    }\n  );\n\n  // Update loading state based on streams query status\n  useEffect(() => {\n    setIsLoading(isLoadingStreams);\n  }, [isLoadingStreams]);\n\n  // Process streams data when it's loaded\n  useEffect(() => {\n    if (streamsData && Array.isArray(streamsData)) {\n      // Process the streams data\n      const processStreams = async () => {\n        try {\n          // Filter and process the streams\n          const filteredStreams = await filterStreamsForWebRTC(streamsData);\n\n          if (filteredStreams.length > 0) {\n            setStreams(filteredStreams);\n\n            // Set selectedStream based on URL parameter if it exists and is valid\n            const urlParams = new URLSearchParams(window.location.search);\n            const streamParam = urlParams.get('stream');\n\n            if (streamParam && filteredStreams.some(stream => stream.name === streamParam)) {\n              // If the stream from URL exists in the loaded streams, use it\n              setSelectedStream(streamParam);\n            } else if (!selectedStream || !filteredStreams.some(stream => stream.name === selectedStream)) {\n              // Otherwise use the first stream if selectedStream is not set or invalid\n              setSelectedStream(filteredStreams[0].name);\n            }\n          } else {\n            console.warn('No streams available for WebRTC view after filtering');\n          }\n        } catch (error) {\n          console.error('Error processing streams:', error);\n          showStatusMessage('Error processing streams: ' + error.message);\n        }\n      };\n\n      processStreams();\n    }\n  }, [streamsData, selectedStream]);\n\n  // Update URL when layout, page, or selectedStream changes\n  useEffect(() => {\n    // Don't update URL during initial load or when streams are empty\n    if (streams.length === 0) return;\n\n    console.log('Updating URL parameters');\n    const url = new URL(window.location);\n\n    // Handle page parameter (convert from 0-based internal to 1-based URL)\n    if (currentPage === 0) {\n      url.searchParams.delete('page');\n    } else {\n      // Add 1 to convert from 0-based (internal) to 1-based (URL)\n      url.searchParams.set('page', currentPage + 1);\n    }\n\n    // Handle layout parameter\n    if (layout !== '4') { // Only set if not the default\n      url.searchParams.set('layout', layout);\n    } else {\n      // Remove layout parameter if it's the default value\n      url.searchParams.delete('layout');\n    }\n\n    // Handle selectedStream parameter\n    if (layout === '1' && selectedStream) {\n      url.searchParams.set('stream', selectedStream);\n    } else {\n      // Remove stream parameter if not in single stream mode\n      url.searchParams.delete('stream');\n    }\n\n    // Update URL without reloading the page\n    window.history.replaceState({}, '', url);\n\n    // Also update sessionStorage\n    if (currentPage > 0) {\n      sessionStorage.setItem('webrtc_current_page', (currentPage + 1).toString());\n    } else {\n      sessionStorage.removeItem('webrtc_current_page');\n    }\n\n    if (layout !== '4') {\n      sessionStorage.setItem('webrtc_layout', layout);\n    } else {\n      sessionStorage.removeItem('webrtc_layout');\n    }\n\n    if (layout === '1' && selectedStream) {\n      sessionStorage.setItem('webrtc_selected_stream', selectedStream);\n    } else {\n      sessionStorage.removeItem('webrtc_selected_stream');\n    }\n  }, [currentPage, layout, selectedStream, streams.length]);\n\n  /**\n   * Filter streams for WebRTC view\n   * @param {Array} streams - Array of streams\n   * @returns {Promise<Array>} Promise resolving to filtered array of streams\n   */\n  const filterStreamsForWebRTC = async (streams) => {\n    try {\n      if (!streams || !Array.isArray(streams)) {\n        console.warn('No streams data provided to filter');\n        return [];\n      }\n\n      // For WebRTC view, we need to fetch full details for each stream\n      const streamPromises = streams.map(async (stream) => {\n        try {\n          const streamId = stream.id || stream.name;\n\n          const streamDetails = await queryClient.fetchQuery({\n            queryKey: ['stream-details', streamId],\n            queryFn: async () => {\n              const response = await fetch(`/api/streams/${encodeURIComponent(streamId)}`);\n              if (!response.ok) {\n                throw new Error(`Failed to load details for stream ${stream.name}`);\n              }\n              return response.json();\n            },\n            staleTime: 30000 // 30 seconds\n          });\n\n          return streamDetails;\n        } catch (error) {\n          console.error(`Error loading details for stream ${stream.name}:`, error);\n          // Return the basic stream info if we can't get details\n          return stream;\n        }\n      });\n\n      const detailedStreams = await Promise.all(streamPromises);\n      console.log('Loaded detailed streams for WebRTC view:', detailedStreams);\n\n      // Filter out streams that are soft deleted, inactive, or not configured for streaming\n      const filteredStreams = detailedStreams.filter(stream => {\n        // Filter out soft deleted streams\n        if (stream.is_deleted) {\n          console.log(`Stream ${stream.name} is soft deleted, filtering out`);\n          return false;\n        }\n\n        // Filter out inactive streams\n        if (!stream.enabled) {\n          console.log(`Stream ${stream.name} is inactive, filtering out`);\n          return false;\n        }\n\n        // Filter out streams not configured for streaming\n        if (!stream.streaming_enabled) {\n          console.log(`Stream ${stream.name} is not configured for streaming, filtering out`);\n          return false;\n        }\n\n        return true;\n      });\n\n      console.log('Filtered streams for WebRTC view:', filteredStreams);\n\n      return filteredStreams || [];\n    } catch (error) {\n      console.error('Error filtering streams for WebRTC view:', error);\n      showStatusMessage('Error processing streams: ' + error.message);\n      return [];\n    }\n  };\n\n  /**\n   * Get maximum number of streams to display based on layout\n   * @returns {number} Maximum number of streams\n   */\n  const getMaxStreamsForLayout = useCallback(() => {\n    switch (layout) {\n      case '1': return 1;  // Single view\n      case '2': return 2;  // 2x1 grid\n      case '4': return 4;  // 2x2 grid\n      case '6': return 6;  // 2x3 grid\n      case '9': return 9;  // 3x3 grid\n      case '16': return 16; // 4x4 grid\n      default: return 4;\n    }\n  }, [layout]);\n\n  /**\n   * Get streams to show based on layout, selected stream, and pagination\n   * @returns {Array} Streams to show\n   */\n  const getStreamsToShow = useCallback(() => {\n    // Filter streams based on layout and selected stream\n    let streamsToShow = streams;\n\n    if (layout === '1' && selectedStream) {\n      streamsToShow = streams.filter(stream => stream.name === selectedStream);\n    } else {\n      // Apply pagination\n      const maxStreams = getMaxStreamsForLayout();\n      const totalPages = Math.ceil(streams.length / maxStreams);\n\n      // Ensure current page is valid\n      if (currentPage >= totalPages && totalPages > 0) {\n        return []; // Will be handled by the effect that watches currentPage\n      }\n\n      // Get streams for current page\n      const startIdx = currentPage * maxStreams;\n      const endIdx = Math.min(startIdx + maxStreams, streams.length);\n      streamsToShow = streams.slice(startIdx, endIdx);\n    }\n\n    return streamsToShow;\n  }, [streams, layout, selectedStream, currentPage]);\n\n  // Ensure current page is valid when streams or layout changes\n  useEffect(() => {\n    if (streams.length === 0) return;\n\n    const maxStreams = getMaxStreamsForLayout();\n    const totalPages = Math.ceil(streams.length / maxStreams);\n\n    if (currentPage >= totalPages) {\n      setCurrentPage(Math.max(0, totalPages - 1));\n    }\n  }, [streams, layout, currentPage, getMaxStreamsForLayout]);\n\n  /**\n   * Toggle fullscreen mode for a specific stream\n   * @param {string} streamName - Stream name\n   * @param {Event} event - Click event\n   * @param {HTMLElement} cellElement - The video cell element\n   */\n  const toggleStreamFullscreen = (streamName, event, cellElement) => {\n    // Prevent default button behavior\n    if (event) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n\n    if (!streamName) {\n      console.error('Stream name not provided for fullscreen toggle');\n      return;\n    }\n\n    console.log(`Toggling fullscreen for stream: ${streamName}`);\n\n    if (!cellElement) {\n      console.error('Video cell element not provided for fullscreen toggle');\n      return;\n    }\n\n    if (!document.fullscreenElement) {\n      console.log('Entering fullscreen mode for video cell');\n      cellElement.requestFullscreen().catch(err => {\n        console.error(`Error attempting to enable fullscreen: ${err.message}`);\n        showStatusMessage(`Could not enable fullscreen mode: ${err.message}`);\n      });\n    } else {\n      console.log('Exiting fullscreen mode');\n      document.exitFullscreen();\n    }\n\n    // Prevent event propagation\n    if (event) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  };\n\n  // Memoize the streams to show to prevent unnecessary re-renders\n  const streamsToShow = useMemo(() => getStreamsToShow(), [streams, layout, selectedStream, currentPage, getMaxStreamsForLayout]);\n\n  return (\n    <section\n      id=\"live-page\"\n      className={`page ${isFullscreen ? 'fullscreen-mode' : ''}`}\n    >\n      {/* Include the SnapshotManager component */}\n      <SnapshotManager />\n\n      {/* Include the FullscreenManager component */}\n      <FullscreenManager\n        isFullscreen={isFullscreen}\n        setIsFullscreen={setIsFullscreen}\n        targetId=\"live-page\"\n      />\n\n      <div className=\"page-header flex justify-between items-center mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow\" style={{ position: 'relative', zIndex: 10, pointerEvents: 'auto' }}>\n        <div className=\"flex items-center space-x-2\">\n          <h2 className=\"text-xl font-bold mr-4\">Live View</h2>\n          <div className=\"flex space-x-2\">\n            <button\n              id=\"hls-toggle-btn\"\n              className=\"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 inline-block text-center\"\n              style={{ position: 'relative', zIndex: 50 }} // Very high z-index to ensure clickability\n              onClick={() => {\n                window.location.href = '/hls.html';\n              }}\n            >\n              HLS View\n            </button>\n          </div>\n        </div>\n        <div className=\"controls flex items-center space-x-2\">\n          <div className=\"flex items-center\">\n            <label htmlFor=\"layout-selector\" className=\"mr-2\">Layout:</label>\n            <select\n              id=\"layout-selector\"\n              className=\"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600\"\n              value={layout}\n              onChange={(e) => {\n                const newLayout = e.target.value;\n                setLayout(newLayout);\n                setCurrentPage(0); // Reset to first page when layout changes\n              }}\n            >\n              <option value=\"1\">1 Stream</option>\n              <option value=\"2\">2 Streams</option>\n              <option value=\"4\">4 Streams</option>\n              <option value=\"6\">6 Streams</option>\n              <option value=\"9\">9 Streams</option>\n              <option value=\"16\">16 Streams</option>\n            </select>\n          </div>\n\n          {layout === '1' && (\n            <div className=\"flex items-center\">\n              <label htmlFor=\"stream-selector\" className=\"mr-2\">Stream:</label>\n              <select\n                id=\"stream-selector\"\n                className=\"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600\"\n                value={selectedStream}\n                onChange={(e) => {\n                  const newStream = e.target.value;\n                  setSelectedStream(newStream);\n                }}\n              >\n                {streams.map(stream => (\n                  <option key={stream.name} value={stream.name}>{stream.name}</option>\n                ))}\n              </select>\n            </div>\n          )}\n\n          <button\n            id=\"fullscreen-btn\"\n            className=\"p-2 rounded-full bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none\"\n            onClick={() => toggleFullscreen()}\n            title=\"Toggle Fullscreen\"\n          >\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\"\n                 stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n              <path\n                d=\"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3\"></path>\n            </svg>\n          </button>\n        </div>\n      </div>\n\n      <div className=\"flex flex-col space-y-4 h-full\">\n        <div\n          id=\"video-grid\"\n          className={`video-container layout-${layout}`}\n        >\n          {isLoadingStreams ? (\n              <div className=\"flex justify-center items-center col-span-full row-span-full h-64 w-full\" style={{ pointerEvents: 'none', zIndex: 1 }}>\n                <div className=\"flex flex-col items-center justify-center py-8\">\n                <div\n                  className=\"inline-block animate-spin rounded-full border-4 border-gray-300 dark:border-gray-600 border-t-blue-600 dark:border-t-blue-500 w-16 h-16\"></div>\n                <p className=\"mt-4 text-gray-700 dark:text-gray-300\">Loading streams...</p>\n              </div>\n            </div>\n          ) : (isLoading && !isLoadingStreams) ? (\n            <div\n                className=\"flex justify-center items-center col-span-full row-span-full h-64 w-full\"\n                style={{\n                  pointerEvents: 'none',\n                  position: 'relative',\n                  zIndex: 1\n                }}\n            >\n              <div className=\"flex flex-col items-center justify-center py-8\">\n                <div\n                  className=\"inline-block animate-spin rounded-full border-4 border-gray-300 dark:border-gray-600 border-t-blue-600 dark:border-t-blue-500 w-16 h-16\"></div>\n                <p className=\"mt-4 text-gray-700 dark:text-gray-300\">Loading streams...</p>\n              </div>\n            </div>\n          ) : (streamsError) ? (\n            <div className=\"placeholder flex flex-col justify-center items-center col-span-full row-span-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-center p-8\">\n              <p className=\"mb-6 text-gray-600 dark:text-gray-300 text-lg\">Error loading streams: {streamsError.message}</p>\n              <button\n                onClick={() => window.location.reload()}\n                className=\"btn-primary px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\n              >\n                Retry\n              </button>\n            </div>\n          ) : streams.length === 0 ? (\n            <div className=\"placeholder flex flex-col justify-center items-center col-span-full row-span-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-center p-8\">\n              <p className=\"mb-6 text-gray-600 dark:text-gray-300 text-lg\">No streams configured</p>\n              <a href=\"streams.html\" className=\"btn-primary px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\">Configure Streams</a>\n            </div>\n          ) : (\n            // Render video cells using our self-contained WebRTCVideoCell component\n            streamsToShow.map(stream => (\n              <WebRTCVideoCell\n                key={stream.name}\n                stream={stream}\n                onToggleFullscreen={toggleStreamFullscreen}\n                streamId={stream.name} // Add explicit streamId prop to prevent re-renders\n              />\n            ))\n          )}\n        </div>\n\n        {layout !== '1' && streams.length > getMaxStreamsForLayout() ? (\n          <div className=\"pagination-controls flex justify-center items-center space-x-4 mt-4\">\n            <button\n              className=\"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed\"\n              onClick={() => {\n                console.log('Changing to previous page');\n                setCurrentPage(Math.max(0, currentPage - 1));\n              }}\n              disabled={currentPage === 0}\n            >\n              Previous\n            </button>\n\n            <span className=\"text-gray-700 dark:text-gray-300\">\n              Page {currentPage + 1} of {Math.ceil(streams.length / getMaxStreamsForLayout())}\n            </span>\n\n            <button\n              className=\"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed\"\n              onClick={() => {\n                console.log('Changing to next page');\n                const totalPages = Math.ceil(streams.length / getMaxStreamsForLayout());\n                setCurrentPage(Math.min(totalPages - 1, currentPage + 1));\n              }}\n              disabled={currentPage >= Math.ceil(streams.length / getMaxStreamsForLayout()) - 1}\n            >\n              Next\n            </button>\n          </div>\n        ) : null}\n      </div>\n    </section>\n  );\n}\n","/**\n * LightNVR Web Interface Live View Page\n * Entry point for the live view page with WebRTC/HLS support\n */\n\nimport { render } from 'preact';\nimport { useState, useEffect } from 'preact/hooks';\nimport { LiveView } from '../components/preact/LiveView.jsx';\nimport { WebRTCView } from '../components/preact/WebRTCView.jsx';\nimport { QueryClientProvider, queryClient } from '../query-client.js';\nimport { Header } from \"../components/preact/Header.jsx\";\nimport { Footer } from \"../components/preact/Footer.jsx\";\nimport { ToastContainer } from \"../components/preact/ToastContainer.jsx\";\n\n/**\n * Main App component that conditionally renders WebRTCView or LiveView\n * based on whether WebRTC is disabled in settings\n */\nfunction App() {\n    const [isWebRTCDisabled, setIsWebRTCDisabled] = useState(false);\n    const [isLoading, setIsLoading] = useState(true);\n\n    useEffect(() => {\n        // Check if WebRTC is disabled in settings\n        async function checkWebRTCStatus() {\n            try {\n                const response = await fetch('/api/settings');\n                if (!response.ok) {\n                    console.error('Failed to fetch settings:', response.status, response.statusText);\n                    setIsLoading(false);\n                    return;\n                }\n\n                const settings = await response.json();\n                \n                if (settings.webrtc_disabled) {\n                    console.log('WebRTC is disabled, using HLS view');\n                    setIsWebRTCDisabled(true);\n                } else {\n                    console.log('WebRTC is enabled, using WebRTC view');\n                    setIsWebRTCDisabled(false);\n                }\n            } catch (error) {\n                console.error('Error checking WebRTC status:', error);\n            } finally {\n                setIsLoading(false);\n            }\n        }\n\n        checkWebRTCStatus();\n    }, []);\n\n    if (isLoading) {\n        return <div className=\"loading\">Loading...</div>;\n    }\n\n    return (\n            <>{isWebRTCDisabled ? <LiveView isWebRTCDisabled={true} /> : <WebRTCView />}</>\n    );\n}\n\n// Render the App component when the DOM is loaded\ndocument.addEventListener('DOMContentLoaded', () => {\n    // Get the container element\n    const container = document.getElementById('main-content');\n\n    if (container) {\n        render(\n            <QueryClientProvider client={queryClient}>\n                <Header />\n                <ToastContainer />\n                <App />\n                <Footer />\n            </QueryClientProvider>,\n            container\n        );\n    }\n});\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n// Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\nimport * as sdp from 'sdp';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings,\n    // Expose sdp as a convenience. For production apps include directly.\n    sdp,\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      if (browserDetails.version === null) {\n        logging('Chrome shim can not determine version, not shimming.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      chromeShim.shimGetUserMedia(window, browserDetails);\n      chromeShim.shimMediaStream(window, browserDetails);\n      chromeShim.shimPeerConnection(window, browserDetails);\n      chromeShim.shimOnTrack(window, browserDetails);\n      chromeShim.shimAddTrackRemoveTrack(window, browserDetails);\n      chromeShim.shimGetSendersWithDtmf(window, browserDetails);\n      chromeShim.shimSenderReceiverGetStats(window, browserDetails);\n      chromeShim.fixNegotiationNeeded(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      firefoxShim.shimGetUserMedia(window, browserDetails);\n      firefoxShim.shimPeerConnection(window, browserDetails);\n      firefoxShim.shimOnTrack(window, browserDetails);\n      firefoxShim.shimRemoveStream(window, browserDetails);\n      firefoxShim.shimSenderGetStats(window, browserDetails);\n      firefoxShim.shimReceiverGetStats(window, browserDetails);\n      firefoxShim.shimRTCDataChannel(window, browserDetails);\n      firefoxShim.shimAddTransceiver(window, browserDetails);\n      firefoxShim.shimGetParameters(window, browserDetails);\n      firefoxShim.shimCreateOffer(window, browserDetails);\n      firefoxShim.shimCreateAnswer(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      // Must be called before shimCallbackAPI.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      safariShim.shimRTCIceServerUrls(window, browserDetails);\n      safariShim.shimCreateOfferLegacy(window, browserDetails);\n      safariShim.shimCallbacksAPI(window, browserDetails);\n      safariShim.shimLocalStreamsAPI(window, browserDetails);\n      safariShim.shimRemoteStreamsAPI(window, browserDetails);\n      safariShim.shimTrackEventTransceiver(window, browserDetails);\n      safariShim.shimGetUserMedia(window, browserDetails);\n      safariShim.shimAudioContext(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nimport {adapterFactory} from './adapter_factory.js';\n\nconst adapter =\n  adapterFactory({window: typeof window === 'undefined' ? undefined : window});\nexport default adapter;\n"],"names":["logDisabled_","deprecationWarnings_","extractVersion","uastring","expr","pos","match","length","parseFloat","wrapPeerConnectionEvent","window","eventNameToWrap","wrapper","RTCPeerConnection","proto","prototype","nativeAddEventListener","addEventListener","nativeEventName","cb","apply","this","arguments","wrappedCallback","e","modifiedEvent","handleEvent","_eventMap","Map","set","nativeRemoveEventListener","removeEventListener","has","unwrappedCb","get","delete","size","Object","keys","defineProperty","enumerable","configurable","disableLog","bool","Error","disableWarnings","log","console","deprecated","oldMethod","newMethod","warn","isObject","val","toString","call","compactObject","data","reduce","accumulator","key","isObj","value","isEmptyObject","undefined","assign","walkStats","stats","base","resultSet","id","forEach","name","endsWith","filterStats","result","track","outbound","streamStatsType","filteredResult","trackStats","type","trackIdentifier","push","trackStat","trackId","logging","utils.log","shimGetUserMedia","browserDetails","navigator","mediaDevices","constraintsToChrome_","c","mandatory","optional","cc","r","ideal","exact","min","max","oldname_","prefix","charAt","toUpperCase","slice","oc","mix","advanced","concat","shimConstraints_","constraints","func","version","JSON","parse","stringify","audio","remap","obj","a","b","video","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","matches","enumerateDevices","then","devices","filter","d","kind","dev","find","some","label","toLowerCase","includes","deviceId","shimError_","PermissionDeniedError","PermissionDismissedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","message","constraint","constraintName","getUserMedia","onSuccess","onError","webkitGetUserMedia","bind","origGetUserMedia","cs","stream","getAudioTracks","getVideoTracks","getTracks","stop","DOMException","Promise","reject","shimMediaStream","MediaStream","webkitMediaStream","shimOnTrack","_ontrack","f","origSetRemoteDescription","setRemoteDescription","_ontrackpoly","te","receiver","getReceivers","event","Event","transceiver","streams","dispatchEvent","utils.wrapPeerConnectionEvent","shimGetSendersWithDtmf","shimSenderWithDtmf","pc","dtmf","_dtmf","createDTMFSender","_pc","getSenders","_senders","origAddTrack","addTrack","sender","origRemoveTrack","removeTrack","idx","indexOf","splice","origAddStream","addStream","origRemoveStream","removeStream","s","RTCRtpSender","origGetSenders","senders","shimSenderReceiverGetStats","RTCRtpReceiver","getStats","utils.filterStats","origGetReceivers","receivers","srcElement","origGetStats","MediaStreamTrack","err","shimAddTrackRemoveTrackWithNative","getLocalStreams","_shimmedLocalStreams","map","streamId","existingSenders","newSenders","newSender","shimAddTrackRemoveTrack","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","replaceInternalStreamId","description","sdp","internalId","externalStream","internalStream","replace","RegExp","RTCSessionDescription","signalingState","t","oldStream","resolve","method","nativeMethod","methodObj","args","desc","origSetLocalDescription","setLocalDescription","replaceExternalStreamId","origLocalDescription","getOwnPropertyDescriptor","streamid","shimPeerConnection","webkitRTCPeerConnection","RTCIceCandidate","fixNegotiationNeeded","target","getConfiguration","sdpSemantics","utils.deprecated","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","RTCTrackEvent","mozRTCPeerConnection","modernStatsTypes","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","nativeGetStats","selector","onSucc","onErr","stat","i","shimSenderGetStats","shimReceiverGetStats","shimRemoveStream","shimRTCDataChannel","DataChannel","RTCDataChannel","shimAddTransceiver","origAddTransceiver","addTransceiver","setParametersPromises","sendEncodings","shouldPerformCheck","encodingParam","test","rid","TypeError","scaleResolutionDownBy","RangeError","maxFramerate","params","getParameters","encodings","setParameters","catch","shimGetParameters","origGetParameters","shimCreateOffer","origCreateOffer","createOffer","all","finally","shimCreateAnswer","origCreateAnswer","createAnswer","preferredMediaSource","getDisplayMedia","code","mediaSource","shimLocalStreamsAPI","_localStreams","_addTrack","index","tracks","shimRemoteStreamsAPI","getRemoteStreams","_remoteStreams","_onaddstream","_onaddstreampoly","shimCallbacksAPI","addIceCandidate","successCallback","failureCallback","options","promise","withCallback","candidate","_getUserMedia","shimConstraints","errcb","utils.compactObject","shimRTCIceServerUrls","OrigPeerConnection","pcConfig","pcConstraints","iceServers","newIceServers","server","urls","url","generateCertificate","shimTrackEventTransceiver","shimCreateOfferLegacy","offerOptions","offerToReceiveAudio","audioTransceiver","getTransceivers","direction","setDirection","offerToReceiveVideo","videoTransceiver","shimAudioContext","AudioContext","webkitAudioContext","SDPUtils","Math","random","substring","localCName","generateIdentifier","splitLines","blob","trim","split","line","splitSections","part","getDescription","sections","getMediaSections","shift","matchPrefix","parseCandidate","parts","foundation","component","protocol","priority","parseInt","ip","address","port","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","writeCandidate","join","parseIceOptions","parseRtpMap","parsed","payloadType","clockRate","channels","numChannels","writeRtpMap","codec","pt","preferredPayloadType","parseExtmap","uri","attributes","writeExtmap","headerExtension","preferredId","parseFmtp","kv","j","writeFmtp","parameters","param","parseRtcpFb","parameter","writeRtcpFb","lines","rtcpFeedback","fb","parseSsrcMedia","sp","ssrc","colon","attribute","parseSsrcGroup","semantics","ssrcs","getMid","mediaSection","mid","parseFingerprint","algorithm","getDtlsParameters","sessionpart","role","fingerprints","writeDtlsParameters","setupType","fp","parseCryptoLine","tag","cryptoSuite","keyParams","sessionParams","writeCryptoLine","writeCryptoKeyParams","parseCryptoKeyParams","keyMethod","keySalt","lifeTime","mkiValue","mkiLength","getCryptoParameters","getIceParameters","pwd","password","writeIceParameters","iceLite","parseRtpParameters","codecs","headerExtensions","fecMechanisms","rtcp","mline","profile","rtpmapline","fmtps","wildcardRtcpFb","existingFeedback","writeRtpDescription","caps","maxptime","extension","parseRtpEncodingParameters","encodingParameters","hasRed","hasUlpfec","primarySsrc","secondarySsrc","flows","apt","encParam","codecPayloadType","rtx","fec","mechanism","bandwidth","maxBitrate","parseRtcpParameters","rtcpParameters","remoteSsrc","cname","rsize","reducedSize","compound","mux","writeRtcpParameters","parseMsid","spec","planB","msidParts","parseSctpDescription","parseMLine","maxSizeLine","maxMessageSize","isNaN","sctpPort","fmt","sctpMapLines","writeSctpDescription","media","sctp","output","generateSessionId","substr","writeSessionBoilerplate","sessId","sessVer","sessUser","sessionId","getDirection","getKind","isRejected","parseOLine","username","sessionVersion","netType","addressType","isValidSDP","module","shimRTCIceCandidate","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","toJSON","sdpMid","sdpMLineIndex","writable","shimRTCIceCandidateRelayProtocol","relayProtocol","shimMaxMessageSize","_sctp","browser","mLine","sctpInDescription","isFirefox","getRemoteFirefoxVersion","canSendMMS","remoteIsFirefox","canSendMaxMessageSize","getCanSendMaxMessageSize","remoteMMS","getMaxMessageSize","Number","POSITIVE_INFINITY","shimSendThrowTypeError","wrapDcSend","dc","origDataChannelSend","send","byteLength","readyState","origCreateDataChannel","createDataChannel","dataChannel","channel","shimConnectionState","completed","checking","iceConnectionState","_onconnectionstatechange","origMethod","_connectionstatechangepoly","_lastConnectionState","connectionState","newEvent","removeExtmapAllowMixed","_safariVersion","nativeSRD","shimAddIceCandidateNullOrEmpty","nativeAddIceCandidate","shimParameterlessSetLocalDescription","nativeSetLocalDescription","WebRTCVideoCell","onToggleFullscreen","isLoading","setIsLoading","useState","error","setError","isPlaying","setIsPlaying","connectionQuality","setConnectionQuality","videoRef","useRef","cellRef","peerConnectionRef","detectionOverlayRef","abortControllerRef","connectionMonitorRef","reconnectAttemptsRef","useEffect","current","iceTransports","bundlePolicy","rtcpCnameCpn","rtcpCnameRtp","iceCandidatePoolSize","ontrack","videoElement","srcObject","onloadeddata","onplaying","onerror","oniceconnectionstatechange","setTimeout","offer","AbortController","formattedOffer","localDescription","auth","localStorage","getItem","fetch","encodeURIComponent","headers","Authorization","body","response","ok","status","statusText","text","answer","startConnectionMonitoring","clearInterval","setInterval","packetsLost","packetsReceived","currentRtt","jitter","report","state","currentRoundTripTime","totalPackets","lossPercentage","quality","toFixed","originalOnIceConnectionStateChange","abort","close","jsxs","className","ref","style","position","pointerEvents","zIndex","children","jsx","autoPlay","muted","disablePictureInPicture","playsInline","width","height","objectFit","detection_based_recording","detection_model","DetectionOverlay","streamName","enabled","detectionModel","top","left","padding","backgroundColor","color","borderRadius","fontSize","display","alignItems","gap","title","boxShadow","bottom","right","onMouseOver","currentTarget","onMouseOut","SnapshotButton","onSnapshot","canvasRef","getCanvasRef","snapshot","takeSnapshotWithDetections","showSnapshotPreview","canvas","toDataURL","document","createElement","videoWidth","videoHeight","getContext","drawImage","onClick","border","cursor","xmlns","viewBox","fill","stroke","LoadingIndicator","flexDirection","justifyContent","textAlign","maxWidth","marginBottom","fontWeight","lineHeight","handleRetry","transition","WebRTCView","takeSnapshot","useSnapshotManager","isFullscreen","setIsFullscreen","toggleFullscreen","useFullscreenManager","setStreams","layout","setLayout","layoutParam","URLSearchParams","location","search","sessionStorage","selectedStream","setSelectedStream","streamParam","currentPage","setCurrentPage","pageParam","storedPage","queryClient","useQueryClient","setupModals","addModalStyles","streamsData","isLoadingStreams","streamsError","useQuery","timeout","retries","retryDelay","Array","isArray","async","filteredStreams","filterStreamsForWebRTC","showStatusMessage","processStreams","URL","searchParams","history","replaceState","setItem","removeItem","streamPromises","fetchQuery","queryKey","queryFn","json","staleTime","detailedStreams","is_deleted","streaming_enabled","getMaxStreamsForLayout","useCallback","getStreamsToShow","streamsToShow","maxStreams","totalPages","ceil","startIdx","endIdx","toggleStreamFullscreen","cellElement","preventDefault","stopPropagation","fullscreenElement","exitFullscreen","requestFullscreen","useMemo","SnapshotManager","FullscreenManager","targetId","href","htmlFor","onChange","newLayout","strokeWidth","strokeLinecap","strokeLinejoin","reload","disabled","App","isWebRTCDisabled","setIsWebRTCDisabled","webrtc_disabled","checkWebRTCStatus","Fragment","LiveView","shimChrome","shimFirefox","shimSafari","userAgent","userAgentData","brands","chromium","brand","mozGetUserMedia","isSecureContext","supportsUnifiedPlan","RTCRtpTransceiver","utils.detectBrowser","adapter","commonShim","utils.extractVersion","utils.disableLog","utils.disableWarnings","chromeShim","chromeShim.shimPeerConnection","browserShim","commonShim.shimAddIceCandidateNullOrEmpty","commonShim.shimParameterlessSetLocalDescription","chromeShim.shimGetUserMedia","chromeShim.shimMediaStream","chromeShim.shimOnTrack","chromeShim.shimAddTrackRemoveTrack","chromeShim.shimGetSendersWithDtmf","chromeShim.shimSenderReceiverGetStats","chromeShim.fixNegotiationNeeded","commonShim.shimRTCIceCandidate","commonShim.shimRTCIceCandidateRelayProtocol","commonShim.shimConnectionState","commonShim.shimMaxMessageSize","commonShim.shimSendThrowTypeError","commonShim.removeExtmapAllowMixed","firefoxShim","firefoxShim.shimPeerConnection","firefoxShim.shimGetUserMedia","firefoxShim.shimOnTrack","firefoxShim.shimRemoveStream","firefoxShim.shimSenderGetStats","firefoxShim.shimReceiverGetStats","firefoxShim.shimRTCDataChannel","firefoxShim.shimAddTransceiver","firefoxShim.shimGetParameters","firefoxShim.shimCreateOffer","firefoxShim.shimCreateAnswer","safariShim","safariShim.shimRTCIceServerUrls","safariShim.shimCreateOfferLegacy","safariShim.shimCallbacksAPI","safariShim.shimLocalStreamsAPI","safariShim.shimRemoteStreamsAPI","safariShim.shimTrackEventTransceiver","safariShim.shimGetUserMedia","safariShim.shimAudioContext","adapterFactory","container","getElementById","render","QueryClientProvider","client","Header","ToastContainer","Footer"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,12,13]}