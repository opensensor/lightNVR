const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./preact-app-3DvZ3cMn.js","../css/preact-app.css"])))=>i.map(i=>d[i]);
var Z=Object.freeze,Ue=Object.defineProperty;var v=(e,t)=>Z(Ue(e,"raw",{value:Z(t||e.slice())}));import{h as $,f as W,g as Be,i as He,u as B,c as u,j as I,k as H,d as D,A as We,y as P,D as Ve,_ as ee,l as je}from"./preact-app-3DvZ3cMn.js";import{C as Ne}from"./LoadingIndicator-Bowha-dN.js";var te,re;function qe({filters:e,setFilters:t,pagination:a,setPagination:s,streams:r,filtersVisible:l,applyFilters:n,resetFilters:c,handleDateRangeChange:p,setDefaultDateRange:f}){return $(re||(re=v(['\n    <aside id="filters-sidebar" \n           class=','>\n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Date Range</h3>\n        <div class="filter-option mb-2">\n          <label for="date-range-select" class="block mb-1 text-sm font-medium">Quick Select:</label>\n          <select id="date-range-select" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="today">Today</option>\n            <option value="yesterday">Yesterday</option>\n            <option value="last7days">Last 7 Days</option>\n            <option value="last30days">Last 30 Days</option>\n            <option value="custom">Custom Range</option>\n          </select>\n        </div>\n        \n        <div id="custom-date-range" \n             class="filter-option space-y-3"\n             style=','>\n          <div class="space-y-1">\n            <label for="start-date" class="block text-sm font-medium">Start Date:</label>\n            <input type="date" id="start-date" \n                   class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                   value=',"\n                   onChange=",' />\n            <div class="mt-1">\n              <label for="start-time" class="block text-sm font-medium">Time:</label>\n              <input type="time" id="start-time" \n                     class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                     value=',"\n                     onChange=",' />\n            </div>\n          </div>\n          \n          <div class="space-y-1">\n            <label for="end-date" class="block text-sm font-medium">End Date:</label>\n            <input type="date" id="end-date" \n                   class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                   value=',"\n                   onChange=",' />\n            <div class="mt-1">\n              <label for="end-time" class="block text-sm font-medium">Time:</label>\n              <input type="time" id="end-time" \n                     class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                     value=',"\n                     onChange=",' />\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Stream</h3>\n        <div class="filter-option">\n          <select id="stream-filter" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="all">All Streams</option>\n            ','\n          </select>\n        </div>\n      </div>\n      \n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Recording Type</h3>\n        <div class="filter-option">\n          <select id="detection-filter" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="all">All Recordings</option>\n            <option value="detection">Detection Events Only</option>\n          </select>\n        </div>\n      </div>\n      \n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Display Options</h3>\n        <div class="filter-option">\n          <label for="page-size" class="block mb-1 text-sm font-medium">Items per page:</label>\n          <select id="page-size" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="10">10</option>\n            <option value="20">20</option>\n            <option value="50">50</option>\n            <option value="100">100</option>\n          </select>\n        </div>\n      </div>\n      \n      <div class="filter-actions flex space-x-2">\n        <button id="apply-filters-btn" \n                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"\n                onClick=','>\n          Apply Filters\n        </button>\n        <button id="reset-filters-btn" \n                class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"\n                onClick=',">\n          Reset\n        </button>\n      </div>\n    </aside>\n  "])),"filters-sidebar w-full md:w-64 bg-white dark:bg-gray-800 rounded-lg shadow p-4 md:sticky md:top-4 md:self-start transition-all duration-300 ".concat(l?"":"hidden md:block"),e.dateRange,p,e.dateRange==="custom"?"display: block":"display: none",e.startDate,d=>t(m=>({...m,startDate:d.target.value})),e.startTime,d=>t(m=>({...m,startTime:d.target.value})),e.endDate,d=>t(m=>({...m,endDate:d.target.value})),e.endTime,d=>t(m=>({...m,endTime:d.target.value})),e.streamId,d=>t(m=>({...m,streamId:d.target.value})),r.map(d=>$(te||(te=v(["\n              <option key="," value=",">","</option>\n            "])),d.name,d.name,d.name)),e.recordingType,d=>t(m=>({...m,recordingType:d.target.value})),a.pageSize,d=>s(m=>({...m,pageSize:parseInt(d.target.value,10)})),n,c)}var ae,oe;function Ke({activeFiltersDisplay:e,removeFilter:t,hasActiveFilters:a}){return a?$(oe||(oe=v(['\n    <div id="active-filters" \n         class="active-filters mb-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex flex-wrap gap-2">\n      ',"\n    </div>\n  "])),e.map((s,r)=>$(ae||(ae=v(["\n        <div key=",' class="filter-tag inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-200">\n          <span>','</span>\n          <button class="ml-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 focus:outline-none"\n                  onClick=',">\n            ×\n          </button>\n        </div>\n      "])),r,s.label,()=>t(s.key)))):null}const V={formatDateTime:e=>e?new Date(e).toLocaleString():"",formatDuration:e=>{if(!e)return"00:00:00";const t=Math.floor(e/3600),a=Math.floor(e%3600/60),s=Math.floor(e%60);return[t.toString().padStart(2,"0"),a.toString().padStart(2,"0"),s.toString().padStart(2,"0")].join(":")},formatFileSize:e=>{if(!e)return"0 B";const t=["B","KB","MB","GB","TB"];let a=0,s=e;for(;s>=1024&&a<t.length-1;)s/=1024,a++;return"".concat(s.toFixed(1)," ").concat(t[a])}};var se,ne,ie,de,le,ce,ge;function Qe({recordings:e,sortField:t,sortDirection:a,sortBy:s,selectedRecordings:r,toggleRecordingSelection:l,selectAll:n,toggleSelectAll:c,getSelectedCount:p,openDeleteModal:f,playRecording:d,downloadRecording:m,deleteRecording:b,recordingsTableBodyRef:x,pagination:A}){return $(ge||(ge=v(['\n    <div class="recordings-container bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden w-full">\n      <div class="batch-actions p-3 border-b border-gray-200 dark:border-gray-700 flex flex-wrap gap-2 items-center">\n        <div class="selected-count text-sm text-gray-600 dark:text-gray-400 mr-2">\n          ','\n        </div>\n        <button \n          class="px-3 py-1.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"\n          disabled=',"\n          onClick=",'>\n          Delete Selected\n        </button>\n        <button \n          class="px-3 py-1.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"\n          onClick=','>\n          Delete All Filtered\n        </button>\n      </div>\n      <div class="overflow-x-auto">\n        <table id="recordings-table" class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">\n          <thead class="bg-gray-50 dark:bg-gray-700">\n            <tr>\n              <th class="w-10 px-4 py-3">\n                <input \n                  type="checkbox" \n                  checked=',"\n                  onChange=",'\n                  class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"\n                />\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer"\n                  onClick=','>\n                <div class="flex items-center">\n                  Stream\n                  ','\n                </div>\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer"\n                  onClick=','>\n                <div class="flex items-center">\n                  Start Time\n                  ','\n                </div>\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">\n                Duration\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer"\n                  onClick=','>\n                <div class="flex items-center">\n                  Size\n                  ','\n                </div>\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">\n                Detections\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">\n                Actions\n              </th>\n            </tr>\n          </thead>\n          <tbody ref=',' class="bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700">\n            ',"\n          </tbody>\n        </table>\n      </div>\n    </div>\n  "])),p()>0?"".concat(p()," recording").concat(p()!==1?"s":""," selected"):"No recordings selected",p()===0,()=>f("selected"),()=>f("all"),n,c,()=>s("stream_name"),t==="stream_name"&&$(se||(se=v(['\n                    <span class="sort-icon ml-1">',"</span>\n                  "])),a==="asc"?"▲":"▼"),()=>s("start_time"),t==="start_time"&&$(ne||(ne=v(['\n                    <span class="sort-icon ml-1">',"</span>\n                  "])),a==="asc"?"▲":"▼"),()=>s("size_bytes"),t==="size_bytes"&&$(ie||(ie=v(['\n                    <span class="sort-icon ml-1">',"</span>\n                  "])),a==="asc"?"▲":"▼"),x,e.length===0?$(de||(de=v(['\n              <tr>\n                <td colspan="6" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">\n                  ',"\n                </td>\n              </tr>\n            "])),A.totalItems===0?"No recordings found":"Loading recordings..."):e.map(k=>$(ce||(ce=v(["\n              <tr key=",' class="hover:bg-gray-50 dark:hover:bg-gray-700">\n                <td class="px-4 py-4 whitespace-nowrap">\n                  <input \n                    type="checkbox" \n                    checked=',"\n                    onChange=",'\n                    class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"\n                  />\n                </td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">\n                  ','\n                </td>\n                <td class="px-6 py-4 whitespace-nowrap">\n                  <div class="flex space-x-2">\n                    <button class="p-1 rounded-full text-blue-600 hover:bg-blue-100 dark:text-blue-400 dark:hover:bg-blue-900 focus:outline-none"\n                            onClick=','\n                            title="Play">\n                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>\n                      </svg>\n                    </button>\n                    <button class="p-1 rounded-full text-green-600 hover:bg-green-100 dark:text-green-400 dark:hover:bg-green-900 focus:outline-none"\n                            onClick=','\n                            title="Download">\n                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>\n                      </svg>\n                    </button>\n                    <button class="p-1 rounded-full text-red-600 hover:bg-red-100 dark:text-red-400 dark:hover:bg-red-900 focus:outline-none"\n                            onClick=','\n                            title="Delete">\n                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>\n                      </svg>\n                    </button>\n                  </div>\n                </td>\n              </tr>\n            '])),k.id,!!r[k.id],()=>l(k.id),k.stream||"",V.formatDateTime(k.start_time),V.formatDuration(k.duration),k.size||"",k.has_detections?$(le||(le=v(['\n                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100">\n                      <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>\n                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>\n                      </svg>\n                      Yes\n                    </span>\n                  ']))):"",()=>d(k),()=>m(k),()=>b(k))))}var ue;function Ye({pagination:e,goToPage:t}){return $(ue||(ue=v(['\n    <div class="pagination-controls flex flex-col sm:flex-row justify-between items-center p-4 border-t border-gray-200 dark:border-gray-700">\n      <div class="pagination-info text-sm text-gray-600 dark:text-gray-400 mb-2 sm:mb-0">\n        Showing <span id="pagination-showing">',"-",'</span> of <span id="pagination-total">','</span> recordings\n      </div>\n      <div class="pagination-buttons flex items-center space-x-1">\n        <button id="pagination-first" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="First Page"\n                onClick=',"\n                disabled=",'>\n          «\n        </button>\n        <button id="pagination-prev" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="Previous Page"\n                onClick=',"\n                disabled=",'>\n          ‹\n        </button>\n        <span id="pagination-current" class="px-2 text-sm text-gray-700 dark:text-gray-300">\n          Page '," of ",'\n        </span>\n        <button id="pagination-next" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="Next Page"\n                onClick=',"\n                disabled=",'>\n          ›\n        </button>\n        <button id="pagination-last" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="Last Page"\n                onClick=',"\n                disabled=",">\n          »\n        </button>\n      </div>\n    </div>\n  "])),e.startItem,e.endItem,e.totalItems,()=>t(1),e.currentPage===1,()=>t(e.currentPage-1),e.currentPage===1,e.currentPage,e.totalPages,()=>t(e.currentPage+1),e.currentPage===e.totalPages,()=>t(e.totalPages),e.currentPage===e.totalPages)}const w={hooks:{useStreams:()=>B("streams","/api/streams",{timeout:15e3,retries:2,retryDelay:1e3}),useRecordings:(e,t,a,s)=>{const r=new URLSearchParams;if(r.append("page",t.currentPage),r.append("limit",t.pageSize),r.append("sort",a),r.append("order",s),e.dateRange==="custom")r.append("start","".concat(e.startDate,"T").concat(e.startTime,":00")),r.append("end","".concat(e.endDate,"T").concat(e.endTime,":00"));else{const{start:n,end:c}=w.getDateRangeFromPreset(e.dateRange);r.append("start",n),r.append("end",c)}return e.streamId!=="all"&&r.append("stream",e.streamId),e.recordingType==="detection"&&r.append("detection","1"),B(["recordings",e,t,a,s],"/api/recordings?".concat(r.toString()),{timeout:3e4,retries:2,retryDelay:1e3},{onSuccess:n=>{n.recordings&&n.recordings.length>0&&n.recordings.forEach(c=>{c.has_detections=!1})}})},useRecordingDetections:e=>{if(!e||!e.id||!e.stream||!e.start_time||!e.end_time)return{data:{detections:[]}};const t=Math.floor(new Date(e.start_time).getTime()/1e3),a=Math.floor(new Date(e.end_time).getTime()/1e3),s=new URLSearchParams({start:t,end:a});return B(["recording-detections",e.id],"/api/detection/results/".concat(e.stream,"?").concat(s.toString()),{timeout:15e3,retries:1,retryDelay:1e3},{enabled:!!e.id})},useDeleteRecording:()=>{const e=W();return He({mutationFn:async t=>{const a="/api/recordings/".concat(t);return await I(a,{method:"DELETE",timeout:15e3,retries:1,retryDelay:1e3})},onSuccess:()=>{e.invalidateQueries({queryKey:["recordings"]}),u("Recording deleted successfully")},onError:t=>{console.error("Error deleting recording:",t),u("Error deleting recording: "+t.message)}})},useBatchDeleteRecordings:()=>{const e=W();return Be("/api/recordings/batch-delete",{timeout:6e4,retries:1,retryDelay:2e3},{onSuccess:t=>{e.invalidateQueries({queryKey:["recordings"]});const a=t.succeeded,s=t.failed;a>0&&s===0?u("Successfully deleted ".concat(a," recording").concat(a!==1?"s":"")):a>0&&s>0?u("Deleted ".concat(a," recording").concat(a!==1?"s":"",", but failed to delete ").concat(s)):u("Failed to delete ".concat(s," recording").concat(s!==1?"s":""))},onError:t=>{console.error("Error in batch delete operation:",t),u("Error in batch delete operation: "+t.message)}})}},loadStreams:async()=>{try{return await I("/api/streams",{timeout:15e3,retries:2,retryDelay:1e3})||[]}catch(e){return console.error("Error loading streams for filter:",e),u("Error loading streams: "+e.message),[]}},getDateRangeFromPreset:e=>{const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59),s=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0);let r,l;switch(e){case"today":r=s.toISOString(),l=a.toISOString();break;case"yesterday":const n=new Date(s);n.setDate(n.getDate()-1);const c=new Date(n);c.setHours(23,59,59),r=n.toISOString(),l=c.toISOString();break;case"last7days":const p=new Date(s);p.setDate(p.getDate()-7),r=p.toISOString(),l=a.toISOString();break;case"last30days":const f=new Date(s);f.setDate(f.getDate()-30),r=f.toISOString(),l=a.toISOString();break;default:const d=new Date(s);d.setDate(d.getDate()-7),r=d.toISOString(),l=a.toISOString()}return{start:r,end:l}},loadRecordings:async(e,t,a,s)=>{try{const r=new URLSearchParams;if(r.append("page",t.currentPage),r.append("limit",t.pageSize),r.append("sort",a),r.append("order",s),e.dateRange==="custom")r.append("start","".concat(e.startDate,"T").concat(e.startTime,":00")),r.append("end","".concat(e.endDate,"T").concat(e.endTime,":00"));else{const{start:n,end:c}=w.getDateRangeFromPreset(e.dateRange);r.append("start",n),r.append("end",c)}e.streamId!=="all"&&r.append("stream",e.streamId),e.recordingType==="detection"&&r.append("detection","1"),console.log("API Request:","/api/recordings?".concat(r.toString()));const l=await I("/api/recordings?".concat(r.toString()),{timeout:3e4,retries:2,retryDelay:1e3});if(console.log("Recordings data received:",l),l.recordings&&l.recordings.length>0)for(let c=0;c<l.recordings.length;c+=5){const p=l.recordings.slice(c,c+5);await Promise.all(p.map(async f=>{try{f.has_detections=await w.checkRecordingHasDetections(f)}catch(d){console.error("Error checking detections for recording ".concat(f.id,":"),d),f.has_detections=!1}}))}return l}catch(r){throw console.error("Error loading recordings:",r),u("Error loading recordings: "+r.message),r}},deleteRecording:async e=>{try{return await H("/api/recordings/".concat(e.id),{method:"DELETE",timeout:15e3,retries:1,retryDelay:1e3}),u("Recording deleted successfully"),!0}catch(t){return console.error("Error deleting recording:",t),u("Error deleting recording: "+t.message),!1}},deleteSelectedRecordings:async e=>{const t=Object.entries(e).filter(([a,s])=>s).map(([a,s])=>parseInt(a,10));if(t.length===0)return u("No recordings selected"),{succeeded:0,failed:0};try{if(window.wsClient){if(console.log("Using WebSocket for batch delete operation"),window.wsClient.isConnected()||(console.log("WebSocket not connected, connecting now..."),window.wsClient.connect()),!window.batchDeleteClient)if(typeof BatchDeleteRecordingsClient<"u")console.log("Creating new BatchDeleteRecordingsClient"),window.batchDeleteClient=new BatchDeleteRecordingsClient(window.wsClient);else return console.warn("BatchDeleteRecordingsClient not available, falling back to HTTP"),w.deleteSelectedRecordingsHttp(t);return typeof showBatchDeleteModal=="function"&&showBatchDeleteModal(),await window.batchDeleteClient.deleteWithProgress({ids:t})}else return console.log("WebSocket client not available, using HTTP for batch delete"),w.deleteSelectedRecordingsHttp(t)}catch(a){return console.error("Error in batch delete operation:",a),u("Error in batch delete operation: "+a.message),{succeeded:0,failed:0}}},deleteSelectedRecordingsHttp:async e=>{try{const a=await(await H("/api/recordings/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:e}),timeout:6e4,retries:1,retryDelay:2e3})).json(),s=a.succeeded,r=a.failed;return s>0&&r===0?u("Successfully deleted ".concat(s," recording").concat(s!==1?"s":"")):s>0&&r>0?u("Deleted ".concat(s," recording").concat(s!==1?"s":"",", but failed to delete ").concat(r)):u("Failed to delete ".concat(r," recording").concat(r!==1?"s":"")),a}catch(t){return console.error("Error in HTTP batch delete operation:",t),u("Error in batch delete operation: "+t.message),{succeeded:0,failed:0}}},deleteAllFilteredRecordings:async e=>{try{const t={};if(e.dateRange==="custom")t.start="".concat(e.startDate,"T").concat(e.startTime,":00"),t.end="".concat(e.endDate,"T").concat(e.endTime,":00");else{const{start:r,end:l}=w.getDateRangeFromPreset(e.dateRange);t.start=r,t.end=l}e.streamId!=="all"&&(t.stream_name=e.streamId),e.recordingType==="detection"&&(t.detection=1),console.log("Deleting with filter:",t),typeof showBatchDeleteModal=="function"&&(showBatchDeleteModal(),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:0,succeeded:0,failed:0,status:"Preparing to delete recordings matching filter...",complete:!1}));let a=0;try{const r=new URLSearchParams;t.start&&r.append("start",t.start),t.end&&r.append("end",t.end),t.stream_name&&r.append("stream",t.stream_name),t.detection&&r.append("detection","1"),r.append("page","1"),r.append("limit","1"),console.log("Getting total count with params:",r.toString());const l=await fetch("/api/recordings?".concat(r.toString()));if(l.ok){const n=await l.json();n&&n.pagination&&n.pagination.total&&(a=n.pagination.total,console.log("Found ".concat(a," recordings matching filter")),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:a,succeeded:0,failed:0,status:"Found ".concat(a," recordings matching filter. Starting deletion..."),complete:!1}))}}catch(r){console.warn("Error getting recording count:",r)}const s=r=>(console.error("Error in delete all operation:",r),u("Error in delete all operation: "+r.message),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:0,succeeded:0,failed:0,status:"Error: ".concat(r.message),complete:!0}),{succeeded:0,failed:0});if(window.wsClient){if(console.log("Using WebSocket for batch delete with filter"),window.wsClient.isConnected()||(console.log("WebSocket not connected, connecting now..."),window.wsClient.connect()),!window.batchDeleteClient)if(typeof BatchDeleteRecordingsClient<"u")console.log("Creating new BatchDeleteRecordingsClient for filtered delete"),window.batchDeleteClient=new BatchDeleteRecordingsClient(window.wsClient);else return console.warn("BatchDeleteRecordingsClient not available, falling back to HTTP"),w.deleteAllFilteredRecordingsHttp(t);console.log("Using WebSocket client ID for filtered batch delete:",window.wsClient.getClientId());const r=new Promise((l,n)=>{setTimeout(()=>{n(new Error("Operation timed out or server crashed. Some recordings may have been deleted."))},6e4)});try{return await Promise.race([window.batchDeleteClient.deleteWithProgress({filter:t,totalCount:a}),r])}catch(l){return console.error("WebSocket error or timeout:",l),setTimeout(()=>{typeof loadRecordings=="function"&&loadRecordings()},1e3),s(l)}}else return console.log("WebSocket client not available, using HTTP for batch delete with filter"),w.deleteAllFilteredRecordingsHttp(t)}catch(t){return console.error("Error in delete all operation:",t),u("Error in delete all operation: "+t.message),{succeeded:0,failed:0}}},deleteAllFilteredRecordingsHttp:async e=>{try{const a=await(await H("/api/recordings/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filter:e}),timeout:12e4,retries:1,retryDelay:3e3})).json(),s=a.succeeded,r=a.failed;return s>0&&r===0?u("Successfully deleted ".concat(s," recording").concat(s!==1?"s":"")):s>0&&r>0?u("Deleted ".concat(s," recording").concat(s!==1?"s":"",", but failed to delete ").concat(r)):u("Failed to delete ".concat(r," recording").concat(r!==1?"s":"")),a}catch(t){return console.error("Error in HTTP delete all operation:",t),u("Error in delete all operation: "+t.message),{succeeded:0,failed:0}}},checkRecordingHasDetections:async e=>{if(!e||!e.id||!e.stream||!e.start_time||!e.end_time)return!1;try{const t=Math.floor(new Date(e.start_time).getTime()/1e3),a=Math.floor(new Date(e.end_time).getTime()/1e3),s=new URLSearchParams({start:t,end:a}),r=await I("/api/detection/results/".concat(e.stream,"?").concat(s.toString()),{timeout:1e4,retries:1,retryDelay:500});return r.detections&&r.detections.length>0}catch(t){return console.error("Error checking detections:",t),!1}},getRecordingDetections:async e=>{if(!e||!e.id||!e.stream||!e.start_time||!e.end_time)return[];try{const t=Math.floor(new Date(e.start_time).getTime()/1e3),a=Math.floor(new Date(e.end_time).getTime()/1e3),s=new URLSearchParams({start:t,end:a});return(await I("/api/detection/results/".concat(e.stream,"?").concat(s.toString()),{timeout:15e3,retries:1,retryDelay:1e3})).detections||[]}catch(t){return console.error("Error getting detections:",t),[]}},playRecording:(e,t)=>{if(console.log("Play recording clicked:",e),!e.id){console.error("Recording has no id property:",e),u("Error: Recording has no id property");return}const a="/api/recordings/play/".concat(e.id),s="".concat(e.stream," - ").concat(V.formatDateTime(e.start_time)),r="/api/recordings/download/".concat(e.id);console.log("Video URL:",a),console.log("Title:",s),console.log("Download URL:",r),t(a,s,r),console.log("Video modal should be shown now")},downloadRecording:e=>{const t="/api/recordings/download/".concat(e.id),a=document.createElement("a");a.href=t,a.download="".concat(e.stream,"_").concat(new Date(e.start_time).toISOString().replace(/[:.]/g,"-"),".mp4"),document.body.appendChild(a),a.click(),document.body.removeChild(a),u("Download started")}},T={getFiltersFromUrl:()=>{const e=new URLSearchParams(window.location.search);if(!e.has("dateRange")&&!e.has("page")&&!e.has("sort")&&!e.has("detection")&&!e.has("stream"))return null;const t={filters:{dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"},page:1,limit:20,sort:"start_time",order:"desc"};return e.has("dateRange")&&(t.filters.dateRange=e.get("dateRange"),t.filters.dateRange==="custom"&&(e.has("startDate")&&(t.filters.startDate=e.get("startDate")),e.has("startTime")&&(t.filters.startTime=e.get("startTime")),e.has("endDate")&&(t.filters.endDate=e.get("endDate")),e.has("endTime")&&(t.filters.endTime=e.get("endTime")))),e.has("stream")&&(t.filters.streamId=e.get("stream")),e.has("detection")&&e.get("detection")==="1"&&(t.filters.recordingType="detection"),e.has("page")&&(t.page=parseInt(e.get("page"),10)),e.has("limit")&&(t.limit=parseInt(e.get("limit"),10)),e.has("sort")&&(t.sort=e.get("sort")),e.has("order")&&(t.order=e.get("order")),t},getActiveFiltersDisplay:e=>{const t=[];if(e.dateRange!=="last7days"||e.streamId!=="all"||e.recordingType!=="all"){if(e.dateRange!=="last7days"){let s="";switch(e.dateRange){case"today":s="Today";break;case"yesterday":s="Yesterday";break;case"last30days":s="Last 30 Days";break;case"custom":s="".concat(e.startDate," to ").concat(e.endDate);break}t.push({key:"dateRange",label:"Date: ".concat(s)})}e.streamId!=="all"&&t.push({key:"streamId",label:"Stream: ".concat(e.streamId)}),e.recordingType!=="all"&&t.push({key:"recordingType",label:"Detection Events Only"})}return t},loadFiltersFromUrl:(e,t,a,s,r,l)=>{const n=new URLSearchParams(window.location.search),c={...e};n.has("dateRange")&&(c.dateRange=n.get("dateRange"),c.dateRange==="custom"&&(n.has("startDate")&&(c.startDate=n.get("startDate")),n.has("startTime")&&(c.startTime=n.get("startTime")),n.has("endDate")&&(c.endDate=n.get("endDate")),n.has("endTime")&&(c.endTime=n.get("endTime")))),n.has("stream")&&(c.streamId=n.get("stream")),n.has("detection")&&n.get("detection")==="1"&&(c.recordingType="detection"),a(c),n.has("page")&&s(p=>({...p,currentPage:parseInt(n.get("page"),10)})),n.has("limit")&&s(p=>({...p,pageSize:parseInt(n.get("limit"),10)})),n.has("sort")&&r(n.get("sort")),n.has("order")&&l(n.get("order"))},updateUrlWithFilters:(e,t,a,s)=>{const r=new URLSearchParams(window.location.search);r.set("t",Date.now().toString()),r.set("dateRange",e.dateRange),e.dateRange==="custom"?(r.set("startDate",e.startDate),r.set("startTime",e.startTime),r.set("endDate",e.endDate),r.set("endTime",e.endTime)):(r.delete("startDate"),r.delete("startTime"),r.delete("endDate"),r.delete("endTime")),e.streamId!=="all"?r.set("stream",e.streamId):r.delete("stream"),e.recordingType==="detection"?r.set("detection","1"):r.delete("detection"),r.set("page",t.currentPage.toString()),r.set("limit",t.pageSize.toString()),r.set("sort",a),r.set("order",s);const l="".concat(window.location.pathname,"?").concat(r.toString());window.history.pushState({path:l},"",l);const n=l;window.onbeforeunload=function(){window.history.replaceState({path:n},"",n)}}};var pe;function Je(){const[e,t]=D([]),[a,s]=D([]),[r,l]=D(!0),[n,c]=D("start_time"),[p,f]=D("desc"),[d,m]=D({dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"}),[b,x]=D({currentPage:1,pageSize:20,totalItems:0,totalPages:1,startItem:0,endItem:0}),[A,k]=D(!1),[he,ye]=D([]),[L,E]=D({}),[j,z]=D(!1),[fe,N]=D(!1),[q,be]=D("selected"),we=We(null);W();const{data:F,isLoading:Ge,error:_}=w.hooks.useStreams();P(()=>{F&&Array.isArray(F)&&s(F)},[F]),P(()=>{_&&(console.error("Error loading streams for filter:",_),u("Error loading streams: "+_.message))},[_]),P(()=>{K();const o=T.getFiltersFromUrl();if(o){console.log("Found URL filters:",o);const i=new URLSearchParams(window.location.search);i.has("detection")&&i.get("detection")==="1"&&(o.filters.recordingType="detection"),m(o.filters),x(g=>({...g,currentPage:o.page||1,pageSize:o.limit||20})),c(o.sort||"start_time"),f(o.order||"desc")}return O(),window.addEventListener("resize",O),()=>{window.removeEventListener("resize",O)}},[]),P(()=>{Se()},[d]);const K=()=>{const o=new Date,i=new Date(o);i.setDate(o.getDate()-7),m(g=>({...g,endDate:o.toISOString().split("T")[0],startDate:i.toISOString().split("T")[0]}))},{data:C,isLoading:ve,error:M,refetch:Xe}=w.hooks.useRecordings(d,b,n,p);P(()=>{if(C){const o=C.recordings||[];t(o),Q(o.length>0),C.pagination&&Y(C,b.currentPage)}},[C]),P(()=>{M&&(console.error("Error loading recordings:",M),u("Error loading recordings: "+M.message),Q(!1))},[M]);const O=()=>{window.innerWidth<768?l(!1):l(!0)},De=()=>{l(!r)},[$e,Q]=D(!1),ke=(o=b.currentPage,i=!0)=>{console.log("Loading recordings with filters:",JSON.stringify(d));const g={...b,currentPage:o};x(g),i&&T.updateUrlWithFilters(d,g,n,p)},Y=(o,i)=>{if(i=i||b.currentPage,o.pagination){const g=o.pagination.limit||20,h=o.pagination.total||0,y=o.pagination.pages||1;let S=0,R=0;o.recordings.length>0&&(S=(i-1)*g+1,R=Math.min(S+o.recordings.length-1,h)),console.log("Pagination update:",{currentPage:i,pageSize:g,totalItems:h,totalPages:y,startItem:S,endItem:R,recordingsLength:o.recordings.length}),x(U=>({...U,totalItems:h,totalPages:y,pageSize:g,startItem:S,endItem:R}))}else{const g=b.pageSize,h=o.total||0,y=Math.ceil(h/g)||1;let S=0,R=0;o.recordings.length>0&&(S=(i-1)*g+1,R=Math.min(S+o.recordings.length-1,h)),console.log("Pagination update (fallback):",{currentPage:i,pageSize:g,totalItems:h,totalPages:y,startItem:S,endItem:R,recordingsLength:o.recordings.length}),x(U=>({...U,totalItems:h,totalPages:y,startItem:S,endItem:R}))}},xe=o=>{const i=o.target.value;if(m(g=>({...g,dateRange:i})),i==="custom"&&(!d.startDate||!d.endDate)){const g=new Date,h=new Date(g);h.setDate(g.getDate()-7),m(y=>({...y,endDate:g.toISOString().split("T")[0],startDate:h.toISOString().split("T")[0]}))}},Se=()=>{const o=T.getActiveFiltersDisplay(d);k(o.length>0),ye(o)},J=(o=!0)=>{o&&x(i=>({...i,currentPage:1})),T.updateUrlWithFilters(d,o?{...b,currentPage:1}:b,n,p)},Re=()=>{const o={dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"},i=new Date,g=new Date(i);g.setDate(i.getDate()-7),o.endDate=i.toISOString().split("T")[0],o.startDate=g.toISOString().split("T")[0],m(o),x(y=>({...y,currentPage:1})),c("start_time"),f("desc");const h=window.location.pathname;window.history.pushState({path:h},"",h)},Te=o=>{switch(o){case"dateRange":m(i=>({...i,dateRange:"last7days"}));break;case"streamId":m(i=>({...i,streamId:"all"}));break;case"recordingType":m(i=>({...i,recordingType:"all"}));break}J()},Pe=o=>{n===o?f(p==="asc"?"desc":"asc"):(f(o==="start_time"?"desc":"asc"),c(o)),x(i=>({...i,currentPage:1})),T.updateUrlWithFilters(d,{...b,currentPage:1},o,o===n?p==="asc"?"desc":"asc":o==="start_time"?"desc":"asc")},Ce=o=>{o<1||o>b.totalPages||(x(i=>({...i,currentPage:o})),T.updateUrlWithFilters(d,{...b,currentPage:o},n,p))},Ie=o=>{E(i=>({...i,[o]:!i[o]}))},Ee=()=>{const o=!j;z(o);const i={};o&&e.forEach(g=>{i[g.id]=!0}),E(i)},G=()=>Object.values(L).filter(Boolean).length,Fe=o=>{be(o),N(!0)},X=()=>{N(!1)},_e=async()=>{X();const o=new URLSearchParams(window.location.search),i=o.get("sort")||n,g=o.get("order")||p,h=parseInt(o.get("page"),10)||b.currentPage;if(q==="selected"){const y=await w.deleteSelectedRecordings(L);E({}),z(!1),y.succeeded>0&&Me(i,g,h)}else{const y=await w.deleteAllFilteredRecordings(d);E({}),z(!1),y.succeeded>0&&ke()}},Me=(o,i,g)=>{c(o),f(i),x(h=>({...h,currentPage:g})),setTimeout(()=>{const h={...b,currentPage:g};T.updateUrlWithFilters(d,h,o,i),w.loadRecordings(d,h,o,i).then(y=>{console.log("Recordings data received:",y),t(y.recordings||[]),Y(y,g)}).catch(y=>{console.error("Error loading recordings:",y),u("Error loading recordings: "+y.message)})},0)},{mutate:Ae}=w.hooks.useDeleteRecording(),Le=o=>{confirm("Are you sure you want to delete this recording from ".concat(o.stream,"?"))&&Ae(o.id)},ze=o=>{w.playRecording(o,je)},Oe=o=>{w.downloadRecording(o)};return $(pe||(pe=v(['\n    <section id="recordings-page" class="page">\n      <div class="page-header flex justify-between items-center mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow">\n        <div class="flex items-center">\n          <h2 class="text-xl font-bold">Recordings</h2>\n          <div class="ml-4 flex">\n            <a href="recordings.html" class="px-3 py-1 bg-blue-500 text-white rounded-l-md">Table View</a>\n            <a href="timeline.html" class="px-3 py-1 bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-400 dark:hover:bg-gray-600 rounded-r-md">Timeline View</a>\n          </div>\n        </div>\n        <button id="toggle-filters-btn"\n                class="p-2 rounded-full bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none"\n                title="Toggle Filters"\n                onClick=','>\n          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n            <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class="recordings-layout flex flex-col md:flex-row gap-4 w-full">\n        <!-- Sidebar for filters -->\n        <',"\n          filters=","\n          setFilters=","\n          pagination=","\n          setPagination=","\n          streams=","\n          filtersVisible=","\n          applyFilters=","\n          resetFilters=","\n          handleDateRangeChange=","\n          setDefaultDateRange=",'\n        />\n\n        <!-- Main content area -->\n        <div class="recordings-content flex-1">\n          <',"\n            activeFiltersDisplay=","\n            removeFilter=","\n            hasActiveFilters=","\n          />\n\n          <","\n            isLoading=","\n            hasData=",'\n            loadingMessage="Loading recordings..."\n            emptyMessage="No recordings found matching your criteria"\n          >\n            <',"\n              recordings=","\n              sortField=","\n              sortDirection=","\n              sortBy=","\n              selectedRecordings=","\n              toggleRecordingSelection=","\n              selectAll=","\n              toggleSelectAll=","\n              getSelectedCount=","\n              openDeleteModal=","\n              playRecording=","\n              downloadRecording=","\n              deleteRecording=","\n              recordingsTableBodyRef=","\n              pagination=","\n            />\n\n            <","\n              pagination=","\n              goToPage=","\n            />\n          <//>\n        </div>\n      </div>\n\n      <","\n        isOpen=","\n        onClose=","\n        onConfirm=","\n        mode=","\n        count=","\n      />\n    </section>\n  "])),De,qe,d,m,b,x,a,r,J,Re,xe,K,Ke,he,Te,A,Ne,ve,$e,Qe,e,n,p,Pe,L,Ie,j,Ee,G,Fe,ze,Oe,Le,we,b,Ye,b,Ce,Ve,fe,X,_e,q,G())}var me;function rt(){const e=document.getElementById("main-content");e&&ee(async()=>{const{render:t}=await import("./preact-app-3DvZ3cMn.js").then(a=>a.p);return{render:t}},__vite__mapDeps([0,1]),import.meta.url).then(({render:t})=>{ee(async()=>{const{QueryClientProvider:a,queryClient:s}=await import("./preact-app-3DvZ3cMn.js").then(r=>r.n);return{QueryClientProvider:a,queryClient:s}},__vite__mapDeps([0,1]),import.meta.url).then(({QueryClientProvider:a,queryClient:s})=>{t($(me||(me=v(["<"," client=","><"," /></",">"])),a,s,Je,a),e)})})}export{Je as RecordingsView,rt as loadRecordingsView};
//# sourceMappingURL=RecordingsView-DdSQ1nsj.js.map
