{"version":3,"file":"StreamsView-legacy-fLJI23Qz.js","sources":["../../js/components/preact/StreamDeleteModal.js","../../js/components/preact/StreamsView.js"],"sourcesContent":["/**\n * LightNVR Web Interface Stream Delete Modal Component\n * Preact component for the stream delete modal\n */\n\nimport { html } from '../../html-helper.js';\nimport { useState } from 'preact/hooks';\n\n/**\n * StreamDeleteModal component\n * @param {Object} props Component props\n * @param {string} props.streamId ID of the stream to delete\n * @param {string} props.streamName Name of the stream to display\n * @param {Function} props.onClose Function to call when the modal is closed\n * @param {Function} props.onDisable Function to call when the disable button is clicked\n * @param {Function} props.onDelete Function to call when the delete button is clicked\n * @returns {JSX.Element} StreamDeleteModal component\n */\nexport function StreamDeleteModal({ streamId, streamName, onClose, onDisable, onDelete }) {\n  const [isConfirmDelete, setIsConfirmDelete] = useState(false);\n  \n  // Show delete confirmation step\n  const showDeleteConfirmation = () => {\n    setIsConfirmDelete(true);\n  };\n  \n  // Handle disable stream\n  const handleDisable = () => {\n    onDisable(streamId);\n    onClose();\n  };\n  \n  // Handle delete stream\n  const handleDelete = () => {\n    onDelete(streamId);\n    onClose();\n  };\n  \n  return html`\n    <div class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300\">\n      <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full\">\n        <div class=\"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700\">\n          <h3 class=\"text-lg font-medium\">${isConfirmDelete ? 'Confirm Permanent Deletion' : 'Stream Actions'}</h3>\n          <span class=\"text-2xl cursor-pointer\" onClick=${onClose}>×</span>\n        </div>\n        \n        <div class=\"p-6\">\n          ${!isConfirmDelete ? html`\n            <div class=\"mb-6\">\n              <h4 class=\"text-lg font-medium mb-2\">What would you like to do with \"${streamName}\"?</h4>\n              <p class=\"text-gray-600 dark:text-gray-400 mb-4\">\n                Please choose one of the following options:\n              </p>\n              \n              <div class=\"space-y-4\">\n                <div class=\"p-4 border border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-900/30 rounded-lg\">\n                  <h5 class=\"font-medium text-yellow-800 dark:text-yellow-500 mb-2\">Disable Stream (Soft Delete)</h5>\n                  <p class=\"text-gray-600 dark:text-gray-400 mb-2\">\n                    This option will disable the stream but keep its configuration in the database. You can re-enable it later.\n                  </p>\n                  <ul class=\"list-disc list-inside text-sm text-gray-600 dark:text-gray-400 mb-3\">\n                    <li>Stream will stop processing</li>\n                    <li>Live streaming will be disabled</li>\n                    <li>Recording will be disabled</li>\n                    <li>Audio recording will be disabled</li>\n                    <li>Detection-based recording will be disabled</li>\n                    <li>Configuration is preserved</li>\n                    <li>Existing recordings are kept</li>\n                    <li>Can be re-enabled later</li>\n                  </ul>\n                  <button \n                    class=\"w-full px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n                    onClick=${handleDisable}\n                  >\n                    Disable Stream\n                  </button>\n                </div>\n                \n                <div class=\"p-4 border border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-900/30 rounded-lg\">\n                  <h5 class=\"font-medium text-red-800 dark:text-red-500 mb-2\">Delete Stream (Permanent)</h5>\n                  <p class=\"text-gray-600 dark:text-gray-400 mb-2\">\n                    This option will permanently delete the stream configuration from the database. This action cannot be undone.\n                  </p>\n                  <ul class=\"list-disc list-inside text-sm text-gray-600 dark:text-gray-400 mb-3\">\n                    <li>Stream will be completely removed</li>\n                    <li>Configuration is deleted</li>\n                    <li>Recordings remain accessible</li>\n                    <li>Cannot be recovered</li>\n                  </ul>\n                  <button \n                    class=\"w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n                    onClick=${showDeleteConfirmation}\n                  >\n                    Delete Stream\n                  </button>\n                </div>\n              </div>\n            </div>\n          ` : html`\n            <div class=\"mb-6\">\n              <div class=\"flex items-center justify-center mb-4 text-red-600 dark:text-red-500\">\n                <svg class=\"w-12 h-12\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                  <path fill-rule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clip-rule=\"evenodd\"></path>\n                </svg>\n              </div>\n              <h4 class=\"text-lg font-medium mb-2 text-center\">Are you sure you want to permanently delete \"${streamName}\"?</h4>\n              <p class=\"text-gray-600 dark:text-gray-400 mb-4 text-center\">\n                This action cannot be undone. The stream configuration will be permanently removed from the database.\n              </p>\n            </div>\n            \n            <div class=\"flex justify-center space-x-3\">\n              <button \n                class=\"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n                onClick=${() => setIsConfirmDelete(false)}\n              >\n                Cancel\n              </button>\n              <button \n                class=\"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n                onClick=${handleDelete}\n              >\n                Yes, Delete Permanently\n              </button>\n            </div>\n          `}\n        </div>\n      </div>\n    </div>\n  `;\n}\n","/**\n * LightNVR Web Interface StreamsView Component\n * Preact component for the streams page\n */\n\nimport { h } from 'preact';\nimport { html } from '../../html-helper.js';\nimport { useState, useEffect, useRef } from 'preact/hooks';\nimport { showStatusMessage } from './UI.js';\nimport { ContentLoader } from './LoadingIndicator.js';\nimport { StreamDeleteModal } from './StreamDeleteModal.js';\nimport {\n  useQuery,\n  useMutation,\n  useQueryClient,\n  fetchJSON\n} from '../../query-client.js';\n\n/**\n * StreamsView component\n * @returns {JSX.Element} StreamsView component\n */\nexport function StreamsView() {\n  const queryClient = useQueryClient();\n\n  // State for streams data\n  const [modalVisible, setModalVisible] = useState(false);\n  const [onvifModalVisible, setOnvifModalVisible] = useState(false);\n  const [showCustomNameInput, setShowCustomNameInput] = useState(false);\n  const [isAddingStream, setIsAddingStream] = useState(false);\n  const [discoveredDevices, setDiscoveredDevices] = useState([]);\n  const [deviceProfiles, setDeviceProfiles] = useState([]);\n  const [selectedDevice, setSelectedDevice] = useState(null);\n  const [selectedProfile, setSelectedProfile] = useState(null);\n  const [customStreamName, setCustomStreamName] = useState('');\n  const [onvifCredentials, setOnvifCredentials] = useState({ username: '', password: '' });\n  const [isDiscovering, setIsDiscovering] = useState(false);\n  const [isLoadingProfiles, setIsLoadingProfiles] = useState(false);\n\n  // Fetch streams data\n  const {\n    data: streamsResponse = [],\n    isLoading,\n    error\n  } = useQuery(['streams'], '/api/streams', {\n    timeout: 10000,\n    retries: 2,\n    retryDelay: 1000\n  });\n\n  // Fetch detection models\n  const {\n    data: detectionModelsData\n  } = useQuery(['detectionModels'], '/api/detection/models', {\n    timeout: 5000,\n    retries: 1,\n    retryDelay: 1000\n  });\n\n  // Process the response to handle both array and object formats\n  const streams = Array.isArray(streamsResponse) ? streamsResponse : (streamsResponse.streams || []);\n\n  // Log streams data for debugging\n  console.log('API Response:', streamsResponse);\n\n  // Log streams data for debugging\n  console.log('Streams data:', streams);\n  console.log('hasData:', streams && streams.length > 0);\n\n  // Default stream state\n  const [currentStream, setCurrentStream] = useState({\n    name: '',\n    url: '',\n    enabled: true,\n    streamingEnabled: true,\n    width: 1280,\n    height: 720,\n    fps: 15,\n    codec: 'h264',\n    protocol: '0',\n    priority: '5',\n    segment: 30,\n    record: true,\n    recordAudio: true,\n    detectionEnabled: false,\n    detectionModel: '',\n    detectionThreshold: 50,\n    detectionInterval: 10,\n    preBuffer: 10,\n    postBuffer: 30\n  });\n  const [isEditing, setIsEditing] = useState(false);\n\n  // State for delete modal\n  const [deleteModalVisible, setDeleteModalVisible] = useState(false);\n  const [streamToDelete, setStreamToDelete] = useState(null);\n\n  // Compute hasData from streams\n  const hasData = streams && streams.length > 0;\n\n  // Extract detection models from query result\n  const detectionModels = detectionModelsData?.models || [];\n\n  // Mutations for saving stream (create or update)\n  const createStreamMutation = useMutation({\n    mutationFn: async (streamData) => {\n      return await fetchJSON('/api/streams', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(streamData),\n        timeout: 15000,\n        retries: 1,\n        retryDelay: 1000\n      });\n    },\n    onSuccess: () => {\n      showStatusMessage('Stream added successfully');\n      closeModal();\n      // Invalidate and refetch streams data\n      queryClient.invalidateQueries({ queryKey: ['streams'] });\n    },\n    onError: (error) => {\n      showStatusMessage(`Error adding stream: ${error.message}`, 5000, 'error');\n    }\n  });\n\n  const updateStreamMutation = useMutation({\n    mutationFn: async (streamData) => {\n      return await fetchJSON(`/api/streams/${encodeURIComponent(streamData.name)}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(streamData),\n        timeout: 15000,\n        retries: 1,\n        retryDelay: 1000\n      });\n    },\n    onSuccess: () => {\n      showStatusMessage('Stream updated successfully');\n      closeModal();\n      // Invalidate and refetch streams data\n      queryClient.invalidateQueries({ queryKey: ['streams'] });\n    },\n    onError: (error) => {\n      showStatusMessage(`Error updating stream: ${error.message}`, 5000, 'error');\n    }\n  });\n\n  // Helper function to use the appropriate mutation based on editing state\n  const saveStreamMutation = {\n    mutate: (streamData, options) => {\n      if (isEditing) {\n        updateStreamMutation.mutate(streamData, options);\n      } else {\n        createStreamMutation.mutate(streamData, options);\n      }\n    }\n  };\n\n  // Mutation for testing stream connection\n  const testStreamMutation = useMutation({\n    mutationFn: async (streamData) => {\n      showStatusMessage('Testing stream connection...');\n\n      return await fetchJSON('/api/streams/test', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          url: streamData.url,\n          protocol: parseInt(streamData.protocol, 10)\n        }),\n        timeout: 20000,\n        retries: 1,\n        retryDelay: 2000\n      });\n    },\n    onSuccess: (data) => {\n      if (data.success) {\n        showStatusMessage('Stream connection successful!', 3000, 'success');\n      } else {\n        showStatusMessage(`Stream connection failed: ${data.message}`, 5000, 'error');\n      }\n    },\n    onError: (error) => {\n      showStatusMessage(`Error testing stream: ${error.message}`, 5000, 'error');\n    }\n  });\n\n  // Mutation for deleting stream\n  const deleteStreamMutation = useMutation({\n    mutationFn: async ({ streamId, permanent }) => {\n      const url = permanent\n        ? `/api/streams/${encodeURIComponent(streamId)}?permanent=true`\n        : `/api/streams/${encodeURIComponent(streamId)}`;\n\n      return await fetchJSON(url, {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        timeout: 10000,\n        retries: 1,\n        retryDelay: 1000\n      });\n    },\n    onSuccess: () => {\n      showStatusMessage('Stream deleted successfully');\n      closeDeleteModal();\n      // Invalidate and refetch streams data\n      queryClient.invalidateQueries({ queryKey: ['streams'] });\n    },\n    onError: (error) => {\n      showStatusMessage(`Error deleting stream: ${error.message}`, 5000, 'error');\n    }\n  });\n\n  // Mutation for toggling stream enabled state\n  const toggleStreamEnabledMutation = useMutation({\n    mutationFn: async ({ streamId, enabled }) => {\n      return await fetchJSON(`/api/streams/${encodeURIComponent(streamId)}/enable`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ enabled: !enabled }),\n        timeout: 10000,\n        retries: 1,\n        retryDelay: 1000\n      });\n    },\n    onSuccess: (_, variables) => {\n      showStatusMessage(`Stream ${variables.enabled ? 'disabled' : 'enabled'} successfully`);\n      // Invalidate and refetch streams data\n      queryClient.invalidateQueries({ queryKey: ['streams'] });\n    },\n    onError: (error) => {\n      showStatusMessage(`Error toggling stream state: ${error.message}`, 5000, 'error');\n    }\n  });\n\n  // Handle form submission\n  const handleSubmit = (e) => {\n    e.preventDefault();\n\n    // Prepare stream data for API\n    const streamData = {\n      name: currentStream.name,\n      url: currentStream.url,\n      enabled: currentStream.enabled,\n      streaming_enabled: currentStream.streamingEnabled,\n      width: parseInt(currentStream.width, 10),\n      height: parseInt(currentStream.height, 10),\n      fps: parseInt(currentStream.fps, 10),\n      codec: currentStream.codec,\n      protocol: parseInt(currentStream.protocol, 10),\n      priority: parseInt(currentStream.priority, 10),\n      segment_duration: parseInt(currentStream.segment, 10),\n      record: currentStream.record,\n      detection_based_recording: currentStream.detectionEnabled,\n      detection_model: currentStream.detectionModel,\n      detection_threshold: parseInt(currentStream.detectionThreshold, 10),\n      detection_interval: parseInt(currentStream.detectionInterval, 10),\n      pre_detection_buffer: parseInt(currentStream.preBuffer, 10),\n      post_detection_buffer: parseInt(currentStream.postBuffer, 10),\n      record_audio: currentStream.recordAudio\n    };\n\n    // When editing, set is_deleted to false to allow undeleting soft-deleted streams\n    if (isEditing) {\n      streamData.is_deleted = false;\n    }\n\n    // Use mutation to save stream\n    saveStreamMutation.mutate(streamData);\n  };\n\n  // Save stream (wrapper for handleSubmit to use in onClick)\n  const saveStream = (e) => {\n    handleSubmit(e);\n  };\n\n  // Test stream connection\n  const testStreamConnection = () => {\n    testStreamMutation.mutate(currentStream);\n  };\n\n  // Open delete modal\n  const openDeleteModal = (stream) => {\n    setStreamToDelete(stream);\n    setDeleteModalVisible(true);\n  };\n\n  // Close delete modal\n  const closeDeleteModal = () => {\n    setDeleteModalVisible(false);\n    setStreamToDelete(null);\n  };\n\n  // Handle delete confirmation\n  const confirmDelete = () => {\n    if (streamToDelete) {\n      deleteStreamMutation.mutate(streamToDelete.name);\n    }\n  };\n\n  // Open add stream modal\n  const openAddStreamModal = () => {\n    setCurrentStream({\n      name: '',\n      url: '',\n      enabled: true,\n      streamingEnabled: true,\n      width: 1280,\n      height: 720,\n      fps: 15,\n      codec: 'h264',\n      protocol: '0',\n      priority: '5',\n      segment: 30,\n      record: true,\n      recordAudio: true,\n      detectionEnabled: false,\n      detectionModel: '',\n      detectionThreshold: 50,\n      detectionInterval: 10,\n      preBuffer: 10,\n      postBuffer: 30\n    });\n    setIsEditing(false);\n    setModalVisible(true);\n  };\n\n  // Open edit stream modal\n  const openEditStreamModal = async (streamId) => {\n    try {\n      // Use queryClient to fetch stream details\n      const stream = await queryClient.fetchQuery({\n        queryKey: ['stream', streamId],\n        queryFn: async () => {\n          const response = await fetch(`/api/streams/${encodeURIComponent(streamId)}`);\n          if (!response.ok) {\n            throw new Error(`HTTP error ${response.status}`);\n          }\n          return response.json();\n        },\n        staleTime: 10000 // 10 seconds\n      });\n\n      setCurrentStream({\n        ...stream,\n        // Convert numeric values to strings for form inputs\n        width: stream.width || 1280,\n        height: stream.height || 720,\n        fps: stream.fps || 15,\n        protocol: stream.protocol?.toString() || '0',\n        priority: stream.priority?.toString() || '5',\n        segment: stream.segment_duration || 30,\n        detectionThreshold: stream.detection_threshold || 50,\n        detectionInterval: stream.detection_interval || 10,\n        preBuffer: stream.pre_detection_buffer || 10,\n        postBuffer: stream.post_detection_buffer || 30,\n        // Map API fields to form fields\n        streamingEnabled: stream.streaming_enabled !== undefined ? stream.streaming_enabled : true,\n        isOnvif: stream.is_onvif !== undefined ? stream.is_onvif : false,\n        detectionEnabled: stream.detection_based_recording || false,\n        detectionModel: stream.detection_model || '',\n        recordAudio: stream.record_audio !== undefined ? stream.record_audio : true\n      });\n      setIsEditing(true);\n      setModalVisible(true);\n    } catch (error) {\n      console.error('Error loading stream details:', error);\n      showStatusMessage('Error loading stream details: ' + error.message);\n    }\n  };\n\n  // Close modal\n  const closeModal = () => {\n    setModalVisible(false);\n  };\n\n  // Open ONVIF discovery modal\n  const openOnvifModal = () => {\n    setDiscoveredDevices([]);\n    setDeviceProfiles([]);\n    setSelectedDevice(null);\n    setSelectedProfile(null);\n    setCustomStreamName('');\n    setOnvifModalVisible(true);\n  };\n\n  // Close ONVIF modal\n  const closeOnvifModal = () => {\n    setOnvifModalVisible(false);\n  };\n\n  // Handle form input change\n  const handleInputChange = (e) => {\n    const { name, value, type, checked } = e.target;\n    setCurrentStream(prev => ({\n      ...prev,\n      [name]: type === 'checkbox' ? checked : value\n    }));\n  };\n\n  // Disable stream (soft delete)\n  const disableStream = (streamId) => {\n    deleteStreamMutation.mutate({ streamId, permanent: false });\n  };\n\n  // Delete stream (permanent)\n  const deleteStream = (streamId) => {\n    deleteStreamMutation.mutate({ streamId, permanent: true });\n  };\n\n  // Enable/disable stream\n  const toggleStreamEnabled = (streamId, enabled) => {\n    toggleStreamEnabledMutation.mutate({ streamId, enabled });\n  };\n\n  // Handle ONVIF credential input change\n  const handleCredentialChange = (e) => {\n    const { name, value } = e.target;\n    setOnvifCredentials(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  // Handle threshold change\n  const handleThresholdChange = (e) => {\n    const value = e.target.value;\n    setCurrentStream(prev => ({\n      ...prev,\n      detectionThreshold: value\n    }));\n  };\n\n  // Load detection models\n  const loadDetectionModels = () => {\n    queryClient.invalidateQueries({ queryKey: ['detectionModels'] });\n  };\n\n  // ONVIF discovery mutation\n  const onvifDiscoveryMutation = useMutation({\n    mutationFn: async () => {\n      setIsDiscovering(true);\n      return await fetchJSON('/api/onvif/discovery/discover', {\n        method: 'POST',\n        timeout: 120000,\n        retries: 0,\n        body: JSON.stringify({})\n      });\n    },\n    onSuccess: (data) => {\n      setDiscoveredDevices(data.devices || []);\n      setIsDiscovering(false);\n    },\n    onError: (error) => {\n      showStatusMessage(`Error discovering ONVIF devices: ${error.message}`, 5000, 'error');\n      setIsDiscovering(false);\n    }\n  });\n\n  // Get device profiles mutation\n  const getDeviceProfilesMutation = useMutation({\n    mutationFn: async ({ device, credentials }) => {\n      setIsLoadingProfiles(true);\n      return await fetchJSON('/api/onvif/device/profiles', {\n        method: 'GET',\n        headers: {\n          'X-Device-URL': `http://${device.ip_address}/onvif/device_service`,\n          'X-Username': credentials.username,\n          'X-Password': credentials.password\n        },\n        timeout: 20000,\n        retries: 0\n      });\n    },\n    onSuccess: (data) => {\n      setDeviceProfiles(data.profiles || []);\n      setIsLoadingProfiles(false);\n    },\n    onError: (error) => {\n      showStatusMessage(`Error loading device profiles: ${error.message}`, 5000, 'error');\n      setIsLoadingProfiles(false);\n    }\n  });\n\n  // Test ONVIF connection mutation\n  const testOnvifConnectionMutation = useMutation({\n    mutationFn: async (device) => {\n      setIsLoadingProfiles(true);\n      return await fetchJSON('/api/onvif/device/test', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          url: `http://${device.ip_address}/onvif/device_service`,\n          username: onvifCredentials.username,\n          password: onvifCredentials.password\n        }),\n        timeout: 15000,\n        retries: 0\n      });\n    },\n    onSuccess: (data, variables) => {\n      if (data.success) {\n        showStatusMessage('Connection successful!', 3000, 'success');\n        getDeviceProfiles(variables);\n      } else {\n        showStatusMessage(`Connection failed: ${data.message}`, 5000, 'error');\n        setIsLoadingProfiles(false);\n      }\n    },\n    onError: (error) => {\n      showStatusMessage(`Error testing connection: ${error.message}`, 5000, 'error');\n      setIsLoadingProfiles(false);\n    }\n  });\n\n\n\n  // Submit ONVIF device\n  const submitOnvifDevice = () => {\n    if (!selectedDevice || !selectedProfile || !customStreamName.trim()) {\n      showStatusMessage('Missing required information', 5000, 'error');\n      return;\n    }\n\n    setIsAddingStream(true);\n\n    // Prepare stream data\n    const streamData = {\n      name: customStreamName.trim(),\n      url: selectedProfile.stream_uri, // Use stream_uri instead of url\n      enabled: true,\n      streaming_enabled: true,\n      width: selectedProfile.width,\n      height: selectedProfile.height,\n      fps: selectedProfile.fps || 15,\n      codec: selectedProfile.encoding === 'H264' ? 'h264' : 'h265',\n      protocol: '0', // TCP\n      priority: '5', // Medium\n      segment_duration: 30,\n      record: true,\n      record_audio: true,\n      is_onvif: true\n    };\n\n    // Log the stream data for debugging\n    console.log('Adding ONVIF stream with data:', streamData);\n\n    // Use mutation to save stream\n    saveStreamMutation.mutate(streamData, {\n      onSuccess: () => {\n        setIsAddingStream(false);\n        setShowCustomNameInput(false);\n        setOnvifModalVisible(false);\n      },\n      onError: () => {\n        setIsAddingStream(false);\n      },\n      isEditing: false,\n    });\n  };\n\n  // Start ONVIF discovery\n  const startOnvifDiscovery = () => {\n    onvifDiscoveryMutation.mutate();\n  };\n\n  // Get ONVIF device profiles\n  const getDeviceProfiles = (device) => {\n    setSelectedDevice(device);\n    setDeviceProfiles([]);\n    getDeviceProfilesMutation.mutate({\n      device,\n      credentials: onvifCredentials\n    });\n  };\n\n  // Handle custom stream name change\n  const handleStreamNameChange = (e) => {\n    setCustomStreamName(e.target.value);\n  };\n\n  // Add ONVIF device as stream with selected profile\n  const addOnvifDeviceAsStream = (profile) => {\n    setSelectedProfile(profile);\n    setCustomStreamName(`${selectedDevice.name || 'ONVIF'}_${profile.name || 'Stream'}`);\n    setShowCustomNameInput(true);\n  };\n\n  // Test ONVIF connection\n  const testOnvifConnection = (device) => {\n    testOnvifConnectionMutation.mutate(device);\n  };\n\n  return html`\n    <section id=\"streams-page\" class=\"page\">\n      <div class=\"page-header flex justify-between items-center mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow\">\n        <h2 class=\"text-xl font-bold\">Streams</h2>\n        <div class=\"controls flex space-x-2\">\n          <button\n              id=\"discover-onvif-btn\"\n              class=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n              onClick=${() => setOnvifModalVisible(true)}\n          >\n            Discover ONVIF Cameras\n          </button>\n          <button\n              id=\"add-stream-btn\"\n              class=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\n              onClick=${openAddStreamModal}\n          >\n            Add Stream\n          </button>\n        </div>\n      </div>\n\n      <${ContentLoader}\n          isLoading=${isLoading}\n          hasData=${hasData}\n          loadingMessage=\"Loading streams...\"\n          emptyMessage=\"No streams configured yet. Click 'Add Stream' to create one.\"\n      >\n        <div class=\"streams-container bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden\">\n          <div class=\"overflow-x-auto\">\n            <table id=\"streams-table\" class=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n              <thead class=\"bg-gray-50 dark:bg-gray-700\">\n              <tr>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Name</th>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">URL</th>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Resolution</th>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">FPS</th>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Recording</th>\n                <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Actions</th>\n              </tr>\n              </thead>\n              <tbody class=\"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700\">\n              ${streams.map(stream => html`\n                <tr key=${stream.name} class=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\n                  <td class=\"px-6 py-4 whitespace-nowrap\">\n                    <div class=\"flex items-center\">\n                      <span class=${`status-indicator w-2 h-2 rounded-full mr-2 ${stream.enabled ? 'bg-green-500' : 'bg-red-500'}`}></span>\n                      ${stream.name}\n                    </div>\n                  </td>\n                  <td class=\"px-6 py-4 whitespace-nowrap\">${stream.url}</td>\n                  <td class=\"px-6 py-4 whitespace-nowrap\">${stream.width}x${stream.height}</td>\n                  <td class=\"px-6 py-4 whitespace-nowrap\">${stream.fps}</td>\n                  <td class=\"px-6 py-4 whitespace-nowrap\">\n                    ${stream.record ? 'Enabled' : 'Disabled'}\n                    ${stream.detection_based_recording ? ' (Detection)' : ''}\n                  </td>\n                  <td class=\"px-6 py-4 whitespace-nowrap\">\n                    <div class=\"flex space-x-2\">\n                      <button\n                          class=\"p-1 rounded-full text-blue-600 hover:bg-blue-100 dark:text-blue-400 dark:hover:bg-blue-900 focus:outline-none\"\n                          onClick=${() => openEditStreamModal(stream.name)}\n                          title=\"Edit\"\n                      >\n                        <svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                          <path d=\"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z\"></path>\n                        </svg>\n                      </button>\n                      <button\n                          class=\"p-1 rounded-full text-red-600 hover:bg-red-100 dark:text-red-400 dark:hover:bg-red-900 focus:outline-none\"\n                          onClick=${() => openDeleteModal(stream)}\n                          title=\"Delete\"\n                      >\n                        <svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                          <path fill-rule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clip-rule=\"evenodd\"></path>\n                        </svg>\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              `)}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      <//>\n\n      ${deleteModalVisible && streamToDelete && html`\n        <${StreamDeleteModal}\n            streamId=${streamToDelete.name}\n            streamName=${streamToDelete.name}\n            onClose=${closeDeleteModal}\n            onDisable=${disableStream}\n            onDelete=${deleteStream}\n        />\n      `}\n\n      ${modalVisible && html`\n        <div id=\"stream-modal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300\">\n          <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto\">\n            <div class=\"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700\">\n              <h3 class=\"text-lg font-medium\">${isEditing ? 'Edit Stream' : 'Add Stream'}</h3>\n              <span class=\"text-2xl cursor-pointer\" onClick=${closeModal}>×</span>\n            </div>\n            <div class=\"p-4\">\n              <form id=\"stream-form\" class=\"space-y-4\">\n                <div class=\"form-group\">\n                  <label for=\"stream-name\" class=\"block text-sm font-medium mb-1\">Name</label>\n                  <input\n                      type=\"text\"\n                      id=\"stream-name\"\n                      name=\"name\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white ${isEditing ? 'bg-gray-100 dark:bg-gray-800' : ''}\"\n                      value=${currentStream.name}\n                      onChange=${handleInputChange}\n                      disabled=${isEditing}\n                      required\n                  />\n                </div>\n                <div class=\"form-group\">\n                  <label for=\"stream-url\" class=\"block text-sm font-medium mb-1\">URL</label>\n                  <input\n                      type=\"text\"\n                      id=\"stream-url\"\n                      name=\"url\"\n                      class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                      placeholder=\"rtsp://example.com/stream\"\n                      value=${currentStream.url}\n                      onChange=${handleInputChange}\n                      required\n                  />\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input\n                      type=\"checkbox\"\n                      id=\"stream-enabled\"\n                      name=\"enabled\"\n                      class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                      checked=${currentStream.enabled}\n                      onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-enabled\" class=\"ml-2 block text-sm\">Stream Active</label>\n                  <span class=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">Enable/disable all stream processing</span>\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input\n                      type=\"checkbox\"\n                      id=\"stream-streaming-enabled\"\n                      name=\"streamingEnabled\"\n                      class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                      checked=${currentStream.streamingEnabled}\n                      onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-streaming-enabled\" class=\"ml-2 block text-sm\">Live View Enabled</label>\n                  <span class=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">Enable/disable live viewing in browser</span>\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input\n                      type=\"checkbox\"\n                      id=\"stream-is-onvif\"\n                      name=\"isOnvif\"\n                      class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                      checked=${currentStream.isOnvif}\n                      onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-is-onvif\" class=\"ml-2 block text-sm\">ONVIF Camera</label>\n                  <span class=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">Mark this stream as an ONVIF camera for special handling</span>\n                </div>\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div class=\"form-group\">\n                    <label for=\"stream-width\" class=\"block text-sm font-medium mb-1\">Width</label>\n                    <input\n                        type=\"number\"\n                        id=\"stream-width\"\n                        name=\"width\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        min=\"320\"\n                        max=\"1920\"\n                        value=${currentStream.width}\n                        onChange=${handleInputChange}\n                    />\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-height\" class=\"block text-sm font-medium mb-1\">Height</label>\n                    <input\n                        type=\"number\"\n                        id=\"stream-height\"\n                        name=\"height\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        min=\"240\"\n                        max=\"1080\"\n                        value=${currentStream.height}\n                        onChange=${handleInputChange}\n                    />\n                  </div>\n                </div>\n                <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div class=\"form-group\">\n                    <label for=\"stream-fps\" class=\"block text-sm font-medium mb-1\">FPS</label>\n                    <input\n                        type=\"number\"\n                        id=\"stream-fps\"\n                        name=\"fps\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        min=\"1\"\n                        max=\"30\"\n                        value=${currentStream.fps}\n                        onChange=${handleInputChange}\n                    />\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-codec\" class=\"block text-sm font-medium mb-1\">Codec</label>\n                    <select\n                        id=\"stream-codec\"\n                        name=\"codec\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        value=${currentStream.codec}\n                        onChange=${handleInputChange}\n                    >\n                      <option value=\"h264\">H.264</option>\n                      <option value=\"h265\">H.265</option>\n                    </select>\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-protocol\" class=\"block text-sm font-medium mb-1\">Protocol</label>\n                    <select\n                        id=\"stream-protocol\"\n                        name=\"protocol\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        value=${currentStream.protocol}\n                        onChange=${handleInputChange}\n                    >\n                      <option value=\"0\">TCP</option>\n                      <option value=\"1\">UDP</option>\n                    </select>\n                    <span class=\"text-xs text-gray-500 dark:text-gray-400\">Connection protocol (ONVIF cameras use either TCP or UDP)</span>\n                  </div>\n                </div>\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div class=\"form-group\">\n                    <label for=\"stream-priority\" class=\"block text-sm font-medium mb-1\">Priority</label>\n                    <select\n                        id=\"stream-priority\"\n                        name=\"priority\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        value=${currentStream.priority}\n                        onChange=${handleInputChange}\n                    >\n                      <option value=\"1\">Low (1)</option>\n                      <option value=\"5\">Medium (5)</option>\n                      <option value=\"10\">High (10)</option>\n                    </select>\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-segment\" class=\"block text-sm font-medium mb-1\">Segment Duration (seconds)</label>\n                    <input\n                        type=\"number\"\n                        id=\"stream-segment\"\n                        name=\"segment\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        min=\"60\"\n                        max=\"3600\"\n                        value=${currentStream.segment}\n                        onChange=${handleInputChange}\n                    />\n                  </div>\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input\n                      type=\"checkbox\"\n                      id=\"stream-record\"\n                      name=\"record\"\n                      class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                      checked=${currentStream.record}\n                      onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-record\" class=\"ml-2 block text-sm\">Record</label>\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input\n                      type=\"checkbox\"\n                      id=\"stream-record-audio\"\n                      name=\"recordAudio\"\n                      class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                      checked=${currentStream.recordAudio}\n                      onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-record-audio\" class=\"ml-2 block text-sm\">Record Audio</label>\n                  <span class=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">Include audio in recordings if available in the stream</span>\n                </div>\n\n                <!-- Detection-based recording options -->\n                <div class=\"mt-6 mb-2 pb-1 border-b border-gray-200 dark:border-gray-700\">\n                  <h4 class=\"text-md font-medium\">Detection-Based Recording</h4>\n                </div>\n                <div class=\"form-group flex items-center\">\n                  <input\n                      type=\"checkbox\"\n                      id=\"stream-detection-enabled\"\n                      name=\"detectionEnabled\"\n                      class=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                      checked=${currentStream.detectionEnabled}\n                      onChange=${handleInputChange}\n                  />\n                  <label for=\"stream-detection-enabled\" class=\"ml-2 block text-sm\">Enable Detection-Based Recording</label>\n                  <span class=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">Only record when objects are detected</span>\n                </div>\n                <div class=\"form-group\" style=${currentStream.detectionEnabled ? '' : 'display: none'}>\n                  <label for=\"stream-detection-model\" class=\"block text-sm font-medium mb-1\">Detection Model</label>\n                  <div class=\"flex space-x-2\">\n                    <select\n                        id=\"stream-detection-model\"\n                        name=\"detectionModel\"\n                        class=\"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        value=${currentStream.detectionModel}\n                        onChange=${handleInputChange}\n                    >\n                      <option value=\"\">Select a model</option>\n                      ${detectionModels.map(model => html`\n                        <option key=${model.id} value=${model.id}>${model.name}</option>\n                      `)}\n                    </select>\n                    <button\n                        id=\"refresh-models-btn\"\n                        class=\"p-2 rounded-md bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none\"\n                        title=\"Refresh Models\"\n                        onClick=${loadDetectionModels}\n                        type=\"button\"\n                    >\n                      <svg class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n                        <path fill-rule=\"evenodd\" d=\"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z\" clip-rule=\"evenodd\"></path>\n                      </svg>\n                    </button>\n                  </div>\n                </div>\n                <div class=\"form-group\" style=${currentStream.detectionEnabled ? '' : 'display: none'}>\n                  <label for=\"stream-detection-threshold\" class=\"block text-sm font-medium mb-1\">Detection Threshold</label>\n                  <div class=\"flex items-center space-x-2\">\n                    <input\n                        type=\"range\"\n                        id=\"stream-detection-threshold\"\n                        name=\"detectionThreshold\"\n                        class=\"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700\"\n                        min=\"0\"\n                        max=\"100\"\n                        step=\"1\"\n                        value=${currentStream.detectionThreshold}\n                        onInput=${handleThresholdChange}\n                    />\n                    <span id=\"stream-threshold-value\" class=\"font-medium text-blue-600 dark:text-blue-400 min-w-[3rem] text-center\">\n                      ${currentStream.detectionThreshold}%\n                    </span>\n                  </div>\n                </div>\n                <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\" style=${currentStream.detectionEnabled ? '' : 'display: none'}>\n                  <div class=\"form-group\">\n                    <label for=\"stream-detection-interval\" class=\"block text-sm font-medium mb-1\">Detection Interval (frames)</label>\n                    <input\n                        type=\"number\"\n                        id=\"stream-detection-interval\"\n                        name=\"detectionInterval\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        min=\"1\"\n                        max=\"100\"\n                        value=${currentStream.detectionInterval}\n                        onChange=${handleInputChange}\n                    />\n                    <span class=\"text-xs text-gray-500 dark:text-gray-400\">Detect on every Nth frame</span>\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-pre-buffer\" class=\"block text-sm font-medium mb-1\">Pre-detection Buffer (seconds)</label>\n                    <input\n                        type=\"number\"\n                        id=\"stream-pre-buffer\"\n                        name=\"preBuffer\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        min=\"0\"\n                        max=\"60\"\n                        value=${currentStream.preBuffer}\n                        onChange=${handleInputChange}\n                    />\n                    <span class=\"text-xs text-gray-500 dark:text-gray-400\">Seconds to keep before detection</span>\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"stream-post-buffer\" class=\"block text-sm font-medium mb-1\">Post-detection Buffer (seconds)</label>\n                    <input\n                        type=\"number\"\n                        id=\"stream-post-buffer\"\n                        name=\"postBuffer\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        min=\"0\"\n                        max=\"300\"\n                        value=${currentStream.postBuffer}\n                        onChange=${handleInputChange}\n                    />\n                    <span class=\"text-xs text-gray-500 dark:text-gray-400\">Seconds to keep after detection</span>\n                  </div>\n                </div>\n              </form>\n            </div>\n            <div class=\"flex justify-between p-4 border-t border-gray-200 dark:border-gray-700\">\n              <button\n                  id=\"stream-test-btn\"\n                  class=\"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600\"\n                  onClick=${testStreamConnection}\n                  type=\"button\"\n              >\n                Test Connection\n              </button>\n              <div class=\"space-x-2\">\n                <button\n                    id=\"stream-save-btn\"\n                    class=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\n                    onClick=${saveStream}\n                    type=\"button\"\n                >\n                  Save\n                </button>\n                <button\n                    id=\"stream-cancel-btn\"\n                    class=\"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors\"\n                    onClick=${closeModal}\n                    type=\"button\"\n                >\n                  Cancel\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      `}\n\n      ${onvifModalVisible && html`\n        <div id=\"onvif-modal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300\">\n          <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n            <div class=\"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700\">\n              <h3 class=\"text-lg font-medium\">ONVIF Camera Discovery</h3>\n              <span class=\"text-2xl cursor-pointer\" onClick=${() => setOnvifModalVisible(false)}>×</span>\n            </div>\n            <div class=\"p-4\">\n              <div class=\"mb-4 flex justify-between items-center\">\n                <h4 class=\"text-md font-medium\">Discovered Devices</h4>\n                <button\n                    id=\"discover-btn\"\n                    class=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors focus:outline-none\"\n                    onClick=${startOnvifDiscovery}\n                    disabled=${isDiscovering}\n                    type=\"button\"\n                >\n                  ${isDiscovering ? html`\n                    <span class=\"flex items-center\">\n                      Discovering\n                      <span class=\"ml-1 flex space-x-1\">\n                        <span class=\"animate-pulse delay-0 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                        <span class=\"animate-pulse delay-150 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                        <span class=\"animate-pulse delay-300 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                      </span>\n                    </span>\n                  ` : 'Start Discovery'}\n                </button>\n              </div>\n\n              <div class=\"overflow-x-auto\">\n                <table class=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n                  <thead class=\"bg-gray-50 dark:bg-gray-700\">\n                  <tr>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">IP Address</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Manufacturer</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Model</th>\n                    <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Actions</th>\n                  </tr>\n                  </thead>\n                  <tbody class=\"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700\">\n                  ${discoveredDevices.length === 0 ? html`\n                    <tr>\n                      <td colspan=\"4\" class=\"px-6 py-4 text-center text-gray-500 dark:text-gray-400\">\n                        ${isDiscovering ? html`\n                          <div class=\"flex items-center justify-center\">\n                            <span>Discovering devices</span>\n                            <span class=\"ml-1 flex space-x-1\">\n                                <span class=\"animate-pulse delay-0 h-1.5 w-1.5 bg-gray-500 dark:bg-gray-400 rounded-full\"></span>\n                                <span class=\"animate-pulse delay-150 h-1.5 w-1.5 bg-gray-500 dark:bg-gray-400 rounded-full\"></span>\n                                <span class=\"animate-pulse delay-300 h-1.5 w-1.5 bg-gray-500 dark:bg-gray-400 rounded-full\"></span>\n                              </span>\n                          </div>\n                        ` : 'No devices discovered yet. Click \"Start Discovery\" to scan your network.'}\n                      </td>\n                    </tr>\n                  ` : discoveredDevices.map(device => html`\n                    <tr key=${device.ip_address} class=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\n                      <td class=\"px-6 py-4 whitespace-nowrap\">${device.ip_address}</td>\n                      <td class=\"px-6 py-4 whitespace-nowrap\">${device.manufacturer || 'Unknown'}</td>\n                      <td class=\"px-6 py-4 whitespace-nowrap\">${device.model || 'Unknown'}</td>\n                      <td class=\"px-6 py-4 whitespace-nowrap\">\n                        <button\n                            class=\"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors focus:outline-none\"\n                            onClick=${() => testOnvifConnection(device)}\n                            disabled=${isLoadingProfiles && selectedDevice && selectedDevice.ip_address === device.ip_address}\n                            type=\"button\"\n                        >\n                          ${isLoadingProfiles && selectedDevice && selectedDevice.ip_address === device.ip_address ? html`\n                            <span class=\"flex items-center\">\n                                Loading\n                                <span class=\"ml-1 flex space-x-1\">\n                                  <span class=\"animate-pulse delay-0 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                                  <span class=\"animate-pulse delay-150 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                                  <span class=\"animate-pulse delay-300 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                                </span>\n                              </span>\n                          ` : 'Connect'}\n                        </button>\n                      </td>\n                    </tr>\n                  `)}\n                  </tbody>\n                </table>\n              </div>\n\n              <div class=\"mt-6 mb-4\">\n                <h4 class=\"text-md font-medium mb-2\">Authentication</h4>\n                <p class=\"text-sm text-gray-500 dark:text-gray-400 mb-3\">\n                  Enter credentials to connect to the selected ONVIF device. Credentials are not needed for discovery, only for connecting to devices.\n                </p>\n                <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div class=\"form-group\">\n                    <label for=\"onvif-username\" class=\"block text-sm font-medium mb-1\">Username</label>\n                    <input\n                        type=\"text\"\n                        id=\"onvif-username\"\n                        name=\"username\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        placeholder=\"admin\"\n                        value=${onvifCredentials.username}\n                        onChange=${handleCredentialChange}\n                    />\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"onvif-password\" class=\"block text-sm font-medium mb-1\">Password</label>\n                    <input\n                        type=\"password\"\n                        id=\"onvif-password\"\n                        name=\"password\"\n                        class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                        placeholder=\"password\"\n                        value=${onvifCredentials.password}\n                        onChange=${handleCredentialChange}\n                    />\n                  </div>\n                </div>\n              </div>\n\n              ${selectedDevice && deviceProfiles.length > 0 && html`\n                <div class=\"mt-6\">\n                  <h4 class=\"text-md font-medium mb-2\">Available Profiles for ${selectedDevice.ip_address}</h4>\n                  <div class=\"overflow-x-auto\">\n                    <table class=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n                      <thead class=\"bg-gray-50 dark:bg-gray-700\">\n                      <tr>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Name</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Resolution</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Encoding</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">FPS</th>\n                        <th class=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">Actions</th>\n                      </tr>\n                      </thead>\n                      <tbody class=\"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700\">\n                      ${deviceProfiles.map(profile => html`\n                        <tr key=${profile.token} class=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\n                          <td class=\"px-6 py-4 whitespace-nowrap\">${profile.name}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap\">${profile.width}x${profile.height}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap\">${profile.encoding}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap\">${profile.fps}</td>\n                          <td class=\"px-6 py-4 whitespace-nowrap\">\n                            <button\n                                class=\"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition-colors focus:outline-none\"\n                                onClick=${() => addOnvifDeviceAsStream(profile)}\n                                type=\"button\"\n                            >\n                              Add as Stream\n                            </button>\n                          </td>\n                        </tr>\n                      `)}\n                      </tbody>\n                    </table>\n                  </div>\n                </div>\n              `}\n            </div>\n            <div class=\"flex justify-end p-4 border-t border-gray-200 dark:border-gray-700\">\n              <button\n                  id=\"onvif-close-btn\"\n                  class=\"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors\"\n                  onClick=${() => setOnvifModalVisible(false)}\n                  type=\"button\"\n              >\n                Close\n              </button>\n            </div>\n          </div>\n        </div>\n      `}\n\n      ${showCustomNameInput && html`\n        <div id=\"custom-name-modal\" class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300\">\n          <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full\">\n            <div class=\"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700\">\n              <h3 class=\"text-lg font-medium\">Stream Name</h3>\n              <span class=\"text-2xl cursor-pointer\" onClick=${() => setShowCustomNameInput(false)}>×</span>\n            </div>\n            <div class=\"p-4\">\n              <div class=\"mb-4\">\n                <label for=\"custom-stream-name\" class=\"block text-sm font-medium mb-1\">Enter a name for this stream:</label>\n                <input\n                    type=\"text\"\n                    id=\"custom-stream-name\"\n                    class=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                    value=${customStreamName}\n                    onChange=${(e) => setCustomStreamName(e.target.value)}\n                />\n                <p class=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\n                  This name will be used to identify the stream in the system.\n                </p>\n              </div>\n            </div>\n            <div class=\"flex justify-end p-4 border-t border-gray-200 dark:border-gray-700 space-x-2\">\n              <button\n                  class=\"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors\"\n                  onClick=${() => setShowCustomNameInput(false)}\n                  type=\"button\"\n              >\n                Cancel\n              </button>\n              <button\n                  class=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors\"\n                  onClick=${submitOnvifDevice}\n                  type=\"button\"\n                  disabled=${!customStreamName.trim() || isAddingStream}\n              >\n                ${isAddingStream ? html`\n                  <span class=\"flex items-center\">\n                    Adding\n                    <span class=\"ml-1 flex space-x-1\">\n                      <span class=\"animate-pulse delay-0 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                      <span class=\"animate-pulse delay-150 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                      <span class=\"animate-pulse delay-300 h-1.5 w-1.5 bg-white rounded-full\"></span>\n                    </span>\n                  </span>\n                ` : 'Add Stream'}\n              </button>\n            </div>\n          </div>\n        </div>\n      `}\n    </section>\n  `;\n}\n\n/**\n * Load StreamsView component\n */\nexport function loadStreamsView() {\n  const mainContent = document.getElementById('main-content');\n  if (!mainContent) return;\n\n  // Render the StreamsView component to the container\n  import('preact').then(({ render }) => {\n    import('../../query-client.js').then(({ QueryClientProvider, queryClient }) => {\n      render(\n        html`<${QueryClientProvider} client=${queryClient}><${StreamsView} /></${QueryClientProvider}>`,\n        mainContent\n      );\n    });\n  });\n}"],"names":["StreamDeleteModal","streamId","streamName","onClose","onDisable","onDelete","isConfirmDelete","setIsConfirmDelete","useState","html","handleDelete","handleDisable","showDeleteConfirmation","StreamsView","queryClient","useQueryClient","modalVisible","setModalVisible","onvifModalVisible","setOnvifModalVisible","showCustomNameInput","setShowCustomNameInput","isAddingStream","setIsAddingStream","discoveredDevices","setDiscoveredDevices","deviceProfiles","setDeviceProfiles","selectedDevice","setSelectedDevice","selectedProfile","setSelectedProfile","customStreamName","setCustomStreamName","onvifCredentials","setOnvifCredentials","username","password","isDiscovering","setIsDiscovering","isLoadingProfiles","setIsLoadingProfiles","data","streamsResponse","isLoading","error","useQuery","timeout","retries","retryDelay","detectionModelsData","streams","Array","isArray","console","log","length","currentStream","setCurrentStream","name","url","enabled","streamingEnabled","width","height","fps","codec","protocol","priority","segment","record","recordAudio","detectionEnabled","detectionModel","detectionThreshold","detectionInterval","preBuffer","postBuffer","isEditing","setIsEditing","deleteModalVisible","setDeleteModalVisible","streamToDelete","setStreamToDelete","hasData","detectionModels","models","createStreamMutation","useMutation","mutationFn","async","fetchJSON","method","headers","body","JSON","stringify","streamData","onSuccess","showStatusMessage","closeModal","invalidateQueries","queryKey","onError","message","updateStreamMutation","encodeURIComponent","saveStreamMutation","mutate","options","testStreamMutation","parseInt","success","deleteStreamMutation","permanent","closeDeleteModal","_","variables","handleInputChange","e","value","type","checked","target","prev","handleCredentialChange","onvifDiscoveryMutation","devices","getDeviceProfilesMutation","device","credentials","ip_address","profiles","testOnvifConnectionMutation","getDeviceProfiles","openAddStreamModal","ContentLoader","map","stream","detection_based_recording","fetchQuery","queryFn","response","fetch","ok","Error","status","json","staleTime","toString","segment_duration","detection_threshold","detection_interval","pre_detection_buffer","post_detection_buffer","undefined","streaming_enabled","isOnvif","is_onvif","detection_model","record_audio","openEditStreamModal","openDeleteModal","model","id","loadDetectionModels","testStreamConnection","preventDefault","is_deleted","handleSubmit","startOnvifDiscovery","manufacturer","testOnvifConnection","profile","token","encoding","addOnvifDeviceAsStream","submitOnvifDevice","trim","stream_uri","mainContent","document","getElementById","__vitePreload","render","module","import","then","n","p","meta","QueryClientProvider"],"mappings":"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"}