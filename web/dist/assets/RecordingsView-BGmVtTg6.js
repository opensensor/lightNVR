const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./preact-app-cKG-SFd7.js","../css/preact-app.css"])))=>i.map(i=>d[i]);
var Z=Object.freeze,Oe=Object.defineProperty;var f=(e,t)=>Z(Oe(e,"raw",{value:Z(t||e.slice())}));import{h as D,f as j,g as Be,i as Ue,u as U,c as m,j as M,k as H,d as v,A as He,y as T,D as je,_ as ee,l as Ve}from"./preact-app-cKG-SFd7.js";import{C as We}from"./LoadingIndicator-DhzNKPnx.js";var te,ae;function qe({filters:e,setFilters:t,pagination:r,setPagination:o,streams:a,filtersVisible:l,applyFilters:n,resetFilters:c,handleDateRangeChange:g,setDefaultDateRange:h}){return D(ae||(ae=f(['\n    <aside id="filters-sidebar" \n           class=','>\n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Date Range</h3>\n        <div class="filter-option mb-2">\n          <label for="date-range-select" class="block mb-1 text-sm font-medium">Quick Select:</label>\n          <select id="date-range-select" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="today">Today</option>\n            <option value="yesterday">Yesterday</option>\n            <option value="last7days">Last 7 Days</option>\n            <option value="last30days">Last 30 Days</option>\n            <option value="custom">Custom Range</option>\n          </select>\n        </div>\n        \n        <div id="custom-date-range" \n             class="filter-option space-y-3"\n             style=','>\n          <div class="space-y-1">\n            <label for="start-date" class="block text-sm font-medium">Start Date:</label>\n            <input type="date" id="start-date" \n                   class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                   value=',"\n                   onChange=",' />\n            <div class="mt-1">\n              <label for="start-time" class="block text-sm font-medium">Time:</label>\n              <input type="time" id="start-time" \n                     class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                     value=',"\n                     onChange=",' />\n            </div>\n          </div>\n          \n          <div class="space-y-1">\n            <label for="end-date" class="block text-sm font-medium">End Date:</label>\n            <input type="date" id="end-date" \n                   class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                   value=',"\n                   onChange=",' />\n            <div class="mt-1">\n              <label for="end-time" class="block text-sm font-medium">Time:</label>\n              <input type="time" id="end-time" \n                     class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                     value=',"\n                     onChange=",' />\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Stream</h3>\n        <div class="filter-option">\n          <select id="stream-filter" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="all">All Streams</option>\n            ','\n          </select>\n        </div>\n      </div>\n      \n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Recording Type</h3>\n        <div class="filter-option">\n          <select id="detection-filter" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="all">All Recordings</option>\n            <option value="detection">Detection Events Only</option>\n          </select>\n        </div>\n      </div>\n      \n      <div class="filter-group mb-4">\n        <h3 class="text-lg font-medium mb-2 pb-1 border-b border-gray-200 dark:border-gray-700">Display Options</h3>\n        <div class="filter-option">\n          <label for="page-size" class="block mb-1 text-sm font-medium">Items per page:</label>\n          <select id="page-size" \n                  class="w-full p-2 border border-gray-300 rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"\n                  value=',"\n                  onChange=",'>\n            <option value="10">10</option>\n            <option value="20">20</option>\n            <option value="50">50</option>\n            <option value="100">100</option>\n          </select>\n        </div>\n      </div>\n      \n      <div class="filter-actions flex space-x-2">\n        <button id="apply-filters-btn" \n                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"\n                onClick=','>\n          Apply Filters\n        </button>\n        <button id="reset-filters-btn" \n                class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"\n                onClick=',">\n          Reset\n        </button>\n      </div>\n    </aside>\n  "])),"filters-sidebar w-full md:w-64 bg-white dark:bg-gray-800 rounded-lg shadow p-4 md:sticky md:top-4 md:self-start transition-all duration-300 ".concat(l?"":"hidden md:block"),e.dateRange,g,e.dateRange==="custom"?"display: block":"display: none",e.startDate,i=>t(u=>({...u,startDate:i.target.value})),e.startTime,i=>t(u=>({...u,startTime:i.target.value})),e.endDate,i=>t(u=>({...u,endDate:i.target.value})),e.endTime,i=>t(u=>({...u,endTime:i.target.value})),e.streamId,i=>t(u=>({...u,streamId:i.target.value})),a.map(i=>D(te||(te=f(["\n              <option key="," value=",">","</option>\n            "])),i.name,i.name,i.name)),e.recordingType,i=>t(u=>({...u,recordingType:i.target.value})),r.pageSize,i=>o(u=>({...u,pageSize:parseInt(i.target.value,10)})),n,c)}var re,se;function Ne({activeFiltersDisplay:e,removeFilter:t,hasActiveFilters:r}){return r?D(se||(se=f(['\n    <div id="active-filters" \n         class="active-filters mb-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex flex-wrap gap-2">\n      ',"\n    </div>\n  "])),e.map((o,a)=>D(re||(re=f(["\n        <div key=",' class="filter-tag inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-200">\n          <span>','</span>\n          <button class="ml-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 focus:outline-none"\n                  onClick=',">\n            ×\n          </button>\n        </div>\n      "])),a,o.label,()=>t(o.key)))):null}const V={formatDateTime:e=>e?new Date(e).toLocaleString():"",formatDuration:e=>{if(!e)return"00:00:00";const t=Math.floor(e/3600),r=Math.floor(e%3600/60),o=Math.floor(e%60);return[t.toString().padStart(2,"0"),r.toString().padStart(2,"0"),o.toString().padStart(2,"0")].join(":")},formatFileSize:e=>{if(!e)return"0 B";const t=["B","KB","MB","GB","TB"];let r=0,o=e;for(;o>=1024&&r<t.length-1;)o/=1024,r++;return"".concat(o.toFixed(1)," ").concat(t[r])}};var oe,ne,ie,de,le,ce,ge;function Ke({recordings:e,sortField:t,sortDirection:r,sortBy:o,selectedRecordings:a,toggleRecordingSelection:l,selectAll:n,toggleSelectAll:c,getSelectedCount:g,openDeleteModal:h,playRecording:i,downloadRecording:u,deleteRecording:b,recordingsTableBodyRef:k,pagination:z}){return D(ge||(ge=f(['\n    <div class="recordings-container bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden w-full">\n      <div class="batch-actions p-3 border-b border-gray-200 dark:border-gray-700 flex flex-wrap gap-2 items-center">\n        <div class="selected-count text-sm text-gray-600 dark:text-gray-400 mr-2">\n          ','\n        </div>\n        <button \n          class="px-3 py-1.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"\n          disabled=',"\n          onClick=",'>\n          Delete Selected\n        </button>\n        <button \n          class="px-3 py-1.5 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"\n          onClick=','>\n          Delete All Filtered\n        </button>\n      </div>\n      <div class="overflow-x-auto">\n        <table id="recordings-table" class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">\n          <thead class="bg-gray-50 dark:bg-gray-700">\n            <tr>\n              <th class="w-10 px-4 py-3">\n                <input \n                  type="checkbox" \n                  checked=',"\n                  onChange=",'\n                  class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"\n                />\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer"\n                  onClick=','>\n                <div class="flex items-center">\n                  Stream\n                  ','\n                </div>\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer"\n                  onClick=','>\n                <div class="flex items-center">\n                  Start Time\n                  ','\n                </div>\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">\n                Duration\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer"\n                  onClick=','>\n                <div class="flex items-center">\n                  Size\n                  ','\n                </div>\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">\n                Detections\n              </th>\n              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">\n                Actions\n              </th>\n            </tr>\n          </thead>\n          <tbody ref=',' class="bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700">\n            ',"\n          </tbody>\n        </table>\n      </div>\n    </div>\n  "])),g()>0?"".concat(g()," recording").concat(g()!==1?"s":""," selected"):"No recordings selected",g()===0,()=>h("selected"),()=>h("all"),n,c,()=>o("stream_name"),t==="stream_name"&&D(oe||(oe=f(['\n                    <span class="sort-icon ml-1">',"</span>\n                  "])),r==="asc"?"▲":"▼"),()=>o("start_time"),t==="start_time"&&D(ne||(ne=f(['\n                    <span class="sort-icon ml-1">',"</span>\n                  "])),r==="asc"?"▲":"▼"),()=>o("size_bytes"),t==="size_bytes"&&D(ie||(ie=f(['\n                    <span class="sort-icon ml-1">',"</span>\n                  "])),r==="asc"?"▲":"▼"),k,e.length===0?D(de||(de=f(['\n              <tr>\n                <td colspan="6" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">\n                  ',"\n                </td>\n              </tr>\n            "])),z.totalItems===0?"No recordings found":"Loading recordings..."):e.map($=>D(ce||(ce=f(["\n              <tr key=",' class="hover:bg-gray-50 dark:hover:bg-gray-700">\n                <td class="px-4 py-4 whitespace-nowrap">\n                  <input \n                    type="checkbox" \n                    checked=',"\n                    onChange=",'\n                    class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"\n                  />\n                </td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">','</td>\n                <td class="px-6 py-4 whitespace-nowrap">\n                  ','\n                </td>\n                <td class="px-6 py-4 whitespace-nowrap">\n                  <div class="flex space-x-2">\n                    <button class="p-1 rounded-full text-blue-600 hover:bg-blue-100 dark:text-blue-400 dark:hover:bg-blue-900 focus:outline-none"\n                            onClick=','\n                            title="Play">\n                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>\n                      </svg>\n                    </button>\n                    <button class="p-1 rounded-full text-green-600 hover:bg-green-100 dark:text-green-400 dark:hover:bg-green-900 focus:outline-none"\n                            onClick=','\n                            title="Download">\n                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>\n                      </svg>\n                    </button>\n                    <button class="p-1 rounded-full text-red-600 hover:bg-red-100 dark:text-red-400 dark:hover:bg-red-900 focus:outline-none"\n                            onClick=','\n                            title="Delete">\n                      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path>\n                      </svg>\n                    </button>\n                  </div>\n                </td>\n              </tr>\n            '])),$.id,!!a[$.id],()=>l($.id),$.stream||"",V.formatDateTime($.start_time),V.formatDuration($.duration),$.size||"",$.has_detections?D(le||(le=f(['\n                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100">\n                      <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>\n                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>\n                      </svg>\n                      Yes\n                    </span>\n                  ']))):"",()=>i($),()=>u($),()=>b($))))}var ue;function Qe({pagination:e,goToPage:t}){return D(ue||(ue=f(['\n    <div class="pagination-controls flex flex-col sm:flex-row justify-between items-center p-4 border-t border-gray-200 dark:border-gray-700">\n      <div class="pagination-info text-sm text-gray-600 dark:text-gray-400 mb-2 sm:mb-0">\n        Showing <span id="pagination-showing">',"-",'</span> of <span id="pagination-total">','</span> recordings\n      </div>\n      <div class="pagination-buttons flex items-center space-x-1">\n        <button id="pagination-first" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="First Page"\n                onClick=',"\n                disabled=",'>\n          «\n        </button>\n        <button id="pagination-prev" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="Previous Page"\n                onClick=',"\n                disabled=",'>\n          ‹\n        </button>\n        <span id="pagination-current" class="px-2 text-sm text-gray-700 dark:text-gray-300">\n          Page '," of ",'\n        </span>\n        <button id="pagination-next" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="Next Page"\n                onClick=',"\n                disabled=",'>\n          ›\n        </button>\n        <button id="pagination-last" \n                class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"\n                title="Last Page"\n                onClick=',"\n                disabled=",">\n          »\n        </button>\n      </div>\n    </div>\n  "])),e.startItem,e.endItem,e.totalItems,()=>t(1),e.currentPage===1,()=>t(e.currentPage-1),e.currentPage===1,e.currentPage,e.totalPages,()=>t(e.currentPage+1),e.currentPage===e.totalPages,()=>t(e.totalPages),e.currentPage===e.totalPages)}const y={hooks:{useStreams:()=>U("streams","/api/streams",{timeout:15e3,retries:2,retryDelay:1e3}),useRecordings:(e,t,r,o)=>{const a=new URLSearchParams;if(a.append("page",t.currentPage),a.append("limit",t.pageSize),a.append("sort",r),a.append("order",o),e.dateRange==="custom")a.append("start","".concat(e.startDate,"T").concat(e.startTime,":00")),a.append("end","".concat(e.endDate,"T").concat(e.endTime,":00"));else{const{start:n,end:c}=y.getDateRangeFromPreset(e.dateRange);a.append("start",n),a.append("end",c)}return e.streamId!=="all"&&a.append("stream",e.streamId),e.recordingType==="detection"&&a.append("detection","1"),U(["recordings",e,t,r,o],"/api/recordings?".concat(a.toString()),{timeout:3e4,retries:2,retryDelay:1e3},{onSuccess:async n=>{if(n.recordings&&n.recordings.length>0)for(let g=0;g<n.recordings.length;g+=5){const h=n.recordings.slice(g,g+5);await Promise.all(h.map(async i=>{try{i.has_detections=await y.checkRecordingHasDetections(i)}catch(u){console.error("Error checking detections for recording ".concat(i.id,":"),u),i.has_detections=!1}}))}}})},useRecordingDetections:e=>{if(!e||!e.id||!e.stream||!e.start_time||!e.end_time)return{data:{detections:[]}};const t=Math.floor(new Date(e.start_time).getTime()/1e3),r=Math.floor(new Date(e.end_time).getTime()/1e3),o=new URLSearchParams({start:t,end:r});return U(["recording-detections",e.id],"/api/detection/results/".concat(e.stream,"?").concat(o.toString()),{timeout:15e3,retries:1,retryDelay:1e3},{enabled:!!e.id})},useDeleteRecording:()=>{const e=j();return Ue("/api/recordings/:id",{timeout:15e3,retries:1,retryDelay:1e3},{onSuccess:()=>{e.invalidateQueries({queryKey:["recordings"]}),m("Recording deleted successfully")},onError:t=>{console.error("Error deleting recording:",t),m("Error deleting recording: "+t.message)}})},useBatchDeleteRecordings:()=>{const e=j();return Be("/api/recordings/batch-delete",{timeout:6e4,retries:1,retryDelay:2e3},{onSuccess:t=>{e.invalidateQueries({queryKey:["recordings"]});const r=t.succeeded,o=t.failed;r>0&&o===0?m("Successfully deleted ".concat(r," recording").concat(r!==1?"s":"")):r>0&&o>0?m("Deleted ".concat(r," recording").concat(r!==1?"s":"",", but failed to delete ").concat(o)):m("Failed to delete ".concat(o," recording").concat(o!==1?"s":""))},onError:t=>{console.error("Error in batch delete operation:",t),m("Error in batch delete operation: "+t.message)}})}},loadStreams:async()=>{try{return await M("/api/streams",{timeout:15e3,retries:2,retryDelay:1e3})||[]}catch(e){return console.error("Error loading streams for filter:",e),m("Error loading streams: "+e.message),[]}},getDateRangeFromPreset:e=>{const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59),o=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0);let a,l;switch(e){case"today":a=o.toISOString(),l=r.toISOString();break;case"yesterday":const n=new Date(o);n.setDate(n.getDate()-1);const c=new Date(n);c.setHours(23,59,59),a=n.toISOString(),l=c.toISOString();break;case"last7days":const g=new Date(o);g.setDate(g.getDate()-7),a=g.toISOString(),l=r.toISOString();break;case"last30days":const h=new Date(o);h.setDate(h.getDate()-30),a=h.toISOString(),l=r.toISOString();break;default:const i=new Date(o);i.setDate(i.getDate()-7),a=i.toISOString(),l=r.toISOString()}return{start:a,end:l}},loadRecordings:async(e,t,r,o)=>{try{const a=new URLSearchParams;if(a.append("page",t.currentPage),a.append("limit",t.pageSize),a.append("sort",r),a.append("order",o),e.dateRange==="custom")a.append("start","".concat(e.startDate,"T").concat(e.startTime,":00")),a.append("end","".concat(e.endDate,"T").concat(e.endTime,":00"));else{const{start:n,end:c}=y.getDateRangeFromPreset(e.dateRange);a.append("start",n),a.append("end",c)}e.streamId!=="all"&&a.append("stream",e.streamId),e.recordingType==="detection"&&a.append("detection","1"),console.log("API Request:","/api/recordings?".concat(a.toString()));const l=await M("/api/recordings?".concat(a.toString()),{timeout:3e4,retries:2,retryDelay:1e3});if(console.log("Recordings data received:",l),l.recordings&&l.recordings.length>0)for(let c=0;c<l.recordings.length;c+=5){const g=l.recordings.slice(c,c+5);await Promise.all(g.map(async h=>{try{h.has_detections=await y.checkRecordingHasDetections(h)}catch(i){console.error("Error checking detections for recording ".concat(h.id,":"),i),h.has_detections=!1}}))}return l}catch(a){throw console.error("Error loading recordings:",a),m("Error loading recordings: "+a.message),a}},deleteRecording:async e=>{try{return await H("/api/recordings/".concat(e.id),{method:"DELETE",timeout:15e3,retries:1,retryDelay:1e3}),m("Recording deleted successfully"),!0}catch(t){return console.error("Error deleting recording:",t),m("Error deleting recording: "+t.message),!1}},deleteSelectedRecordings:async e=>{const t=Object.entries(e).filter(([r,o])=>o).map(([r,o])=>parseInt(r,10));if(t.length===0)return m("No recordings selected"),{succeeded:0,failed:0};try{if(window.wsClient&&window.wsClient.isConnected()){if(console.log("Using WebSocket for batch delete operation"),!window.batchDeleteClient)if(typeof BatchDeleteRecordingsClient<"u")window.batchDeleteClient=new BatchDeleteRecordingsClient(window.wsClient);else return console.warn("BatchDeleteRecordingsClient not available, falling back to HTTP"),y.deleteSelectedRecordingsHttp(t);return typeof showBatchDeleteModal=="function"&&showBatchDeleteModal(),await window.batchDeleteClient.deleteWithProgress({ids:t})}else return console.log("WebSocket not connected, using HTTP for batch delete"),y.deleteSelectedRecordingsHttp(t)}catch(r){return console.error("Error in batch delete operation:",r),m("Error in batch delete operation: "+r.message),{succeeded:0,failed:0}}},deleteSelectedRecordingsHttp:async e=>{try{const r=await(await H("/api/recordings/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:e}),timeout:6e4,retries:1,retryDelay:2e3})).json(),o=r.succeeded,a=r.failed;return o>0&&a===0?m("Successfully deleted ".concat(o," recording").concat(o!==1?"s":"")):o>0&&a>0?m("Deleted ".concat(o," recording").concat(o!==1?"s":"",", but failed to delete ").concat(a)):m("Failed to delete ".concat(a," recording").concat(a!==1?"s":"")),r}catch(t){return console.error("Error in HTTP batch delete operation:",t),m("Error in batch delete operation: "+t.message),{succeeded:0,failed:0}}},deleteAllFilteredRecordings:async e=>{try{const t={};if(e.dateRange==="custom")t.start="".concat(e.startDate,"T").concat(e.startTime,":00"),t.end="".concat(e.endDate,"T").concat(e.endTime,":00");else{const{start:a,end:l}=y.getDateRangeFromPreset(e.dateRange);t.start=a,t.end=l}e.streamId!=="all"&&(t.stream_name=e.streamId),e.recordingType==="detection"&&(t.detection=1),console.log("Deleting with filter:",t),typeof showBatchDeleteModal=="function"&&(showBatchDeleteModal(),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:0,succeeded:0,failed:0,status:"Preparing to delete recordings matching filter...",complete:!1}));let r=0;try{const a=new URLSearchParams;t.start&&a.append("start",t.start),t.end&&a.append("end",t.end),t.stream_name&&a.append("stream",t.stream_name),t.detection&&a.append("detection","1"),a.append("page","1"),a.append("limit","1"),console.log("Getting total count with params:",a.toString());const l=await fetch("/api/recordings?".concat(a.toString()));if(l.ok){const n=await l.json();n&&n.pagination&&n.pagination.total&&(r=n.pagination.total,console.log("Found ".concat(r," recordings matching filter")),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:r,succeeded:0,failed:0,status:"Found ".concat(r," recordings matching filter. Starting deletion..."),complete:!1}))}}catch(a){console.warn("Error getting recording count:",a)}const o=a=>(console.error("Error in delete all operation:",a),m("Error in delete all operation: "+a.message),typeof window.updateBatchDeleteProgress=="function"&&window.updateBatchDeleteProgress({current:0,total:0,succeeded:0,failed:0,status:"Error: ".concat(a.message),complete:!0}),{succeeded:0,failed:0});if(window.wsClient&&window.wsClient.isConnected()){if(console.log("Using WebSocket for batch delete with filter"),!window.batchDeleteClient)if(typeof BatchDeleteRecordingsClient<"u")window.batchDeleteClient=new BatchDeleteRecordingsClient(window.wsClient);else return console.warn("BatchDeleteRecordingsClient not available, falling back to HTTP"),y.deleteAllFilteredRecordingsHttp(t);const a=new Promise((l,n)=>{setTimeout(()=>{n(new Error("Operation timed out or server crashed. Some recordings may have been deleted."))},6e4)});try{return await Promise.race([window.batchDeleteClient.deleteWithProgress({filter:t,totalCount:r}),a])}catch(l){return console.error("WebSocket error or timeout:",l),setTimeout(()=>{typeof loadRecordings=="function"&&loadRecordings()},1e3),o(l)}}else return console.log("WebSocket not connected, using HTTP for batch delete with filter"),y.deleteAllFilteredRecordingsHttp(t)}catch(t){return console.error("Error in delete all operation:",t),m("Error in delete all operation: "+t.message),{succeeded:0,failed:0}}},deleteAllFilteredRecordingsHttp:async e=>{try{const r=await(await H("/api/recordings/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filter:e}),timeout:12e4,retries:1,retryDelay:3e3})).json(),o=r.succeeded,a=r.failed;return o>0&&a===0?m("Successfully deleted ".concat(o," recording").concat(o!==1?"s":"")):o>0&&a>0?m("Deleted ".concat(o," recording").concat(o!==1?"s":"",", but failed to delete ").concat(a)):m("Failed to delete ".concat(a," recording").concat(a!==1?"s":"")),r}catch(t){return console.error("Error in HTTP delete all operation:",t),m("Error in delete all operation: "+t.message),{succeeded:0,failed:0}}},checkRecordingHasDetections:async e=>{if(!e||!e.id||!e.stream||!e.start_time||!e.end_time)return!1;try{const t=Math.floor(new Date(e.start_time).getTime()/1e3),r=Math.floor(new Date(e.end_time).getTime()/1e3),o=new URLSearchParams({start:t,end:r}),a=await M("/api/detection/results/".concat(e.stream,"?").concat(o.toString()),{timeout:1e4,retries:1,retryDelay:500});return a.detections&&a.detections.length>0}catch(t){return console.error("Error checking detections:",t),!1}},getRecordingDetections:async e=>{if(!e||!e.id||!e.stream||!e.start_time||!e.end_time)return[];try{const t=Math.floor(new Date(e.start_time).getTime()/1e3),r=Math.floor(new Date(e.end_time).getTime()/1e3),o=new URLSearchParams({start:t,end:r});return(await M("/api/detection/results/".concat(e.stream,"?").concat(o.toString()),{timeout:15e3,retries:1,retryDelay:1e3})).detections||[]}catch(t){return console.error("Error getting detections:",t),[]}},playRecording:(e,t)=>{if(console.log("Play recording clicked:",e),!e.id){console.error("Recording has no id property:",e),m("Error: Recording has no id property");return}const r="/api/recordings/play/".concat(e.id),o="".concat(e.stream," - ").concat(V.formatDateTime(e.start_time)),a="/api/recordings/download/".concat(e.id);console.log("Video URL:",r),console.log("Title:",o),console.log("Download URL:",a),t(r,o,a),console.log("Video modal should be shown now")},downloadRecording:e=>{const t="/api/recordings/download/".concat(e.id),r=document.createElement("a");r.href=t,r.download="".concat(e.stream,"_").concat(new Date(e.start_time).toISOString().replace(/[:.]/g,"-"),".mp4"),document.body.appendChild(r),r.click(),document.body.removeChild(r),m("Download started")}},C={getFiltersFromUrl:()=>{const e=new URLSearchParams(window.location.search);if(!e.has("dateRange")&&!e.has("page")&&!e.has("sort")&&!e.has("detection")&&!e.has("stream"))return null;const t={filters:{dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"},page:1,limit:20,sort:"start_time",order:"desc"};return e.has("dateRange")&&(t.filters.dateRange=e.get("dateRange"),t.filters.dateRange==="custom"&&(e.has("startDate")&&(t.filters.startDate=e.get("startDate")),e.has("startTime")&&(t.filters.startTime=e.get("startTime")),e.has("endDate")&&(t.filters.endDate=e.get("endDate")),e.has("endTime")&&(t.filters.endTime=e.get("endTime")))),e.has("stream")&&(t.filters.streamId=e.get("stream")),e.has("detection")&&e.get("detection")==="1"&&(t.filters.recordingType="detection"),e.has("page")&&(t.page=parseInt(e.get("page"),10)),e.has("limit")&&(t.limit=parseInt(e.get("limit"),10)),e.has("sort")&&(t.sort=e.get("sort")),e.has("order")&&(t.order=e.get("order")),t},getActiveFiltersDisplay:e=>{const t=[];if(e.dateRange!=="last7days"||e.streamId!=="all"||e.recordingType!=="all"){if(e.dateRange!=="last7days"){let o="";switch(e.dateRange){case"today":o="Today";break;case"yesterday":o="Yesterday";break;case"last30days":o="Last 30 Days";break;case"custom":o="".concat(e.startDate," to ").concat(e.endDate);break}t.push({key:"dateRange",label:"Date: ".concat(o)})}e.streamId!=="all"&&t.push({key:"streamId",label:"Stream: ".concat(e.streamId)}),e.recordingType!=="all"&&t.push({key:"recordingType",label:"Detection Events Only"})}return t},loadFiltersFromUrl:(e,t,r,o,a,l)=>{const n=new URLSearchParams(window.location.search),c={...e};n.has("dateRange")&&(c.dateRange=n.get("dateRange"),c.dateRange==="custom"&&(n.has("startDate")&&(c.startDate=n.get("startDate")),n.has("startTime")&&(c.startTime=n.get("startTime")),n.has("endDate")&&(c.endDate=n.get("endDate")),n.has("endTime")&&(c.endTime=n.get("endTime")))),n.has("stream")&&(c.streamId=n.get("stream")),n.has("detection")&&n.get("detection")==="1"&&(c.recordingType="detection"),r(c),n.has("page")&&o(g=>({...g,currentPage:parseInt(n.get("page"),10)})),n.has("limit")&&o(g=>({...g,pageSize:parseInt(n.get("limit"),10)})),n.has("sort")&&a(n.get("sort")),n.has("order")&&l(n.get("order"))},updateUrlWithFilters:(e,t,r,o)=>{const a=new URLSearchParams(window.location.search);a.set("t",Date.now().toString()),a.set("dateRange",e.dateRange),e.dateRange==="custom"?(a.set("startDate",e.startDate),a.set("startTime",e.startTime),a.set("endDate",e.endDate),a.set("endTime",e.endTime)):(a.delete("startDate"),a.delete("startTime"),a.delete("endDate"),a.delete("endTime")),e.streamId!=="all"?a.set("stream",e.streamId):a.delete("stream"),e.recordingType==="detection"?a.set("detection","1"):a.delete("detection"),a.set("page",t.currentPage.toString()),a.set("limit",t.pageSize.toString()),a.set("sort",r),a.set("order",o);const l="".concat(window.location.pathname,"?").concat(a.toString());window.history.pushState({path:l},"",l);const n=l;window.onbeforeunload=function(){window.history.replaceState({path:n},"",n)}}};var pe;function Ye(){const[e,t]=v([]),[r,o]=v([]),[a,l]=v(!0),[n,c]=v("start_time"),[g,h]=v("desc"),[i,u]=v({dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"}),[b,k]=v({currentPage:1,pageSize:20,totalItems:0,totalPages:1,startItem:0,endItem:0}),[z,$]=v(!1),[he,ye]=v([]),[A,I]=v({}),[W,L]=v(!1),[fe,q]=v(!1),[N,be]=v("selected"),we=He(null);j();const{data:F,isLoading:Je,error:E}=y.hooks.useStreams();T(()=>{F&&Array.isArray(F)&&o(F)},[F]),T(()=>{E&&(console.error("Error loading streams for filter:",E),m("Error loading streams: "+E.message))},[E]),T(()=>{K();const s=C.getFiltersFromUrl();if(s){console.log("Found URL filters:",s);const d=new URLSearchParams(window.location.search);d.has("detection")&&d.get("detection")==="1"&&(s.filters.recordingType="detection"),u(s.filters),k(p=>({...p,currentPage:s.page||1,pageSize:s.limit||20})),c(s.sort||"start_time"),h(s.order||"desc")}return O(),window.addEventListener("resize",O),()=>{window.removeEventListener("resize",O)}},[]),T(()=>{Se()},[i]);const K=()=>{const s=new Date,d=new Date(s);d.setDate(s.getDate()-7),u(p=>({...p,endDate:s.toISOString().split("T")[0],startDate:d.toISOString().split("T")[0]}))},{data:P,isLoading:ve,error:_,refetch:Ge}=y.hooks.useRecordings(i,b,n,g);T(()=>{if(P){const s=P.recordings||[];t(s),Q(s.length>0),P.pagination&&ke(P,b.currentPage)}},[P]),T(()=>{_&&(console.error("Error loading recordings:",_),m("Error loading recordings: "+_.message),Q(!1))},[_]);const O=()=>{window.innerWidth<768?l(!1):l(!0)},De=()=>{l(!a)},[$e,Q]=v(!1),ke=(s,d)=>{if(d=d||b.currentPage,s.pagination){const p=s.pagination.limit||20,w=s.pagination.total||0,x=s.pagination.pages||1;let S=0,R=0;s.recordings.length>0&&(S=(d-1)*p+1,R=Math.min(S+s.recordings.length-1,w)),console.log("Pagination update:",{currentPage:d,pageSize:p,totalItems:w,totalPages:x,startItem:S,endItem:R,recordingsLength:s.recordings.length}),k(B=>({...B,totalItems:w,totalPages:x,pageSize:p,startItem:S,endItem:R}))}else{const p=b.pageSize,w=s.total||0,x=Math.ceil(w/p)||1;let S=0,R=0;s.recordings.length>0&&(S=(d-1)*p+1,R=Math.min(S+s.recordings.length-1,w)),console.log("Pagination update (fallback):",{currentPage:d,pageSize:p,totalItems:w,totalPages:x,startItem:S,endItem:R,recordingsLength:s.recordings.length}),k(B=>({...B,totalItems:w,totalPages:x,startItem:S,endItem:R}))}},xe=s=>{const d=s.target.value;if(u(p=>({...p,dateRange:d})),d==="custom"&&(!i.startDate||!i.endDate)){const p=new Date,w=new Date(p);w.setDate(p.getDate()-7),u(x=>({...x,endDate:p.toISOString().split("T")[0],startDate:w.toISOString().split("T")[0]}))}},Se=()=>{const s=C.getActiveFiltersDisplay(i);$(s.length>0),ye(s)},Y=(s=!0)=>{s&&k(d=>({...d,currentPage:1})),C.updateUrlWithFilters(i,s?{...b,currentPage:1}:b,n,g)},Re=()=>{const s={dateRange:"last7days",startDate:"",startTime:"00:00",endDate:"",endTime:"23:59",streamId:"all",recordingType:"all"},d=new Date,p=new Date(d);p.setDate(d.getDate()-7),s.endDate=d.toISOString().split("T")[0],s.startDate=p.toISOString().split("T")[0],u(s),k(x=>({...x,currentPage:1})),c("start_time"),h("desc");const w=window.location.pathname;window.history.pushState({path:w},"",w)},Te=s=>{switch(s){case"dateRange":u(d=>({...d,dateRange:"last7days"}));break;case"streamId":u(d=>({...d,streamId:"all"}));break;case"recordingType":u(d=>({...d,recordingType:"all"}));break}Y()},Pe=s=>{n===s?h(g==="asc"?"desc":"asc"):(h(s==="start_time"?"desc":"asc"),c(s)),k(d=>({...d,currentPage:1})),C.updateUrlWithFilters(i,{...b,currentPage:1},s,s===n?g==="asc"?"desc":"asc":s==="start_time"?"desc":"asc")},Ce=s=>{s<1||s>b.totalPages||(k(d=>({...d,currentPage:s})),C.updateUrlWithFilters(i,{...b,currentPage:s},n,g))},Ie=s=>{I(d=>({...d,[s]:!d[s]}))},Fe=()=>{const s=!W;L(s);const d={};s&&e.forEach(p=>{d[p.id]=!0}),I(d)},J=()=>Object.values(A).filter(Boolean).length,Ee=s=>{be(s),q(!0)},G=()=>{q(!1)},{mutate:X}=y.hooks.useBatchDeleteRecordings(),_e=()=>{if(G(),N==="selected"){const s=Object.entries(A).filter(([d,p])=>p).map(([d,p])=>parseInt(d,10));X({ids:s}),I({}),L(!1)}else{const s={};if(i.dateRange==="custom")s.start="".concat(i.startDate,"T").concat(i.startTime,":00"),s.end="".concat(i.endDate,"T").concat(i.endTime,":00");else{const{start:d,end:p}=y.getDateRangeFromPreset(i.dateRange);s.start=d,s.end=p}i.streamId!=="all"&&(s.stream_name=i.streamId),i.recordingType==="detection"&&(s.detection=1),X({filter:s}),I({}),L(!1)}},{mutate:Me}=y.hooks.useDeleteRecording(),ze=s=>{confirm("Are you sure you want to delete this recording from ".concat(s.stream,"?"))&&Me(s.id)},Ae=s=>{y.playRecording(s,Ve)},Le=s=>{y.downloadRecording(s)};return D(pe||(pe=f(['\n    <section id="recordings-page" class="page">\n      <div class="page-header flex justify-between items-center mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow">\n        <div class="flex items-center">\n          <h2 class="text-xl font-bold">Recordings</h2>\n          <div class="ml-4 flex">\n            <a href="recordings.html" class="px-3 py-1 bg-blue-500 text-white rounded-l-md">Table View</a>\n            <a href="timeline.html" class="px-3 py-1 bg-gray-300 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-400 dark:hover:bg-gray-600 rounded-r-md">Timeline View</a>\n          </div>\n        </div>\n        <button id="toggle-filters-btn"\n                class="p-2 rounded-full bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none"\n                title="Toggle Filters"\n                onClick=','>\n          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n            <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>\n          </svg>\n        </button>\n      </div>\n\n      <div class="recordings-layout flex flex-col md:flex-row gap-4 w-full">\n        <!-- Sidebar for filters -->\n        <',"\n          filters=","\n          setFilters=","\n          pagination=","\n          setPagination=","\n          streams=","\n          filtersVisible=","\n          applyFilters=","\n          resetFilters=","\n          handleDateRangeChange=","\n          setDefaultDateRange=",'\n        />\n\n        <!-- Main content area -->\n        <div class="recordings-content flex-1">\n          <',"\n            activeFiltersDisplay=","\n            removeFilter=","\n            hasActiveFilters=","\n          />\n\n          <","\n            isLoading=","\n            hasData=",'\n            loadingMessage="Loading recordings..."\n            emptyMessage="No recordings found matching your criteria"\n          >\n            <',"\n              recordings=","\n              sortField=","\n              sortDirection=","\n              sortBy=","\n              selectedRecordings=","\n              toggleRecordingSelection=","\n              selectAll=","\n              toggleSelectAll=","\n              getSelectedCount=","\n              openDeleteModal=","\n              playRecording=","\n              downloadRecording=","\n              deleteRecording=","\n              recordingsTableBodyRef=","\n              pagination=","\n            />\n\n            <","\n              pagination=","\n              goToPage=","\n            />\n          <//>\n        </div>\n      </div>\n\n      <","\n        isOpen=","\n        onClose=","\n        onConfirm=","\n        mode=","\n        count=","\n      />\n    </section>\n  "])),De,qe,i,u,b,k,r,a,Y,Re,xe,K,Ne,he,Te,z,We,ve,$e,Ke,e,n,g,Pe,A,Ie,W,Fe,J,Ee,Ae,Le,ze,we,b,Qe,b,Ce,je,fe,G,_e,N,J())}var me;function tt(){const e=document.getElementById("main-content");e&&ee(async()=>{const{render:t}=await import("./preact-app-cKG-SFd7.js").then(r=>r.p);return{render:t}},__vite__mapDeps([0,1]),import.meta.url).then(({render:t})=>{ee(async()=>{const{QueryClientProvider:r,queryClient:o}=await import("./preact-app-cKG-SFd7.js").then(a=>a.o);return{QueryClientProvider:r,queryClient:o}},__vite__mapDeps([0,1]),import.meta.url).then(({QueryClientProvider:r,queryClient:o})=>{t(D(me||(me=f(["<"," client=","><"," /></",">"])),r,o,Ye,r),e)})})}export{Ye as RecordingsView,tt as loadRecordingsView};
//# sourceMappingURL=RecordingsView-BGmVtTg6.js.map
