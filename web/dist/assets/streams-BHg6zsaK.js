import{d as i,u as e,k as De,a as Ee,b as X,f as E,s as o,h as M,i as B,E as Me,c as _e,e as Ie,Q as Ae}from"./query-client-DIfHb7sS.js";/* empty css               */import{C as Pe}from"./LoadingIndicator-DbxhRnFU.js";import{H as Te,F as Oe}from"./Footer-BkdHi6wB.js";function Re(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}function Ve({streamId:l,streamName:v,onClose:m,onDisable:_,onDelete:g}){const[w,u]=i(!1);return e("div",{class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300",children:e("div",{class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:[e("div",{class:"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[e("h3",{class:"text-lg font-medium",children:w?"Confirm Permanent Deletion":"Stream Actions"}),e("button",{type:"button",class:"text-2xl cursor-pointer border-none bg-transparent",onClick:m,children:"×"})]}),e("div",{class:"p-6",children:w?e(De,{children:[e("div",{class:"mb-6",children:[e("div",{class:"flex items-center justify-center mb-4 text-red-600 dark:text-red-500",children:e("svg",{class:"w-12 h-12",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})})}),e("h4",{class:"text-lg font-medium mb-2 text-center",children:['Are you sure you want to permanently delete "',v,'"?']}),e("p",{class:"text-gray-600 dark:text-gray-400 mb-4 text-center",children:"This action cannot be undone. The stream configuration will be permanently removed from the database."})]}),e("div",{class:"flex justify-center space-x-3",children:[e("button",{class:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",onClick:()=>u(!1),children:"Cancel"}),e("button",{class:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",onClick:()=>{g(l),m()},children:"Yes, Delete Permanently"})]})]}):e("div",{class:"mb-6",children:[e("h4",{class:"text-lg font-medium mb-2",children:['What would you like to do with "',v,'"?']}),e("p",{class:"text-gray-600 dark:text-gray-400 mb-4",children:"Please choose one of the following options:"}),e("div",{class:"space-y-4",children:[e("div",{class:"p-4 border border-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-900/30 rounded-lg",children:[e("h5",{class:"font-medium text-yellow-800 dark:text-yellow-500 mb-2",children:"Disable Stream (Soft Delete)"}),e("p",{class:"text-gray-600 dark:text-gray-400 mb-2",children:"This option will disable the stream but keep its configuration in the database. You can re-enable it later."}),e("ul",{class:"list-disc list-inside text-sm text-gray-600 dark:text-gray-400 mb-3",children:[e("li",{children:"Stream will stop processing"}),e("li",{children:"Live streaming will be disabled"}),e("li",{children:"Recording will be disabled"}),e("li",{children:"Audio recording will be disabled"}),e("li",{children:"Detection-based recording will be disabled"}),e("li",{children:"Configuration is preserved"}),e("li",{children:"Existing recordings are kept"}),e("li",{children:"Can be re-enabled later"})]}),e("button",{class:"w-full px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",onClick:()=>{_(l),m()},children:"Disable Stream"})]}),e("div",{class:"p-4 border border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-900/30 rounded-lg",children:[e("h5",{class:"font-medium text-red-800 dark:text-red-500 mb-2",children:"Delete Stream (Permanent)"}),e("p",{class:"text-gray-600 dark:text-gray-400 mb-2",children:"This option will permanently delete the stream configuration from the database. This action cannot be undone."}),e("ul",{class:"list-disc list-inside text-sm text-gray-600 dark:text-gray-400 mb-3",children:[e("li",{children:"Stream will be completely removed"}),e("li",{children:"Configuration is deleted"}),e("li",{children:"Recordings remain accessible"}),e("li",{children:"Cannot be recovered"})]}),e("button",{class:"w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",onClick:()=>{u(!0)},children:"Delete Stream"})]})]})]})})]})})}function $e(){const l=Ee(),[v,m]=i(!1),[_,g]=i(!1),[w,u]=i(!1),[I,N]=i(!1),[A,J]=i([]),[R,j]=i([]),[c,F]=i(null),[h,W]=i(null),[k,L]=i(""),[f,Y]=i({username:"",password:""}),[P,T]=i(!1),[H,b]=i(!1),{data:C=[],isLoading:G,error:Be}=X(["streams"],"/api/streams",{timeout:1e4,retries:2,retryDelay:1e3}),{data:O}=X(["detectionModels"],"/api/detection/models",{timeout:5e3,retries:1,retryDelay:1e3}),p=Array.isArray(C)?C:C.streams||[];console.log("API Response:",C),console.log("Streams data:",p),console.log("hasData:",p&&p.length>0);const[t,S]=i({name:"",url:"",enabled:!0,streamingEnabled:!0,width:1280,height:720,fps:15,codec:"h264",protocol:"0",priority:"5",segment:30,record:!0,recordAudio:!0,detectionEnabled:!1,detectionModel:"",detectionThreshold:50,detectionInterval:10,preBuffer:10,postBuffer:30}),[y,z]=i(!1),[Z,U]=i(!1),[V,q]=i(null),ee=p&&p.length>0,re=(O==null?void 0:O.models)||[],te=E("/api/streams",{timeout:15e3,retries:1,retryDelay:1e3},{onSuccess:()=>{o("Stream added successfully"),D(),l.invalidateQueries({queryKey:["streams"]})},onError:r=>{o("Error adding stream: ".concat(r.message),5e3,"error")}}),ae=M({mutationFn:async r=>{const{streamName:s,...d}=r,a="/api/streams/".concat(encodeURIComponent(s));return await B(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),timeout:15e3,retries:1,retryDelay:1e3})},onSuccess:()=>{o("Stream updated successfully"),D(),l.invalidateQueries({queryKey:["streams"]})},onError:r=>{o("Error updating stream: ".concat(r.message),5e3,"error")}}),Q={mutate:(r,s)=>{y?ae.mutate({...r,streamName:r.name},s):te.mutate(r,s)}},se=E("/api/streams/test",{timeout:2e4,retries:1,retryDelay:2e3},{onMutate:()=>{o("Testing stream connection...")},onSuccess:r=>{r.success?o("Stream connection successful!",3e3,"success"):o("Stream connection failed: ".concat(r.message),5e3,"error")},onError:r=>{o("Error testing stream: ".concat(r.message),5e3,"error")}}),ne=M({mutationFn:async r=>{const{streamId:s}=r,d="/api/streams/".concat(encodeURIComponent(s),"?permanent=true");return await B(d,{method:"DELETE",timeout:15e3,retries:1,retryDelay:1e3})},onSuccess:()=>{o("Stream successfully deleted."),l.invalidateQueries({queryKey:["streams"]}).then(()=>{$()})},onError:r=>{o("Error deleting stream: ".concat(r.message),5e3,"error")}}),oe=M({mutationFn:async r=>{const{streamId:s}=r,d="/api/streams/".concat(encodeURIComponent(s));return await B(d,{method:"DELETE",timeout:15e3,retries:1,retryDelay:1e3})},onSuccess:()=>{o("Stream successfully disabled."),l.invalidateQueries({queryKey:["streams"]}).then(()=>{$()})},onError:r=>{o("Error disabling stream: ".concat(r.message),5e3,"error")}}),de=r=>{r.preventDefault();const s={name:t.name,url:t.url,enabled:t.enabled,streaming_enabled:t.streamingEnabled,width:parseInt(t.width,10),height:parseInt(t.height,10),fps:parseInt(t.fps,10),codec:t.codec,protocol:parseInt(t.protocol,10),priority:parseInt(t.priority,10),segment_duration:parseInt(t.segment,10),record:t.record,detection_based_recording:t.detectionEnabled,detection_model:t.detectionModel,detection_threshold:parseInt(t.detectionThreshold,10),detection_interval:parseInt(t.detectionInterval,10),pre_detection_buffer:parseInt(t.preBuffer,10),post_detection_buffer:parseInt(t.postBuffer,10),record_audio:t.recordAudio};y&&(s.is_deleted=!1),Q.mutate(s)},ie=r=>{de(r)},le=()=>{se.mutate({url:t.url,protocol:parseInt(t.protocol,10)})},ce=r=>{q(r),U(!0)},$=()=>{U(!1),q(null)},me=()=>{S({name:"",url:"",enabled:!0,streamingEnabled:!0,width:1280,height:720,fps:15,codec:"h264",protocol:"0",priority:"5",segment:30,record:!0,recordAudio:!0,detectionEnabled:!1,detectionModel:"",detectionThreshold:50,detectionInterval:10,preBuffer:10,postBuffer:30}),z(!1),m(!0)},ue=async r=>{var s,d;try{const a=await l.fetchQuery({queryKey:["stream",r],queryFn:async()=>{const x=await fetch("/api/streams/".concat(encodeURIComponent(r)));if(!x.ok)throw new Error("HTTP error ".concat(x.status));return x.json()},staleTime:1e4});S({...a,width:a.width||1280,height:a.height||720,fps:a.fps||15,protocol:((s=a.protocol)==null?void 0:s.toString())||"0",priority:((d=a.priority)==null?void 0:d.toString())||"5",segment:a.segment_duration||30,detectionThreshold:a.detection_threshold||50,detectionInterval:a.detection_interval||10,preBuffer:a.pre_detection_buffer||10,postBuffer:a.post_detection_buffer||30,streamingEnabled:a.streaming_enabled!==void 0?a.streaming_enabled:!0,isOnvif:a.is_onvif!==void 0?a.is_onvif:!1,detectionEnabled:a.detection_based_recording||!1,detectionModel:a.detection_model||"",recordAudio:a.record_audio!==void 0?a.record_audio:!0}),z(!0),m(!0)}catch(a){console.error("Error loading stream details:",a),o("Error loading stream details: "+a.message)}},D=()=>{m(!1)},n=r=>{const{name:s,value:d,type:a,checked:x}=r.target;S(Se=>({...Se,[s]:a==="checkbox"?x:d}))},ge=r=>{oe.mutate({streamId:r})},he=r=>{ne.mutate({streamId:r})},K=r=>{const{name:s,value:d}=r.target;Y(a=>({...a,[s]:d}))},be=r=>{const s=r.target.value;S(d=>({...d,detectionThreshold:s}))},pe=()=>{l.invalidateQueries({queryKey:["detectionModels"]})},fe=E("/api/onvif/discovery/discover",{timeout:12e4,retries:0},{onMutate:()=>{T(!0)},onSuccess:r=>{J(r.devices||[]),T(!1)},onError:r=>{o("Error discovering ONVIF devices: ".concat(r.message),5e3,"error"),T(!1)}}),ye=M({mutationFn:({device:r,credentials:s})=>(b(!0),fetch("/api/onvif/device/profiles",{method:"GET",headers:{"X-Device-URL":"http://".concat(r.ip_address,"/onvif/device_service"),"X-Username":s.username,"X-Password":s.password}}).then(d=>{if(!d.ok)throw new Error("HTTP error ".concat(d.status));return d.json()})),onSuccess:r=>{j(r.profiles||[]),b(!1)},onError:r=>{o("Error loading device profiles: ".concat(r.message),5e3,"error"),b(!1)}}),xe=E("/api/onvif/device/test",{timeout:15e3,retries:0},{onMutate:()=>{b(!0)},onSuccess:(r,s)=>{r.success?(o("Connection successful!",3e3,"success"),c&&Ne(c)):(o("Connection failed: ".concat(r.message),5e3,"error"),b(!1))},onError:r=>{o("Error testing connection: ".concat(r.message),5e3,"error"),b(!1)}}),ve=()=>{if(!c||!h||!k.trim()){o("Missing required information",5e3,"error");return}N(!0);const r={name:k.trim(),url:h.stream_uri,enabled:!0,streaming_enabled:!0,width:h.width,height:h.height,fps:h.fps||15,codec:h.encoding==="H264"?"h264":"h265",protocol:"0",priority:"5",segment_duration:30,record:!0,record_audio:!0,is_onvif:!0};console.log("Adding ONVIF stream with data:",r),Q.mutate(r,{onSuccess:()=>{N(!1),u(!1),g(!1)},onError:()=>{N(!1)},isEditing:!1})},we=()=>{fe.mutate({})},Ne=r=>{F(r),j([]),ye.mutate({device:r,credentials:f})},ke=r=>{W(r),L("".concat(c.name||"ONVIF","_").concat(r.name||"Stream")),u(!0)},Ce=r=>{F(r),xe.mutate({url:"http://".concat(r.ip_address,"/onvif/device_service"),username:f.username,password:f.password})};return e("section",{id:"streams-page",className:"page",children:[e("div",{className:"page-header flex justify-between items-center mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow",children:[e("h2",{className:"text-xl font-bold",children:"Streams"}),e("div",{className:"controls flex space-x-2",children:[e("button",{id:"discover-onvif-btn",className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",onClick:()=>g(!0),children:"Discover ONVIF Cameras"}),e("button",{id:"add-stream-btn",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",onClick:me,children:"Add Stream"})]})]}),e(Pe,{isLoading:G,hasData:ee,loadingMessage:"Loading streams...",emptyMessage:"No streams configured yet. Click 'Add Stream' to create one.",children:e("div",{className:"streams-container bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden",children:e("div",{className:"overflow-x-auto",children:e("table",{id:"streams-table",className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"URL"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Resolution"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"FPS"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Recording"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700",children:p.map(r=>e("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"flex items-center",children:[e("span",{className:"status-indicator w-2 h-2 rounded-full mr-2 ".concat(r.enabled?"bg-green-500":"bg-red-500")}),r.name]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:r.url}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.width,"x",r.height]}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:r.fps}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.record?"Enabled":"Disabled",r.detection_based_recording?" (Detection)":""]}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"flex space-x-2",children:[e("button",{className:"p-1 rounded-full text-blue-600 hover:bg-blue-100 dark:text-blue-400 dark:hover:bg-blue-900 focus:outline-none",onClick:()=>ue(r.name),title:"Edit",children:e("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})}),e("button",{className:"p-1 rounded-full text-red-600 hover:bg-red-100 dark:text-red-400 dark:hover:bg-red-900 focus:outline-none",onClick:()=>ce(r),title:"Delete",children:e("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})})]},r.name))})]})})})}),Z&&V&&e(Ve,{streamId:V.name,streamName:V.name,onClose:$,onDisable:ge,onDelete:he}),v&&e("div",{id:"stream-modal",className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300",children:e("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[e("h3",{className:"text-lg font-medium",children:y?"Edit Stream":"Add Stream"}),e("span",{className:"text-2xl cursor-pointer",onClick:D,children:"×"})]}),e("div",{className:"p-4",children:e("form",{id:"stream-form",className:"space-y-4",children:[e("div",{className:"form-group",children:[e("label",{for:"stream-name",className:"block text-sm font-medium mb-1",children:"Name"}),e("input",{type:"text",id:"stream-name",name:"name",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white ".concat(y?"bg-gray-100 dark:bg-gray-800":""),value:t.name,onChange:n,disabled:y,required:!0})]}),e("div",{className:"form-group",children:[e("label",{for:"stream-url",className:"block text-sm font-medium mb-1",children:"URL"}),e("input",{type:"text",id:"stream-url",name:"url",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"rtsp://example.com/stream",value:t.url,onChange:n,required:!0})]}),e("div",{className:"form-group flex items-center",children:[e("input",{type:"checkbox",id:"stream-enabled",name:"enabled",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:t.enabled,onChange:n}),e("label",{for:"stream-enabled",className:"ml-2 block text-sm",children:"Stream Active"}),e("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:"Enable/disable all stream processing"})]}),e("div",{className:"form-group flex items-center",children:[e("input",{type:"checkbox",id:"stream-streaming-enabled",name:"streamingEnabled",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:t.streamingEnabled,onChange:n}),e("label",{for:"stream-streaming-enabled",className:"ml-2 block text-sm",children:"Live View Enabled"}),e("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:"Enable/disable live viewing in browser"})]}),e("div",{className:"form-group flex items-center",children:[e("input",{type:"checkbox",id:"stream-is-onvif",name:"isOnvif",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:t.isOnvif,onChange:n}),e("label",{for:"stream-is-onvif",className:"ml-2 block text-sm",children:"ONVIF Camera"}),e("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:"Mark this stream as an ONVIF camera for special handling"})]}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{className:"form-group",children:[e("label",{for:"stream-width",className:"block text-sm font-medium mb-1",children:"Width"}),e("input",{type:"number",id:"stream-width",name:"width",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",min:"320",max:"1920",value:t.width,onChange:n})]}),e("div",{className:"form-group",children:[e("label",{for:"stream-height",className:"block text-sm font-medium mb-1",children:"Height"}),e("input",{type:"number",id:"stream-height",name:"height",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",min:"240",max:"1080",value:t.height,onChange:n})]})]}),e("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e("div",{className:"form-group",children:[e("label",{for:"stream-fps",className:"block text-sm font-medium mb-1",children:"FPS"}),e("input",{type:"number",id:"stream-fps",name:"fps",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",min:"1",max:"30",value:t.fps,onChange:n})]}),e("div",{className:"form-group",children:[e("label",{for:"stream-codec",className:"block text-sm font-medium mb-1",children:"Codec"}),e("select",{id:"stream-codec",name:"codec",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:t.codec,onChange:n,children:[e("option",{value:"h264",children:"H.264"}),e("option",{value:"h265",children:"H.265"})]})]}),e("div",{className:"form-group",children:[e("label",{for:"stream-protocol",className:"block text-sm font-medium mb-1",children:"Protocol"}),e("select",{id:"stream-protocol",name:"protocol",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:t.protocol,onChange:n,children:[e("option",{value:"0",children:"TCP"}),e("option",{value:"1",children:"UDP"})]}),e("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Connection protocol (ONVIF cameras use either TCP or UDP)"})]})]}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{className:"form-group",children:[e("label",{for:"stream-priority",className:"block text-sm font-medium mb-1",children:"Priority"}),e("select",{id:"stream-priority",name:"priority",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:t.priority,onChange:n,children:[e("option",{value:"1",children:"Low (1)"}),e("option",{value:"5",children:"Medium (5)"}),e("option",{value:"10",children:"High (10)"})]})]}),e("div",{className:"form-group",children:[e("label",{for:"stream-segment",className:"block text-sm font-medium mb-1",children:"Segment Duration (seconds)"}),e("input",{type:"number",id:"stream-segment",name:"segment",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",min:"60",max:"3600",value:t.segment,onChange:n})]})]}),e("div",{className:"form-group flex items-center",children:[e("input",{type:"checkbox",id:"stream-record",name:"record",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:t.record,onChange:n}),e("label",{for:"stream-record",className:"ml-2 block text-sm",children:"Record"})]}),e("div",{className:"form-group flex items-center",children:[e("input",{type:"checkbox",id:"stream-record-audio",name:"recordAudio",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:t.recordAudio,onChange:n}),e("label",{for:"stream-record-audio",className:"ml-2 block text-sm",children:"Record Audio"}),e("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:"Include audio in recordings if available in the stream"})]}),e("div",{className:"mt-6 mb-2 pb-1 border-b border-gray-200 dark:border-gray-700",children:e("h4",{className:"text-md font-medium",children:"Detection-Based Recording"})}),e("div",{className:"form-group flex items-center",children:[e("input",{type:"checkbox",id:"stream-detection-enabled",name:"detectionEnabled",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:t.detectionEnabled,onChange:n}),e("label",{for:"stream-detection-enabled",className:"ml-2 block text-sm",children:"Enable Detection-Based Recording"}),e("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:"Only record when objects are detected"})]}),e("div",{className:"form-group",style:t.detectionEnabled?"":"display: none",children:[e("label",{for:"stream-detection-model",className:"block text-sm font-medium mb-1",children:"Detection Model"}),e("div",{className:"flex space-x-2",children:[e("select",{id:"stream-detection-model",name:"detectionModel",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:t.detectionModel,onChange:n,children:[e("option",{value:"",children:"Select a model"}),re.map(r=>e("option",{value:r.id,children:r.name},r.id))]}),e("button",{id:"refresh-models-btn",className:"p-2 rounded-md bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none",title:"Refresh Models",onClick:pe,type:"button",children:e("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})})})]})]}),e("div",{className:"form-group",style:t.detectionEnabled?"":"display: none",children:[e("label",{for:"stream-detection-threshold",className:"block text-sm font-medium mb-1",children:"Detection Threshold"}),e("div",{className:"flex items-center space-x-2",children:[e("input",{type:"range",id:"stream-detection-threshold",name:"detectionThreshold",className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700",min:"0",max:"100",step:"1",value:t.detectionThreshold,onInput:be}),e("span",{id:"stream-threshold-value",className:"font-medium text-blue-600 dark:text-blue-400 min-w-[3rem] text-center",children:[t.detectionThreshold,"%"]})]})]}),e("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",style:t.detectionEnabled?"":"display: none",children:[e("div",{className:"form-group",children:[e("label",{for:"stream-detection-interval",className:"block text-sm font-medium mb-1",children:"Detection Interval (frames)"}),e("input",{type:"number",id:"stream-detection-interval",name:"detectionInterval",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",min:"1",max:"100",value:t.detectionInterval,onChange:n}),e("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Detect on every Nth frame"})]}),e("div",{className:"form-group",children:[e("label",{for:"stream-pre-buffer",className:"block text-sm font-medium mb-1",children:"Pre-detection Buffer (seconds)"}),e("input",{type:"number",id:"stream-pre-buffer",name:"preBuffer",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",min:"0",max:"60",value:t.preBuffer,onChange:n}),e("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Seconds to keep before detection"})]}),e("div",{className:"form-group",children:[e("label",{for:"stream-post-buffer",className:"block text-sm font-medium mb-1",children:"Post-detection Buffer (seconds)"}),e("input",{type:"number",id:"stream-post-buffer",name:"postBuffer",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",min:"0",max:"300",value:t.postBuffer,onChange:n}),e("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Seconds to keep after detection"})]})]})]})}),e("div",{className:"flex justify-between p-4 border-t border-gray-200 dark:border-gray-700",children:[e("button",{id:"stream-test-btn",className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",onClick:le,type:"button",children:"Test Connection"}),e("div",{className:"space-x-2",children:[e("button",{id:"stream-save-btn",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",onClick:ie,type:"button",children:"Save"}),e("button",{id:"stream-cancel-btn",className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",onClick:D,type:"button",children:"Cancel"})]})]})]})}),_&&e("div",{id:"onvif-modal",className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300",children:e("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[e("h3",{className:"text-lg font-medium",children:"ONVIF Camera Discovery"}),e("span",{className:"text-2xl cursor-pointer",onClick:()=>g(!1),children:"×"})]}),e("div",{className:"p-4",children:[e("div",{className:"mb-4 flex justify-between items-center",children:[e("h4",{className:"text-md font-medium",children:"Discovered Devices"}),e("button",{id:"discover-btn",className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors focus:outline-none",onClick:we,disabled:P,type:"button",children:P?e("span",{className:"flex items-center",children:["Discovering",e("span",{className:"ml-1 flex space-x-1",children:[e("span",{className:"animate-pulse delay-0 h-1.5 w-1.5 bg-white rounded-full"}),e("span",{className:"animate-pulse delay-150 h-1.5 w-1.5 bg-white rounded-full"}),e("span",{className:"animate-pulse delay-300 h-1.5 w-1.5 bg-white rounded-full"})]})]}):"Start Discovery"})]}),e("div",{className:"overflow-x-auto",children:e("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"IP Address"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Manufacturer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Model"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700",children:A.length===0?e("tr",{children:e("td",{colSpan:"4",className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:P?e("div",{className:"flex items-center justify-center",children:[e("span",{children:"Discovering devices"}),e("span",{className:"ml-1 flex space-x-1",children:[e("span",{className:"animate-pulse delay-0 h-1.5 w-1.5 bg-gray-500 dark:bg-gray-400 rounded-full"}),e("span",{className:"animate-pulse delay-150 h-1.5 w-1.5 bg-gray-500 dark:bg-gray-400 rounded-full"}),e("span",{className:"animate-pulse delay-300 h-1.5 w-1.5 bg-gray-500 dark:bg-gray-400 rounded-full"})]})]}):'No devices discovered yet. Click "Start Discovery" to scan your network.'})}):A.map(r=>e("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:r.ip_address}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:r.manufacturer||"Unknown"}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:r.model||"Unknown"}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("button",{className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors focus:outline-none",onClick:()=>Ce(r),disabled:H&&c&&c.ip_address===r.ip_address,type:"button",children:H&&c&&c.ip_address===r.ip_address?e("span",{className:"flex items-center",children:["Loading",e("span",{className:"ml-1 flex space-x-1",children:[e("span",{className:"animate-pulse delay-0 h-1.5 w-1.5 bg-white rounded-full"}),e("span",{className:"animate-pulse delay-150 h-1.5 w-1.5 bg-white rounded-full"}),e("span",{className:"animate-pulse delay-300 h-1.5 w-1.5 bg-white rounded-full"})]})]}):"Connect"})})]},r.ip_address))})]})}),e("div",{className:"mt-6 mb-4",children:[e("h4",{className:"text-md font-medium mb-2",children:"Authentication"}),e("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Enter credentials to connect to the selected ONVIF device. Credentials are not needed for discovery, only for connecting to devices."}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{className:"form-group",children:[e("label",{for:"onvif-username",className:"block text-sm font-medium mb-1",children:"Username"}),e("input",{type:"text",id:"onvif-username",name:"username",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"admin",value:f.username,onChange:K})]}),e("div",{className:"form-group",children:[e("label",{for:"onvif-password",className:"block text-sm font-medium mb-1",children:"Password"}),e("input",{type:"password",id:"onvif-password",name:"password",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"password",value:f.password,onChange:K})]})]})]}),c&&R.length>0&&e("div",{className:"mt-6",children:[e("h4",{className:"text-md font-medium mb-2",children:["Available Profiles for ",c.ip_address]}),e("div",{className:"overflow-x-auto",children:e("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Resolution"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Encoding"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"FPS"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700",children:R.map(r=>e("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:r.name}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.width,"x",r.height]}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:r.encoding}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:r.fps}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("button",{className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition-colors focus:outline-none",onClick:()=>ke(r),type:"button",children:"Add as Stream"})})]},r.token))})]})})]})]}),e("div",{className:"flex justify-end p-4 border-t border-gray-200 dark:border-gray-700",children:e("button",{id:"onvif-close-btn",className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",onClick:()=>g(!1),type:"button",children:"Close"})})]})}),w&&e("div",{id:"custom-name-modal",className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300",children:e("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:[e("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[e("h3",{className:"text-lg font-medium",children:"Stream Name"}),e("span",{className:"text-2xl cursor-pointer",onClick:()=>u(!1),children:"×"})]}),e("div",{className:"p-4",children:e("div",{className:"mb-4",children:[e("label",{for:"custom-stream-name",className:"block text-sm font-medium mb-1",children:"Enter a name for this stream:"}),e("input",{type:"text",id:"custom-stream-name",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",value:k,onChange:r=>L(r.target.value)}),e("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"This name will be used to identify the stream in the system."})]})}),e("div",{className:"flex justify-end p-4 border-t border-gray-200 dark:border-gray-700 space-x-2",children:[e("button",{className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors",onClick:()=>u(!1),type:"button",children:"Cancel"}),e("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors",onClick:ve,type:"button",disabled:!k.trim()||I,children:I?e("span",{className:"flex items-center",children:["Adding",e("span",{className:"ml-1 flex space-x-1",children:[e("span",{className:"animate-pulse delay-0 h-1.5 w-1.5 bg-white rounded-full"}),e("span",{className:"animate-pulse delay-150 h-1.5 w-1.5 bg-white rounded-full"}),e("span",{className:"animate-pulse delay-300 h-1.5 w-1.5 bg-white rounded-full"})]})]}):"Add Stream"})]})]})})]})}document.addEventListener("DOMContentLoaded",()=>{const l=document.getElementById("main-content");l&&Me(e(Ae,{client:_e,children:[e(Te,{}),e(Ie,{}),e($e,{}),e(Oe,{})]}),l)});export{Re as __vite_legacy_guard};
//# sourceMappingURL=streams-BHg6zsaK.js.map
