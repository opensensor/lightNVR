<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - LightNVR</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
</head>
<body>
<div class="container">
    <header id="header-container">
        <!-- Header content will be loaded by JavaScript -->
    </header>

    <main id="main-content">
        <section id="settings-page" class="page">
            <div class="page-header">
                <h2>Settings</h2>
                <div class="controls">
                    <button id="save-settings-btn" class="btn-primary">Save Settings</button>
                </div>
            </div>
            <div id="settings-status" class="status-message" style="display: none;"></div>
            
            <!-- Progress indicator styles -->
            <style>
                .settings-container {
                    position: relative;
                    min-height: 400px;
                }
                
                .progress-container {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.7);
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                    color: white;
                    padding: 20px;
                    border-radius: 4px;
                }
                
                .status-message {
                    padding: 10px 15px;
                    margin-bottom: 15px;
                    border-radius: 4px;
                    font-weight: 500;
                }
                
                .status-message.success {
                    background-color: rgba(76, 175, 80, 0.2);
                    color: #2e7d32;
                    border: 1px solid #2e7d32;
                }
                
                .status-message.error {
                    background-color: rgba(244, 67, 54, 0.2);
                    color: #c62828;
                    border: 1px solid #c62828;
                }
            </style>
            <div class="settings-container">
                <div class="settings-group">
                    <h3>General Settings</h3>
                    <div class="setting">
                        <label for="setting-log-level">Log Level</label>
                        <select id="setting-log-level">
                            <option value="0">Error</option>
                            <option value="1">Warning</option>
                            <option value="2" selected>Info</option>
                            <option value="3">Debug</option>
                        </select>
                    </div>
                </div>
                <div class="settings-group">
                    <h3>Storage Settings</h3>
                    <div class="setting">
                        <label for="setting-storage-path">Storage Path</label>
                        <input type="text" id="setting-storage-path" value="/var/lib/lightnvr/recordings">
                    </div>
                    <div class="setting">
                        <label for="setting-max-storage">Maximum Storage Size (GB)</label>
                        <input type="number" id="setting-max-storage" value="0" min="0">
                        <span class="hint">0 = unlimited</span>
                    </div>
                    <div class="setting">
                        <label for="setting-retention">Retention Period (days)</label>
                        <input type="number" id="setting-retention" value="30" min="1">
                    </div>
                    <div class="setting">
                        <label for="setting-auto-delete">Auto Delete Oldest</label>
                        <input type="checkbox" id="setting-auto-delete" checked>
                    </div>
                </div>
                <div class="settings-group">
                    <h3>Web Interface Settings</h3>
                    <div class="setting">
                        <label for="setting-web-port">Web Port</label>
                        <input type="number" id="setting-web-port" value="8080" min="1" max="65535">
                    </div>
                    <div class="setting">
                        <label for="setting-auth-enabled">Enable Authentication</label>
                        <input type="checkbox" id="setting-auth-enabled" checked>
                    </div>
                    <div class="setting">
                        <label for="setting-username">Username</label>
                        <input type="text" id="setting-username" value="admin">
                    </div>
                    <div class="setting">
                        <label for="setting-password">Password</label>
                        <input type="password" id="setting-password" value="admin">
                    </div>
                </div>
                <div class="settings-group">
                    <h3>Memory Optimization</h3>
                    <div class="setting">
                        <label for="setting-buffer-size">Buffer Size (KB)</label>
                        <input type="number" id="setting-buffer-size" value="1024" min="128">
                    </div>
                    <div class="setting">
                        <label for="setting-use-swap">Use Swap File</label>
                        <input type="checkbox" id="setting-use-swap" checked>
                    </div>
                    <div class="setting">
                        <label for="setting-swap-size">Swap Size (MB)</label>
                        <input type="number" id="setting-swap-size" value="128" min="32">
                    </div>
                </div>
                
                <div class="settings-group">
                    <h3>Detection-Based Recording</h3>
                    <div class="setting">
                        <p class="setting-description">
                            Configure detection-based recording for streams. When enabled, recordings will only be saved when objects are detected.
                        </p>
                        <p class="setting-description">
                            <strong>Motion Detection:</strong> Built-in motion detection is available without requiring any external models. 
                            Select "motion" as the detection model in stream settings to use this feature.
                        </p>
                        <p class="setting-description">
                            <strong>Optimized Motion Detection:</strong> Memory and CPU optimized motion detection for embedded devices.
                            Select "motion_optimized" as the detection model in stream settings to use this feature.
                        </p>
                    </div>
                    <div class="setting">
                        <label for="setting-detection-models-path">Detection Models Path</label>
                        <input type="text" id="setting-detection-models-path" placeholder="/var/lib/lightnvr/models">
                        <span class="hint">Directory where detection models are stored</span>
                    </div>
                    <div class="setting">
                        <label for="setting-default-detection-threshold">Default Detection Threshold</label>
                        <input type="range" id="setting-default-detection-threshold" min="0" max="100" value="50" step="1">
                        <span id="threshold-value">50%</span>
                        <span class="hint">Confidence threshold for detection (0-100%)</span>
                    </div>
                    <div class="setting">
                        <label for="setting-default-pre-buffer">Default Pre-detection Buffer (seconds)</label>
                        <input type="number" id="setting-default-pre-buffer" value="5" min="0" max="60">
                        <span class="hint">Seconds of video to keep before detection</span>
                    </div>
                    <div class="setting">
                        <label for="setting-default-post-buffer">Default Post-detection Buffer (seconds)</label>
                        <input type="number" id="setting-default-post-buffer" value="10" min="0" max="300">
                        <span class="hint">Seconds of video to keep after detection</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer id="footer-container">
        <!-- Footer content will be loaded by JavaScript -->
    </footer>
</div>

<script src="js/core.js"></script>
<script src="js/components/layout.js"></script>
<script src="js/components/ui.js"></script>
<script src="js/components/settings.js"></script>
<script src="js/pages/pages.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Load header and footer
        loadHeader('nav-settings');
        loadFooter();
        
        // Initialize the settings view
        setupSettingsHandlers();
        loadSettings();
    });
</script>
</body>
</html>
